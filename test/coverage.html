<!DOCTYPE html><html><head><title>Coverage</title><script>

headings = [];

onload = function(){
  headings = document.querySelectorAll('h2');
};

onscroll = function(e){
  var heading = find(window.scrollY);
  if (!heading) return;
  var links = document.querySelectorAll('#menu a')
    , link;

  for (var i = 0, len = links.length; i < len; ++i) {
    link = links[i];
    link.className = link.getAttribute('href') == '#' + heading.id
      ? 'active'
      : '';
  }
};

function find(y) {
  var i = headings.length
    , heading;

  while (i--) {
    heading = headings[i];
    if (y >= heading.offsetTop) {
      return heading;
    }
  }
}
</script>
<style>

body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  color: #2C2C2C;
  border-top: 2px solid #ddd;
}

#coverage {
  padding: 60px;
}

h1 a {
  color: inherit;
  font-weight: inherit;
}

h1 a:hover {
  text-decoration: none;
}

.onload h1 {
  opacity: 1;
}

h2 {
  width: 80%;
  margin-top: 80px;
  margin-bottom: 0;
  font-weight: 100;
  letter-spacing: 1px;
  border-bottom: 1px solid #eee;
}

a {
  color: #8A6343;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

ul {
  margin-top: 20px;
  padding: 0 15px;
  width: 100%;
}

ul li {
  float: left;
  width: 40%;
  margin-top: 5px;
  margin-right: 60px;
  list-style: none;
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  font-size: 12px;
}

ul::after {
  content: '.';
  height: 0;
  display: block;
  visibility: hidden;
  clear: both;
}

code {
  font: 12px monaco, monospace;
}

pre {
  margin: 30px;
  padding: 30px;
  border: 1px solid #eee;
  border-bottom-color: #ddd;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  -webkit-box-shadow: inset 0 0 10px #eee;
  -moz-box-shadow: inset 0 0 10px #eee;
  overflow-x: auto;
}

img {
  margin: 30px;
  padding: 1px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  -webkit-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  -moz-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  max-width: 100%;
}

footer {
  background: #eee;
  width: 100%;
  padding: 50px 0;
  text-align: right;
  border-top: 1px solid #ddd;
}

footer span {
  display: block;
  margin-right: 30px;
  color: #888;
  font-size: 12px;
}

#menu {
  position: fixed;
  font-size: 12px;
  overflow-y: auto;
  top: 0;
  right: 0;
  margin: 0;
  height: 100%;
  padding: 15px 0;
  text-align: right;
  border-left: 1px solid #eee;
  -moz-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-font-smoothing: antialiased;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGYAAABmCAMAAAAOARRQAAABelBMVEUjJSU6OzshIyM5OjoqKy02NjgsLS01NTYjJCUzNTUgISMlJSc0NTUvMDA6PDwlJyg1NjYoKis2NjYrLS02ODkpKyw0NDYrLC04ODovLzA4Ojo0NDUtLy86OjwjIyU4OTosLS82ODgtLS8hIyQvMTEnKCooKSsrKy0qLCwkJSUnKCkrLCwpKiwwMjIxMzMqLC0tLS0pKissLC00NTYwMDIwMTQpKysoKSovMDEtLzA2OTkxMzUrKywvLy8qKyszNTY5OzsqKiw6OjswMDExNDUoKiozNDUvMDIyNDY1Njg2Njk5OTozMzU0NjY4ODkiIyUiIyQ4OTkuMDEmKCowMjQwMTErLS4qKywwMTMhIiMpKiopKy0tLjAkJScxNDQvLzExNDYyNDQmKCk5OTslJig5OjskJSYxMzQrLS8gISIwMTIoKCk1NTUlJSUnJygwMDA4ODgiIiMhISI8PDw6Ojo5OTkpKSojIyQ7OzsyMjIpKSssLCw6Ozw1NjlrfLakAAAg2UlEQVR42jR6i3ea6rYvPgANIAhVXh8WvkQlioUiFlFcBtAmoiRNdzxqu9p0J7vrdK29zuPeex77nnvO/35n1r1ndHRktI0jTOacv/l7lCBK5UqVpOha/YxmWK7BC4TQFKVXrbYsnimqxuuMVlOQ0XltWjUdCwRJ1M+tC1KudOs9q6+da2adUewG0SC0SwELfHtgDds93VEuydEbl3QMWeNoYkR7b/0x1ZRobGI3mLwzAhePqTAwhg6aogjNsGy7/jwQ4rkdqe7CWLxF8k9LfMVFyRS7VJqtkrW8Vt/bkR8FZJao16ipknbC3Yw2lM7laO6HBEOadEZ2tpf65c4v8e3u7FyU6qbiNNyCuzXZ6pawgnwgmrpTT/Q7w2EZmiIJ0dzWDI7mhQ80IfRnMu2kzA5r5r1pIFoia+/d93HRYp1GV8TbrkWoU/+jdI0Ff6yGwTjT1Hn8J+8m1rKpGiYPuNiHnMtNMIv+zpsk84MYTNW1/+DpwXLvckdOCMYowVNPREe0QlM8xRHXXFhcNDzupwsSmb5pH+0t0RP2Qk+QtI7F1Qm6JRC6ZPBtPq/dq/kH+jxtCljn9TIpW6rQIgmSVyj6lPICIw4N/taka41PFUInth0je9+jO6Kt1G4/a7V2LEgG02B0pHVuCZrgltSKMuIl5SyufUv9mYuQi+mFgzbBEtFo2g+Dh4sSTrLNu8JPh00sQydpb00tqXBvqRN7Q7kqzcnIxCGnvZt/WmJacoOEO6Dcn8Qre03pOCSQxbMOXUuDNx9SxuLz4W1I18gvjViQ67zV0rxdWL8Te/TQkuo8STS41DR48W7L6YP2uWIqiUV8rd6Gbf/rnegKZeG8TpAM6afhGze9JAOxbLjsnUXEbrZ9vLYd7MT32cPF5mKKxmjy7huaoD9n62GOxni3iIJwv0IzZAZjdZkUtolCNLVfYZNaquFjGszVVf+J0vrz4CawoKdHnOzb0NMH7CDBOybfYNJ4rfeMyFNjkFYVTzMFs87rnPGXLUOeNKRVc0LnU7/UIgelzsy3CMuth0YfvnY0wsD3vODUL3eJcKqHQpm8yM3XZQWJxO6Un9iYloyyLpOwN2obHy6W6gbpcb44XmyC+mg+itAcaprGcrwZCqMj/GmtKn0zPvpTz/Cv1dw21XwP3cRupg3H3MF/S71eTKj1YrdwKdc2Mw0fRmb2sFf8lW3aU6JbIZSEPqvXvjM7G/aApyXlXeqKfMq0g/Su3rUGJPSPrtGElgknrZM3xUXqsAP6zMCNVn5u8aJnSNpJv2uru7t2jfRziW2+GuhqfldUNbPk71olwo+46ePUo1U3WKk/e5YK07F/wGRgcpODmQnIlVeHCWBE4puBi2jq28UKpqiN1/4UOrGz59TNYrrQHtd+11sG40BGD+pXdelNqGOg4NXe8W4eacJV/NS9/2Umtym6WQqveqR9xdCMElpxnbkalM4Vf9uaEcWZaKdyibEIjWKxJZPN95niCL3GiaXyssIrHxoLkqkzLCXULN46/f2h3tQJgyip+Tk9EAjJ9aJshq7t8X45aowSKspMSvPf7r9R8yxNptIaHS5ozuEm6luPDApugyNP8OaqiQ4BjaequXA54SLC83eHIY2r+CZp4409Xqw8Aa2oI7XkCrQi+in0w5AqF/kLNrcUz+qkl/lAobY1jSnx5OJNhyXIz3qfNFlXc0TKaglNwdWkWYt9QQ1Kr6W8zue21iNrdJk+N5oCr2O9nEtWKC7IS5J/zdDEYrmnAYfg6agCy+qcgz7ZofeDc4PbUWSvkshWuAc7OjiUyLkj+RAtdlwXJcjxdpkTTHDhK8lBCi8+JtvDVL1W6elmOM++YS0LuSlaP1oUvAeiW3cFnvTr8EbTz1tsSMYdGeZe40sRWu5uAfj7q+ZoKv2FNQ0p5XY1lmlcigHZqTPpabufEVrNuNPi165w3uCVQJHyJqmSJ7ZHnguqwtCmwViIJijj04ba2JNYtB+yORf5gg1/9t9iw4vUpeqiunSAbf+IBdj/b+iG2qrHvuNP0Vd/+ThVZT/lrvHYjjgDbbyxaqgHNM2uhxa1GW3UedZYhMMwM4mQhltouK+IV4NdbIQNM+8Yv311RZk9kT4tiYR4LkyFcuPpdcjuhUuFqBAWRZa11lcZ3gEBlXywsNhrt+plISZP5DlsV9l4EgY6J3yZPTUcMrgaWAT3oI79eSbGEbcJpr6BD8kyDiVt+G0/hXosQN4NFXKlfWIfsIs0BHODVok1/IGnKFHJYIquh8Xo+2+bkQNTGgWmN/fZ0Y33LSj6lr1GyV7mWIKg7ZTRZPGuhF/zjRNcQ1UPtSYgnWQxSs0yrVhwNDcdGMNSNe2JT3WuzbAM3HykyAajS3Uphf6STKEqxLas9EnmnhA/lyj9Uj+JoY7SVgVmGLl46Rm2u98sbkap2lzAdKBG4r6LgulQOSSjQv1GWdQ0jtDUK/mAaqM1Uqjpu4k3Rvfvxv7YTxLSK+wN3E5jVIzmF23uZ7hiH/sVP49D7tvoKp4S8b1LuvRlivVB/algbhcFITYVXvDpLzpDfplR2uD5V4XJFxpjmIpLc9Y5sB2TpBRix7Bme6GZIq+06v3XzNeTcA4obQIKxrnT4C2JpOqD92dbmSX8MGazly5EsZVMvSU1f4RZwyu8iQXbVdeLlZrjuTT1jrY1uk5c7iZ7RsvhhluqAkq4JpVQAg7RJFtSu+xgJ8Pv6O1j5DkLxT8mkbfyRW5DrQmG7hiDIjCgBsADbjuof6YHLGeV6a5Q1Smx9joUXPpdaaDx97A/Wq00oJkdR7ZYuQRfS533JtxO1erduqWOYIt3wh0wpbLuCNIYkwxbswbikCUu2CDCS+Q+7rgVtfRcm+SOcdKPRlZ/rE7wNVUEE39KTS5uvUKN1PUnkloPkyzhyGQ8qkouEjJ3H/VXdqG6asSRiw3ecMlBvDDt8dDhBHXMwZ2Cajzjr7/76T+IavqPYvz6r7//E/3X3+N//h/0QozbjPgPiir69P/8X3/9F/yv8b/827/++98WItPu5/Hvwd8YPf5bp/2/lX/T/+Of/0MJ/lYTa+L/Ef+d9vN/3/2T6P/+jyTzu/evf6U7vxN7B6pJkRtAF6jUr8I+P8RsP/ptGhfqFk+pQ/DgAy6NJtRYJdXmp4gK7WLqLKJ+MaKhGjOojvL+SnIWrkpy0SLHDe4QuyNzaEA15mLMCcmE8Em+4HdOihW4/ZWuppJEmzeAwcDtv7MuLc9y2V5atvxXNe3S4DUMt5/Qy2LM9kSYKiVWBuKlfp4nxTntpuW03JbIlkiRvBXmT23g1I2OYe6IizUHPIq6zm6mbfsbteKmi/sg9J+ocQBMctGFO7iljo8TPN+z3jxw4do+ZwfqoR9dkNTKHyM305GpTkfhcHexVkPVGEbUOjuo9f0UMPHBFlGEx0SLvJvVRKTwW7PSew5oPme+E42+frJa9cGt2njS3dK5kIif2eYbhuSEQXEqMVfUjhGIuin0G0/W5ezJyJQy3SpMLai4M0JUWb5u1k9tny5bd1pPwYBpQuDCXZl62xg4CdVEAtflXHs6JKmP/pH6mOl796Lgopj0o8d5kKh00hxG3OSdEE/QBo9Hgr8JJqAeLDwJohG5j/DGh61Rc/+tf22/8kEnxHNCEjo0ElvvGfESZkqmz2BDcKV1H1buSkhkdg7p1IMGs2s17nYjpblrWuE2K9WEO/hcRp5e9oOF/QBmOaDtgil+oaU6szPrdwW65fOB0KUTsVUn7LFU7J8e6cxJIl9+FHw5MQMzuQJ+4oxMH3iW/5GK+hWuG0T+gTLs+fAjdtUd58TmIUq04EeyRCYCjkldow234aIgR5bqwrtZosZ+6YEqAmDqatJ9lWasz4IquKALPtd92hGI3Z2BdzzZue+REl1Om4DIWD+RrtUTOJLI+S0jHowXXdAxsGLSd40zYNuEUlOGhrwL6c7tcOtUOvpJCP7QBQS19H+GvZn05ewjlVLz+IGKoC9TyfQjLMBNmXCuqqtTdOSukZW48B0HqgSTCBrBnlFvF4CG2Su7yFzqmJFURK3UmTT3ru050r0ptUpMilYnBJWfl2Bv6kPlUuE1kxxpdzui9AubsR2N2boVSu81OulAwBqoSr1LZ0LLYOomyZHmjqnXlP72s8LnDouEJjtodBvdHaG1jMySYO7crWd90MpCRyCG14vb5IE7Arupw/y/RcCm/Tm3zK6zYj8PYNaGldiUfkB/LHWcmf2lVM+mwyU27a0qq2tscrQ/vzBjN26DnntIrOyGizzXK35yKQdYnUABkyN4saz3WD/viF+eCcsXnIajdWYJWaYHRstIis9CS+tqnFGmz2j5uzfr3Z4prqgK4XOT/PyftvjZqIm8lhkfxJ7Ol3CJF1piYBGAG8wtAk56Drw1YwmOpcz+NdfkSpSLplRXLXHL0Rquj6YW/gabqgK7Dgr6NwtH0B/AN7XrN+MVJ6AmXmUuqmQulrNNYPmH0RoDogydOKLo/QbfYNARSQQKISRCzRXU+q9WWJFL3LZW6u34CkeG97xC0NNGaJ0bvK6SnZS3zPskr5EtuCgjMWR5o2x5BqhKmDWJPRe7JMEOyRb5uUKlHaGVtq5ivSOaSliSXp9SQm2qk8MRJh10MAp9QQ2H5t59J8rjiwSZtoIfMGjlLPVNdYl/LBR0AO6WLGDmkLkIPRE45Y9MftdAK/yNu1Hn6tzOQTesgQ+8fSzB19wO91vCnO23vOWQdwJ63SJrYjdfKFW6W281PKs2k8iT9ai1cgJ4sa3xqdvmtxR8/+D1B8AKc2u+6JftryRhMWSQtoSBgIyyQGyxcnELuAasXN12oSriU4RMz1DD6RL0TSV+om7i1Yt+jEE/jnawM8cX/UhN4nkiv/w9eALrzNhXuQfOzFL0Fi6SjF7/4Qn8rLYBoa85cvgAnkCEBP+HPbEnquVXCZsMS/yzYw2Vru60P/+nJPYKkzZFjmbykzUoEqV836T5q3fP/L383dF82tx18/AZgZczMAgyeWYKmSZIqtHL+e+O4ZRcq9VI3g/qPeCoiK4pcgEqdbS0S/Be54sbVQOuJVPNBblIghzeasNu7h/g+Sz1IdhI5lCwq1nUb3Ji4OCIcqQZqtqJ5w7rXrg/DA9IgVmEGhDgGecEwnCTHffXcXs0V3OCEVzYDKS1vp/oX+ng+6XVU86UjA6FMO2RXOOOrqY1GgPvrAk9HV/BXtCu5RuwF8qgdGDLsBcui4E33ymdBip1X8uKyhIWT8qNRDsXz+gvO9UiEC0d8RG4Tf2x8H4slljgHtCBcxHLTWOYJm5H/fCPCzOgf9qgOUxTRZ0Pc6ha5yLuLVT9ntvIa6gacE99mCovdUumTQdRP4RPsS9129eEe2uSvvGh0bV4Y3QPPhPZMqhZWSMa5R0Hc1SGO4IVOQc0FrirlibTVfKRrYkD8kz3b+X65/QkUNaZdrdl3mCap0Hf3YcCw/LiouJYNbqz88UqeDYv93yO7vvXtgl4XCyAO4ODkY6W+83+LZU//p3/zXNGGrUKClCiOnL27iJZbNWDF02XXAOeFlB7IaADoMH1Yqr+UP9biyZDEa/iJt4MDeIz6GKTdLVBfWGVtRN4fdT2rgReX8UXwF2zOrradm4J0nyTgdPnai3RvzpZvCKDUqjOwD/QA6EDaMCLewX6QWYVnHY1sx1bd8ovYnPm1ZvPH+rE20lWjOCnZ66/xDt0QAl15FjfBcZp+i9OU0RNPQ0t3x2pSNWo8eiYudwsnuP1Hq6iH1LJCJynkYsfgJ0p3pF6SoQk2l+jqE8CPk+ziGJRSKjs+W5AO185umPdkYzlK4wl7TC9NxyyDP7ZoyYVoXiuS6SjnInlLWrwz1i8bGTKXX0AVQWkSfIlglW3zRJRJ8bg5VgE6ZEnqNu9B++0GNQvDQJvFize4ESNKBJP+8vA3LM4AX5SIBq08Mob+7QMTCZx4nwP/64+4BnlZC+8WtlP/CXw6t1PwMwkJ3jhP1FiXLhDF/3I6FGUzO2DSi9ABxKyyL9paZxSEz40ZCPQToDAJu1959k7QdbVxgB4icsu2s4zsTPJhcEDo+N1GX4zSk/wriRh8AqwL62972i9HJHd1ydaLXVzvKvOfGGw5RVcUVMiKXFH4APdkQU/dc5BX0YfKTNZYXCW9mb8bc8mufoQP6BbdQmT99ZjoYfr/go4TgQX9IDgztim7wyFeGMfbNaeqj8Dzs38pgcqwSv2hbqB3oSGKWKy+sesY7p57wAHldqE6NDudk/W7s/zjrK4rZFlFvaGxnSZdHbc1y47qDN6xkoK8O3bfr2j41dlJZ71rB4dlDqapPFa8N6xBrprUdtenUCHwxKNhw1uuTBh+9uU45k4REpQABN2bAO9DSLqoIL26gNroWgup5pUMxHUNSq4Gyz47vBPvilpo5f9OYI2ddAqTqmnxXERxQJ3UK8fHbVE9HagHi3+tqNRoNsArdmAxHA5LwtQo9ZAaNKUTljnokljo2x8scqVpEEIPc01fPCdHOCg0DeWBz8D5TVAAfx8aRH5X2ZYNI3ebKDZdeJ+oBDAxmRqJ30Eh2/DaeAy5diVNMpEDmXiPDsGTzBLXy8eVDdJoIafgx/gxMyQi454QrW56nCyeELgSuNNEmYkflF+t3CZQOVRWjKhIuCclmQSlAXT3+4JGG75B4t/5hQ+ldMP4LsAW6z3XmU6IJJwpnGVnsgUZhoY1fZlwTR8wSU7xRejf2uCx9Z5trVTRRJP9KnEb134dEieil6eCOGWgboI7xsqsqM99jfJLTePjygKlH2CVxxsse9QRzTBFjD/Kjqitr/CCTBt/SJ6nLxz7cKP9pFqBpp0lN5y+adKNsZjrPuroemZauH9aTTFD3EKHW8S55XBLFQAt1jgxTQCTwxmx/JyfsZDN1RroN3VaxpSenpIX7K+ZbL8VdlQDcI4Cbzg3QJLa9yVqNxUelu+EtxLVqeekaAvSJkO6sSVqbUajxqhKshNpvZqoeApF0k/0P0ikkwUcbdwc4A1ejN7Oo0O15kG7hTMoK3hZRBCX7YYeLW0wvcXx/18n/u37yLgzBYVBUvORGli+sfRcX/74uD6P4hq+7xu54TlWJLFzT63uwUDwuEDdOjJQqx7JV+ZjaEAPi7t0MMrR4Q8Rkf18uxD6RK0RKh0hL8YU+DeL97i4pa5ZSyAfXKwZRS/8gXcxdZXm62RBDj8U3sN8x95b5PpPs/mCBKYvpaA50pN5Ct/499AFTtwQ5vgeSh+NHrKIi4NVpwM/XzRaNfJD856lPE6M21zWPguFsH7jbLVyEDfRmt4VwrhCJ5VTYmcSPfGgO5clfN+vbaDZ7sakU5+2vZ2WCDY031NxJarVytfDDVtiafcTGO2rJ/taoL3zChN2qmjxofczTOYQPPVQPh0JVtYgdUQINcSiNEEy58UdYXX1MpWUCEBx7LbcGtAm8XWRQTVOaoV3ySri4RShhs/B/0m4jX6OAwXOvcA09bNSG4czEGv/Wey6V/jbTCNTW6awXdNTcA1GsPe1E9fZdGl7R0vyoVpIdJtfC6d32NNErrvq/R+d65VG+YOwRXppXxOCYyGNSf1K3x6VxAW/vtz4EC1SgCOSPdN62sLsoIzuDfg8GwZAbquVO8HIuFP/ToVoeUB7nnwMF35a1wK1tI6fkrqFKhQdeJpwyls0pIy8AZde3/6LUUbFaYJthyUJSU/kqDXTLQElnn0Jr4B2RVghNrmNmoEn7pXIeshPguXVsvwoTdmClq49JJU3LWhHyWTrJL9bRP6VKv3tZoA/th77p5Jw++OEENvyvWy/pNeExiDUVQaXIRGh8xySZTI36yueFaSXo1uJY0RnXYgEOoWWOJHeaVuX/bGNhHsh2yinznl/++NJcE9j6fBPRcBdq9hb8awNw8U7Bl6GM7x69EDOIIbX/npZ++amlHR9L/35mE/2Ss4gb0xCcY4VyTFLRE796vHysLAamqcyO+aFQyJIDBNslbH2/MrAvZiSEIedc/cqjmv4fbda2pXbv+F5a2szSsdkm9noiNURXt8edUhGUF6fSZWd1IJaXKFwD+49R6eCXD4Bkef7j9tRtNMVgW8BhRz/Qpy1TmeYk0doyjZoJSbePOReVHgkFsCFuQJ+Lgc4BxeAsK/cOiNDRmdNw0ctYhn/nQ498dYI5znzGLoJi1rav7Cn88rL3wLePVtDK5gl77Tki3gHEsIAQ2+IKgarj7Y8W1IQzV5V9N+0TjLqbg68WfKcOmBCOj3JkwJhVIkwDhc+JorXuZEPMEh0vvH3x7iqf+VAwXgd4diZiaJD1zHL9Snx6Wfg4IugreyhabQkcir+y5XgDtdx3Avs7lkeeCBwDvZoTUCXx5QrZkcEqWfYEiEYRs/EphmRALSNGR1Iclgdr5VFoELpzF4++f35w3/j0t5ucW3n2ch4PQCLuUXupsPRR7UA5FjSKrMtPcKAZJfagO4lGE7FH3YKMjorpK0ZxAv+i2JkJhtAMWWWFej4RhPR/cJ3DxwocCvXDi4SGZU4cu+K32XndiFWgopAl+0GApcwf1XvymJcFs39jExIBO4yUjU9MExBLQYc9H+W7+IgdESPRpciT+rKZPebVtaVq+1GYO/5xTAL3HASjNTGIgMvdjWbgc7JvdE1zIFpuC0U9ESiZyzBixzxWxj4Kwh8My34q+FK3KNLtmsA1qyrmKSNQOXCPUZd+ONelBTvFoUI/CYsqa/RhtKiyMf2CgSFqEPk59Y3uqnlZ8gFpswfSYyko23yVZYxzKGxGm49Zqxg1l8oz5Ra9XaRwHkuxepmgyhm0SoNy2KlbcEqK+9QqS9PNx9Ihm9U7gsR55SSJ1FBDNnkuWKxIZ0SDpXuOGwZdoUbOMDPHP4vBAgz2VlSEJAHZGJVbYIg7l/FO5KfIVvxC8pPPxMGcNMoevFDeStt2iqztE10n2TA4dgJH76YS9HDhKHD3iCx6ieFX84BAI3QQnngh76f5ruPQVbr5qZmck/5UjDc26lfrOvUBWy0Ogl8bCoOkMOns81TnC3cuUS9KW8+9A+fe3XYZOFUPG1u5epSSmDLw0s5s2F0W30ANeo+zJkJQz9SPZgzwYpEoktofhGVfmLOAB20boCbW1QWq/NpET/hnMecw/uSyAH4NJc3ECOU4nnkK1fj3S/i5dwb3R7k00AqQQUwt7Ie1qV0aY/VQX0J8hLPy7eBNXMHYZYDNxHZ2Qh6AuXJxq+AeRec/Q+JLhZV6hpXwQEzw7bf5v9uUf2vpq3qlhmy0IIGTkwYdCfSAFmqbdo+3XvDTDjFJde0mbeQLcn2n31xaAqJ0ixO/CLsT4I4G4DoncVTgRGNBtsCcjISWT+oeXZ4Iedw/8OsJI1aPnNKLX/60VvcZb94uasRxCkqlPQ11u1Sa2hHvB80WQENxVyzjns0/PiEByyil21Te6oisk3mNCEMrhouCFO3yEZTHHOCMy9eb/4Tmi8cVf3Lf7P53SY2hX3PSN033As3ETIMLHWumWEO9JXHA2y2SIBlIPpLGG2qvNsCIlIr+B1SWAqRKm2w6Blf7U+zCSBwJrfHG5i8J5Gax/cVonMlon7aHJX/gSvucIncRP93XCqkv7D8IFKFsLiBgHqUpXhE3pYjEcV1dk/JD9zFVCfEaQIVX8Jmfz7IIofcBKQ4OaG+C3xC2veX9CD+iAFXDNaGg9eTVxvkbJRJlW4Nk9Wk13kn696jWppRDe/8pDrYMO9ZyxZ98ReKSz9kWKLLyk2zCZgAniCkLJVX3n1M9DYbomyahWiv/KixRIV9hj/oFz87I+HLznbPTjpa+D+bZQnMuRsljTpv90vQUt/pK7jCFnA30B/jtroSF2/m/gpWn1aQs5WeA6ghzF8SdqWI20fghdSeDOCSCmLgTkfaGgGDmw7nHFkRzGtag57IHS2na06I+gzEphXo1w/Zx2BM/jKL2nZoFjHggtFQjYi8nSVRSXIE58RPbBObXk7uuIL9+rs/5Zo7suJInEUxgsiZZAWS25iBtpEiZeBgDtghEoAE0sjcayNq85M4tbu/LF5h51335PsGzQ09O875+vUS89lkWMyNOFoip2PuyWyMP/iU2XIZdfCCJNDjebDoBLQdpy7QQZC7s9c0wjHJervQNDu2jWzBW5MSAJMr7bP+Iv92BkS/GGgzjEn7MF1IRKFwwzbjbS4/slGOmhx9cZrFu7HSEefojNv3r0UaKfKOWzXsq1zEugbzlMDFsacRJJI/iJlK3vtkZ+PLZIVMFlKA32wbq2Kd5T0uCLZ1CPkAfCdzkz2EYscjDcZq2AWfziN2covN4kXE1lQXPPLTNM1xx3tbiepcO/t3SWm4w87qfh99SL0ZnY+LKFPLPeXVM2mIIoVWt+9Nk0I7nY4O79iGYqxZ8RVz289an6NVdJWnSKZvJQCAuHNiVaDxPAFoH392t9wot5t0/qmU95eEWNbU2udUW5sN9JVqcYlvAIfLeYC33oUzzxZgSktsv21mA7Uly1FA5VnoJFh6N244Wmv3YJGFv/TCPryaw+ZORlpZjQdq/2DYXr3EZskfed0G61P09ipTKmlTQ1067Rg5+PAk5FlQ9e0SWbGf2B/08kqymOTMVOznsALHHNFH4LFRKl2F/NOiYFl9khNHnSu9Ak5sq26Ynl/i2fdTle29Y1ugqmR5Yj4YT9pvslFyYCbw0mNFr5rVQm1LvkG27QMq9ph3t8fmn6r6SQ4oSbr5tz+J1kIawGzDxb6VYOvvWhobDTXfBeNv3b4aNm5XUinsCGqG2q/45m3+LoCOsddFceYhRx1Tsss9PLdPfJdErFMjYd3gddjiP0+XQjcRadZP6bwNLySvunFf20Czy6JqdEW2a96KxdYdOryBv1BjbuUq2yCHeh+6sk7fGmmPi50pe/1l5TyPe5oHW9oPnhPswLyf2TFDdCyYlhwBCstv5C1HwlW7xWoGT9XZt4qVj5WryLPLLD6h/5cMLEjWzgCeAIKNsLak92aBqBsHl4AJwl2N4jfvbSkBExGimv0nFvv09uDScQbjx+w4kPQjgjlW+g9ws9VEJvI2k8N6XxVu0uIwovgTFdunG24gBtaDi+y1YLQwZ8mwbip5fVlO3k0n0AEr/ETbtu8Vjkm+nNSiEb7X/3fMjBL5A8PdgG+/FnbexbFFExmEfetXAnisEKy5z44WVPpQZjSy/jzeGn4yDRsFGqhh87QPaDBWhlo37IFbe/C0xynS91d2tP/AJoJS0sVF6iwAAAAAElFTkSuQmCC");
}

#menu::after {
  display: block;
  content: '';
  padding-top: 80px;
}

#logo {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(255,255,255,.1);
  font-size: 11px;
  display: block;
  width: 20px;
  height: 20px;
  line-height: 20px;
  text-align: center;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  -webkit-box-shadow: 0 0 3px rgba(0,0,0,.2);
  -moz-box-shadow: 0 0 3px rgba(0,0,0,.2);
  color: inherit;
}

#menu li a {
  display: block;
  color: white;
  padding: 0 35px 0 25px;
  -webkit-transition: background 300ms;
  -moz-transition: background 300ms;
}

#menu li {
  position: relative;
  list-style: none;
}

#menu a:hover,
#menu a.active {
  text-decoration: none;
  background: rgba(255,255,255,.1);
}

#menu li:hover .cov {
  opacity: 1;
}

#menu li .dirname {
  opacity: .60;
  padding-right: 2px;
}

#menu li .basename {
  opacity: 1;
}

#menu .cov {
  background: rgba(0,0,0,.4);
  position: absolute;
  top: 0;
  right: 8px;
  font-size: 9px;
  opacity: .6;
  text-align: left;
  width: 17px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  padding: 2px 3px;
  text-align: center;
}

#stats:nth-child(2n) {
  display: inline-block;
  margin-top: 15px;
  border: 1px solid #eee;
  padding: 10px;
  -webkit-box-shadow: inset 0 0 2px #eee;
  -moz-box-shadow: inset 0 0 2px #eee;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
}

#stats div {
  float: left;
  padding: 0 5px;
}

#stats::after {
  display: block;
  content: '';
  clear: both;
}

#stats .sloc::after {
  content: ' SLOC';
  color: #b6b6b6;
}

#stats .percentage::after {
  content: ' coverage';
  color: #b6b6b6;
}

#stats .hits,
#stats .misses {
  display: none;
}

.high {
  color: #00d4b4;
}
.medium {
  color: #e87d0d;
}
.low {
  color: #d4081a;
}
.terrible {
  color: #d4081a;
  font-weight: bold;
}

table {
  width: 80%;
  margin-top: 10px;
  border-collapse: collapse;
  border: 1px solid #cbcbcb;
  color: #363636;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
}

table thead {
  display: none;
}

table td.line,
table td.hits {
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  color: #949494;
}

table td.hits {
  width: 10px;
  padding: 2px 5px;
  color: rgba(0,0,0,.2);
  background: #f0f0f0;
}

tr.miss td.line,
tr.miss td.hits {
  background: #e6c3c7;
}

tr.miss td {
  background: #f8d5d8;
}

td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monaco, monospace;
}

code .comment { color: #ddd }
code .init { color: #2F6FAD }
code .string { color: #5890AD }
code .keyword { color: #8A6343 }
code .number { color: #2F6FAD }
</style></head><body><div id="coverage"><h1 id="overview">Coverage</h1><div id="menu"><li><a href="#overview">overview</a></li><li><span class="cov high">80</span><a href="#/Users/philipp/code/neo4jmapper/src/graph.js"><span class="dirname">/Users/philipp/code/neo4jmapper/src/</span><span class="basename">graph.js</span></a></li><li><span class="cov low">41</span><a href="#/Users/philipp/code/neo4jmapper/src/helpers.js"><span class="dirname">/Users/philipp/code/neo4jmapper/src/</span><span class="basename">helpers.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/philipp/code/neo4jmapper/src/index.js"><span class="dirname">/Users/philipp/code/neo4jmapper/src/</span><span class="basename">index.js</span></a></li><li><span class="cov medium">72</span><a href="#/Users/philipp/code/neo4jmapper/src/neo4jrestful.js"><span class="dirname">/Users/philipp/code/neo4jmapper/src/</span><span class="basename">neo4jrestful.js</span></a></li><li><span class="cov high">82</span><a href="#/Users/philipp/code/neo4jmapper/src/node.js"><span class="dirname">/Users/philipp/code/neo4jmapper/src/</span><span class="basename">node.js</span></a></li><li><span class="cov high">88</span><a href="#/Users/philipp/code/neo4jmapper/src/path.js"><span class="dirname">/Users/philipp/code/neo4jmapper/src/</span><span class="basename">path.js</span></a></li><li><span class="cov high">78</span><a href="#/Users/philipp/code/neo4jmapper/src/relationship.js"><span class="dirname">/Users/philipp/code/neo4jmapper/src/</span><span class="basename">relationship.js</span></a></li><a id="logo" href="http://visionmedia.github.com/mocha/">m</a></div><div id="stats" class="medium"><div class="percentage">72%</div><div class="sloc">1904</div><div class="hits">1388</div><div class="misses">516</div></div><div id="files"><div class="file"><h2 id="/Users/philipp/code/neo4jmapper/src/graph.js">/Users/philipp/code/neo4jmapper/src/graph.js</h2><div id="stats" class="high"><div class="percentage">80%</div><div class="sloc">56</div><div class="hits">45</div><div class="misses">11</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var initGraph = function(neo4jrestful) {</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">4</td><td class="source">  var _       = null</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">    , helpers = null;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">4</td><td class="source">  if (typeof window === 'object') {</td></tr><tr class="miss"><td class="line">7</td><td class="hits">0</td><td class="source">    helpers = neo4jmapper_helpers;</td></tr><tr class="miss"><td class="line">8</td><td class="hits">0</td><td class="source">    _       = window._();</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">4</td><td class="source">    helpers = require('./helpers');</td></tr><tr class="hit"><td class="line">11</td><td class="hits">4</td><td class="source">    _       = require('underscore');</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">   * Constructor</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">17</td><td class="hits">4</td><td class="source">  Graph = function() {</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    // this.about();</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">4</td><td class="source">  Graph.prototype.info = null;</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">   * Shorthand for neo4jrestul.query</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">26</td><td class="hits">4</td><td class="source">  Graph.prototype.query = function(cypher, options, cb) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">15</td><td class="source">    return neo4jrestful.query(cypher,options,cb);</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">   * Delete *all* nodes and *all* relationships</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">   */ </td></tr><tr class="hit"><td class="line">33</td><td class="hits">4</td><td class="source">  Graph.prototype.wipeDatabase = function(cb) {</td></tr><tr class="miss"><td class="line">34</td><td class="hits">0</td><td class="source">    var query = &quot;START n=node(*) MATCH n-[r?]-() DELETE n, r;&quot;;</td></tr><tr class="miss"><td class="line">35</td><td class="hits">0</td><td class="source">    return this.query(query,cb);</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">4</td><td class="source">  Graph.prototype.countAllOfType = function(type, cb) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">13</td><td class="source">    var query = '';</td></tr><tr class="hit"><td class="line">40</td><td class="hits">13</td><td class="source">    if      (/^n(ode)*$/i.test(type))</td></tr><tr class="hit"><td class="line">41</td><td class="hits">4</td><td class="source">      query = &quot;START n=node(*) RETURN count(n);&quot;</td></tr><tr class="hit"><td class="line">42</td><td class="hits">9</td><td class="source">    else if (/^r(elationship)*$/i.test(type))</td></tr><tr class="hit"><td class="line">43</td><td class="hits">8</td><td class="source">      query = &quot;START r=relationship(*) RETURN count(r);&quot;;</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">    else if (type[0] === 'path')</td></tr><tr class="miss"><td class="line">45</td><td class="hits">0</td><td class="source">      query = &quot;START p=path(*) RETURN count(p);&quot;</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">    else if (/^[nr]\:.+/.test(type))</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">      // count labels</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">      query = &quot;MATCH &quot;+type+&quot; RETURN &quot;+type[0]+&quot;;&quot;;</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">50</td><td class="hits">1</td><td class="source">      query = &quot;START n=node(*) MATCH n-[r?]-() RETURN count(n), count(r);&quot;;</td></tr><tr class="hit"><td class="line">51</td><td class="hits">13</td><td class="source">    return this.query(query,function(err,data){</td></tr><tr class="hit"><td class="line">52</td><td class="hits">13</td><td class="source">      if ((data)&amp;&amp;(data.data)) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">13</td><td class="source">        var count = data.data[0][0];</td></tr><tr class="hit"><td class="line">54</td><td class="hits">13</td><td class="source">        if (typeof data.data[0][1] !== 'undefined')</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">          count += data.data[0][1];</td></tr><tr class="hit"><td class="line">56</td><td class="hits">13</td><td class="source">        return cb(err, count);</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">58</td><td class="hits">0</td><td class="source">      cb(err,data);</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">4</td><td class="source">  Graph.prototype.countRelationships = function(cb) {</td></tr><tr class="hit"><td class="line">63</td><td class="hits">8</td><td class="source">    return this.countAllOfType('relationship', cb);</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">4</td><td class="source">  Graph.prototype.countNodes = function(cb) {</td></tr><tr class="hit"><td class="line">67</td><td class="hits">4</td><td class="source">    return this.countAllOfType('node', cb);</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">4</td><td class="source">  Graph.prototype.countAll = function(cb) {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">    return this.countAllOfType('all', cb);</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  // Graph.prototype.countWithLabel = function() { }</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">76</td><td class="hits">4</td><td class="source">  Graph.prototype.indexLabel = function(label, field, cb) {</td></tr><tr class="miss"><td class="line">77</td><td class="hits">0</td><td class="source">    if ((!_.isString(label))&amp;&amp;(!_.isString(field)))</td></tr><tr class="miss"><td class="line">78</td><td class="hits">0</td><td class="source">      return cb(Error('label and field are mandatory arguments to create index on'))</td></tr><tr class="miss"><td class="line">79</td><td class="hits">0</td><td class="source">    this.query('CREATE INDEX ON :'+label+'('+field+');', cb);</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">82</td><td class="hits">4</td><td class="source">  Graph.prototype.about = function(cb) {</td></tr><tr class="hit"><td class="line">83</td><td class="hits">2</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">84</td><td class="hits">2</td><td class="source">    if (this.info)</td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">      return cb(null,info);</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">87</td><td class="hits">2</td><td class="source">      return neo4jrestful.get('/db/data/', function(err, info){</td></tr><tr class="hit"><td class="line">88</td><td class="hits">2</td><td class="source">        if (info) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">2</td><td class="source">          self.info = info</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">91</td><td class="hits">2</td><td class="source">        if (typeof cb === 'function')</td></tr><tr class="hit"><td class="line">92</td><td class="hits">2</td><td class="source">          cb(err,info);</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">96</td><td class="hits">4</td><td class="source">  Graph.prototype.log = function(){ /* &gt; /dev/null */ };</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">98</td><td class="hits">4</td><td class="source">  return Graph;</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">101</td><td class="hits">1</td><td class="source">if (typeof window !== 'object') {</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">  // nodejs</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">  module.exports = exports = function(neo4jrestful) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">4</td><td class="source">    return initGraph(neo4jrestful);</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/Users/philipp/code/neo4jmapper/src/helpers.js">/Users/philipp/code/neo4jmapper/src/helpers.js</h2><div id="stats" class="low"><div class="percentage">41%</div><div class="sloc">384</div><div class="hits">159</div><div class="misses">225</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var neo4jmapper_helpers = {};</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">(function(){</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">  var _ = null;</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">  if (typeof window === 'object') {</td></tr><tr class="miss"><td class="line">8</td><td class="hits">0</td><td class="source">    _ = window._;</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">    _ = require('underscore');</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">  var _is_operator = /^\$(AND|OR|NOT|AND\$NOT|OR\$NOT)$/i;</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">  var sortStringAndOptionsArguments = function(string, options) {</td></tr><tr class="miss"><td class="line">16</td><td class="hits">0</td><td class="source">    if (typeof string === 'object') {</td></tr><tr class="miss"><td class="line">17</td><td class="hits">0</td><td class="source">      return { string: null, options: string };</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">19</td><td class="hits">0</td><td class="source">    return {</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">      string: string || null,</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">      options: options || {}</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">  var sortOptionsAndCallbackArguments = function(options, callback) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">312</td><td class="source">    if (typeof options === 'function') {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">93</td><td class="source">      return { options: {}, callback: options };</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">29</td><td class="hits">219</td><td class="source">    return {</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">      options: options || {},</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">      callback: callback</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">  var sortStringAndCallbackArguments = function(string, callback) {</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">    if (typeof string === 'function') {</td></tr><tr class="miss"><td class="line">37</td><td class="hits">0</td><td class="source">      callback = string;</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">      string = null;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">    return {</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">      callback: callback,</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">      string: string</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">  var getIdFromObject = function(o) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">22</td><td class="source">    if ((typeof o === 'object') &amp;&amp; (o.id))</td></tr><tr class="hit"><td class="line">48</td><td class="hits">19</td><td class="source">      return o.id;</td></tr><tr class="hit"><td class="line">49</td><td class="hits">3</td><td class="source">    if (!isNaN(parseInt(o)))</td></tr><tr class="hit"><td class="line">50</td><td class="hits">3</td><td class="source">      return parseInt(o);</td></tr><tr class="miss"><td class="line">51</td><td class="hits">0</td><td class="source">    return null;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  // source: https://gist.github.com/penguinboy/762197</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">  var flattenObject = function(ob) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">229</td><td class="source">    var toReturn = {};</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">58</td><td class="hits">229</td><td class="source">    for (var i in ob) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">268</td><td class="source">      if (!ob.hasOwnProperty(i)) continue;</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">      </td></tr><tr class="hit"><td class="line">61</td><td class="hits">268</td><td class="source">      if ((typeof ob[i]) === 'object') {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">50</td><td class="source">        var flatObject = flattenObject(ob[i]);</td></tr><tr class="hit"><td class="line">63</td><td class="hits">50</td><td class="source">        for (var x in flatObject) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">60</td><td class="source">          if (!flatObject.hasOwnProperty(x)) continue;</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">          </td></tr><tr class="hit"><td class="line">66</td><td class="hits">60</td><td class="source">          toReturn[i + '.' + x] = flatObject[x];</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">69</td><td class="hits">218</td><td class="source">        toReturn[i] = ob[i];</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">72</td><td class="hits">229</td><td class="source">    return toReturn;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">  // source: https://github.com/hughsk/flat/blob/master/index.js</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">  var unflattenObject = function (target, opts) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">406</td><td class="source">    var opts = opts || {}</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">      , delimiter = opts.delimiter || '.'</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">      , result = {}</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">81</td><td class="hits">406</td><td class="source">    if (Object.prototype.toString.call(target) !== '[object Object]') {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">282</td><td class="source">        return target</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">124</td><td class="source">    function getkey(key) {</td></tr><tr class="hit"><td class="line">86</td><td class="hits">744</td><td class="source">        var parsedKey = parseInt(key)</td></tr><tr class="hit"><td class="line">87</td><td class="hits">744</td><td class="source">        return (isNaN(parsedKey) ? key : parsedKey)</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">90</td><td class="hits">124</td><td class="source">    Object.keys(target).forEach(function(key) {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">282</td><td class="source">        var split = key.split(delimiter)</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">          , firstNibble</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">          , secondNibble</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">          , recipient = result</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">96</td><td class="hits">282</td><td class="source">        firstNibble = getkey(split.shift())</td></tr><tr class="hit"><td class="line">97</td><td class="hits">282</td><td class="source">        secondNibble = getkey(split[0])</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">99</td><td class="hits">282</td><td class="source">        while (secondNibble !== undefined) {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">90</td><td class="source">            if (recipient[firstNibble] === undefined) {</td></tr><tr class="hit"><td class="line">101</td><td class="hits">80</td><td class="source">                recipient[firstNibble] = ((typeof secondNibble === 'number') ? [] : {})</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">104</td><td class="hits">90</td><td class="source">            recipient = recipient[firstNibble]</td></tr><tr class="hit"><td class="line">105</td><td class="hits">90</td><td class="source">            if (split.length &gt; 0) {</td></tr><tr class="hit"><td class="line">106</td><td class="hits">90</td><td class="source">                firstNibble = getkey(split.shift())</td></tr><tr class="hit"><td class="line">107</td><td class="hits">90</td><td class="source">                secondNibble = getkey(split[0])</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">        // unflatten again for 'messy objects'</td></tr><tr class="hit"><td class="line">112</td><td class="hits">282</td><td class="source">        recipient[firstNibble] = unflattenObject(target[key])</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">115</td><td class="hits">124</td><td class="source">    return result</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">  var escapeString = function(s) {</td></tr><tr class="hit"><td class="line">119</td><td class="hits">28</td><td class="source">    if (typeof s !== 'string')</td></tr><tr class="miss"><td class="line">120</td><td class="hits">0</td><td class="source">      return s;</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">    // trim quotes if exists</td></tr><tr class="hit"><td class="line">122</td><td class="hits">28</td><td class="source">    if ( (/^&quot;.+&quot;$/.test(s)) || (/^'.+'$/.test(s)) )</td></tr><tr class="miss"><td class="line">123</td><td class="hits">0</td><td class="source">      s = s.substr(1,s.length-2);</td></tr><tr class="hit"><td class="line">124</td><td class="hits">28</td><td class="source">    return s.replace(/([^\\]){1}(['&quot;])/g,'$1\\$2');</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">127</td><td class="hits">1</td><td class="source">  var cypherKeyValueToString = function(key, value, identifier) {</td></tr><tr class="hit"><td class="line">128</td><td class="hits">40</td><td class="source">    if (typeof identifier === 'string')</td></tr><tr class="hit"><td class="line">129</td><td class="hits">22</td><td class="source">      key = identifier+'.`'+key+'`';</td></tr><tr class="hit"><td class="line">130</td><td class="hits">40</td><td class="source">    if (_.isRegExp(value)) {</td></tr><tr class="hit"><td class="line">131</td><td class="hits">8</td><td class="source">      var s = value.toString().replace(/^\/(\^)*(.+?)\/[ig]*$/, (value.ignoreCase) ? '$1(?i)$2' : '$1$2');//(?i)</td></tr><tr class="hit"><td class="line">132</td><td class="hits">8</td><td class="source">      return key+&quot; =~ '&quot;+s+&quot;'&quot;;</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">134</td><td class="hits">32</td><td class="source">    else if (_.isNumber(value))</td></tr><tr class="hit"><td class="line">135</td><td class="hits">8</td><td class="source">      return key+&quot; = &quot;+value;</td></tr><tr class="hit"><td class="line">136</td><td class="hits">24</td><td class="source">    else if (_.isBoolean(value))</td></tr><tr class="hit"><td class="line">137</td><td class="hits">2</td><td class="source">      return key+&quot; = &quot;+String(value);</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">139</td><td class="hits">22</td><td class="source">      return key+&quot; = '&quot;+escapeString(value)+&quot;'&quot;;</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">   * Builds a string from mongodb-like-query object</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">145</td><td class="hits">1</td><td class="source">  var conditionalParameterToString = function(condition, operator, options) {</td></tr><tr class="hit"><td class="line">146</td><td class="hits">67</td><td class="source">    var defaultOptions = {</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">      firstLevel: true,</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">      identifier: null</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">150</td><td class="hits">67</td><td class="source">    if (typeof options === 'undefined')</td></tr><tr class="hit"><td class="line">151</td><td class="hits">3</td><td class="source">      options = defaultOptions;</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">153</td><td class="hits">64</td><td class="source">      options = _.extend({}, defaultOptions, options);</td></tr><tr class="hit"><td class="line">154</td><td class="hits">67</td><td class="source">    if (options.firstLevel)</td></tr><tr class="hit"><td class="line">155</td><td class="hits">54</td><td class="source">      options.firstLevel = false;</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">    // TODO: if $not : [ {name: 'a'}] ~&gt; NOT (name = a)</td></tr><tr class="hit"><td class="line">157</td><td class="hits">67</td><td class="source">    if (typeof condition === 'string')</td></tr><tr class="hit"><td class="line">158</td><td class="hits">33</td><td class="source">      condition = [ condition ];</td></tr><tr class="hit"><td class="line">159</td><td class="hits">67</td><td class="source">    if (typeof operator === 'undefined')</td></tr><tr class="hit"><td class="line">160</td><td class="hits">54</td><td class="source">      operator = 'AND';</td></tr><tr class="hit"><td class="line">161</td><td class="hits">67</td><td class="source">    _.each(condition,function(value, key){</td></tr><tr class="hit"><td class="line">162</td><td class="hits">82</td><td class="source">      if ( (_is_operator.test(key)) &amp;&amp; (_.isArray(condition[key])) ) {</td></tr><tr class="miss"><td class="line">163</td><td class="hits">0</td><td class="source">        condition[key] = conditionalParameterToString(condition[key], key.replace(/\$/g,' ').trim().toUpperCase(), options);</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">165</td><td class="hits">82</td><td class="source">        if (_.isObject(condition[key])) {</td></tr><tr class="hit"><td class="line">166</td><td class="hits">48</td><td class="source">          var properties = [];</td></tr><tr class="hit"><td class="line">167</td><td class="hits">48</td><td class="source">          var firstKey = (_.keys(value)) ? _.keys(value)[0] : null;</td></tr><tr class="hit"><td class="line">168</td><td class="hits">48</td><td class="source">          if ((firstKey)&amp;&amp;(_is_operator.test(firstKey))) {</td></tr><tr class="hit"><td class="line">169</td><td class="hits">13</td><td class="source">            properties.push(conditionalParameterToString(condition[key][firstKey], firstKey.replace(/\$/g,' ').trim().toUpperCase(), options));</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">          } else {</td></tr><tr class="hit"><td class="line">171</td><td class="hits">35</td><td class="source">            _.each(condition[key], function(value, key) {</td></tr><tr class="hit"><td class="line">172</td><td class="hits">41</td><td class="source">              if (value === key) {</td></tr><tr class="hit"><td class="line">173</td><td class="hits">1</td><td class="source">                properties.push(value);</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">              } else {</td></tr><tr class="hit"><td class="line">175</td><td class="hits">40</td><td class="source">                properties.push(cypherKeyValueToString(</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">                  key,</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">                  value, </td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">                  // only add an identifier if we have NOT s.th. like</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">                  // n.name = ''  or r.since …</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">                  (/^[a-zA-Z\_\-]+\./).test(key) ? null : options.identifier</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">                ));</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">              }</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">185</td><td class="hits">48</td><td class="source">          condition[key] = properties.join(' '+operator+' ');</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">189</td><td class="hits">67</td><td class="source">    if ((condition.length === 1)&amp;&amp;(options.firstLevel === false)&amp;&amp;(/NOT/i.test(operator)))</td></tr><tr class="hit"><td class="line">190</td><td class="hits">2</td><td class="source">      return operator + ' ( '+condition.join('')+' )';</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">192</td><td class="hits">65</td><td class="source">      return '( '+condition.join(' '+operator+' ')+' )';</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">195</td><td class="hits">1</td><td class="source">  var extractAttributesFromCondition = function(condition, attributes) {</td></tr><tr class="hit"><td class="line">196</td><td class="hits">117</td><td class="source">    if (typeof attributes === 'undefined')</td></tr><tr class="hit"><td class="line">197</td><td class="hits">52</td><td class="source">      attributes = [];</td></tr><tr class="hit"><td class="line">198</td><td class="hits">117</td><td class="source">    _.each(condition, function(value, key) {</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">200</td><td class="hits">686</td><td class="source">      if (_.isObject(value)) {</td></tr><tr class="hit"><td class="line">201</td><td class="hits">65</td><td class="source">        extractAttributesFromCondition(condition[key], attributes);</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">203</td><td class="hits">686</td><td class="source">      if ( (!_is_operator.test(key)) &amp;&amp; (/^[a-zA-Z\_\-\.]+$/.test(key)) ) {</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">        // remove identifiers if exists</td></tr><tr class="hit"><td class="line">205</td><td class="hits">37</td><td class="source">        attributes.push(key.replace(/^[abnr]{1}\./,''));</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">208</td><td class="hits">117</td><td class="source">    return _.uniq(attributes);</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">211</td><td class="hits">1</td><td class="source">  var constructorNameOfFunction = function(func) {</td></tr><tr class="hit"><td class="line">212</td><td class="hits">319</td><td class="source">    var name = func.constructor.toString().match(/^function\s(.+?)\(/)[1];</td></tr><tr class="hit"><td class="line">213</td><td class="hits">319</td><td class="source">    if (name === 'Function') {</td></tr><tr class="hit"><td class="line">214</td><td class="hits">66</td><td class="source">      name = func.toString().match(/^function\s(.+)\(/)[1]</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">216</td><td class="hits">319</td><td class="source">    return name;</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">  /* sprintf() for JavaScript 0.7-beta1</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">   * http://www.diveintojavascript.com/projects/javascript-sprintf</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source">   * Copyright (c) Alexandru Marasteanu &lt;alexaholic [at) gmail (dot] com&gt;</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">   * All rights reserved.</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">   * Took from the underscore.string library,</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">   * included to reduce dependencies</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">228</td><td class="hits">1</td><td class="source">  var sprintf = (function() {</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">230</td><td class="hits">1</td><td class="source">    var str_repeat = function(str, qty){</td></tr><tr class="miss"><td class="line">231</td><td class="hits">0</td><td class="source">      if (qty &lt; 1) return '';</td></tr><tr class="miss"><td class="line">232</td><td class="hits">0</td><td class="source">      var result = '';</td></tr><tr class="miss"><td class="line">233</td><td class="hits">0</td><td class="source">      while (qty &gt; 0) {</td></tr><tr class="miss"><td class="line">234</td><td class="hits">0</td><td class="source">        if (qty &amp; 1) result += str;</td></tr><tr class="miss"><td class="line">235</td><td class="hits">0</td><td class="source">        qty &gt;&gt;= 1, str += str;</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">237</td><td class="hits">0</td><td class="source">      return result;</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">240</td><td class="hits">1</td><td class="source">    function get_type(variable) {</td></tr><tr class="hit"><td class="line">241</td><td class="hits">943</td><td class="source">      return Object.prototype.toString.call(variable).slice(8, -1).toLowerCase();</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">244</td><td class="hits">1</td><td class="source">    var str_format = function() {</td></tr><tr class="hit"><td class="line">245</td><td class="hits">77</td><td class="source">      if (!str_format.cache.hasOwnProperty(arguments[0])) {</td></tr><tr class="hit"><td class="line">246</td><td class="hits">9</td><td class="source">        str_format.cache[arguments[0]] = str_format.parse(arguments[0]);</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">248</td><td class="hits">77</td><td class="source">      return str_format.format.call(null, str_format.cache[arguments[0]], arguments);</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">251</td><td class="hits">1</td><td class="source">    str_format.format = function(parse_tree, argv) {</td></tr><tr class="hit"><td class="line">252</td><td class="hits">77</td><td class="source">      var cursor = 1, tree_length = parse_tree.length, node_type = '', arg, output = [], i, k, match, pad, pad_character, pad_length;</td></tr><tr class="hit"><td class="line">253</td><td class="hits">77</td><td class="source">      for (i = 0; i &lt; tree_length; i++) {</td></tr><tr class="hit"><td class="line">254</td><td class="hits">943</td><td class="source">        node_type = get_type(parse_tree[i]);</td></tr><tr class="hit"><td class="line">255</td><td class="hits">943</td><td class="source">        if (node_type === 'string') {</td></tr><tr class="hit"><td class="line">256</td><td class="hits">510</td><td class="source">          output.push(parse_tree[i]);</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">258</td><td class="hits">433</td><td class="source">        else if (node_type === 'array') {</td></tr><tr class="hit"><td class="line">259</td><td class="hits">433</td><td class="source">          match = parse_tree[i]; // convenience purposes only</td></tr><tr class="hit"><td class="line">260</td><td class="hits">433</td><td class="source">          if (match[2]) { // keyword argument</td></tr><tr class="hit"><td class="line">261</td><td class="hits">433</td><td class="source">            arg = argv[cursor];</td></tr><tr class="hit"><td class="line">262</td><td class="hits">433</td><td class="source">            for (k = 0; k &lt; match[2].length; k++) {</td></tr><tr class="hit"><td class="line">263</td><td class="hits">433</td><td class="source">              if (!arg.hasOwnProperty(match[2][k])) {</td></tr><tr class="miss"><td class="line">264</td><td class="hits">0</td><td class="source">                throw new Error(sprintf('[_.sprintf] property &quot;%s&quot; does not exist', match[2][k]));</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source">              }</td></tr><tr class="hit"><td class="line">266</td><td class="hits">433</td><td class="source">              arg = arg[match[2][k]];</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source">            }</td></tr><tr class="miss"><td class="line">268</td><td class="hits">0</td><td class="source">          } else if (match[1]) { // positional argument (explicit)</td></tr><tr class="miss"><td class="line">269</td><td class="hits">0</td><td class="source">            arg = argv[match[1]];</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">          else { // positional argument (implicit)</td></tr><tr class="miss"><td class="line">272</td><td class="hits">0</td><td class="source">            arg = argv[cursor++];</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">275</td><td class="hits">433</td><td class="source">          if (/[^s]/.test(match[8]) &amp;&amp; (get_type(arg) != 'number')) {</td></tr><tr class="miss"><td class="line">276</td><td class="hits">0</td><td class="source">            throw new Error(sprintf('[_.sprintf] expecting number but found %s', get_type(arg)));</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">278</td><td class="hits">433</td><td class="source">          switch (match[8]) {</td></tr><tr class="miss"><td class="line">279</td><td class="hits">0</td><td class="source">            case 'b': arg = arg.toString(2); break;</td></tr><tr class="miss"><td class="line">280</td><td class="hits">0</td><td class="source">            case 'c': arg = String.fromCharCode(arg); break;</td></tr><tr class="miss"><td class="line">281</td><td class="hits">0</td><td class="source">            case 'd': arg = parseInt(arg, 10); break;</td></tr><tr class="miss"><td class="line">282</td><td class="hits">0</td><td class="source">            case 'e': arg = match[7] ? arg.toExponential(match[7]) : arg.toExponential(); break;</td></tr><tr class="miss"><td class="line">283</td><td class="hits">0</td><td class="source">            case 'f': arg = match[7] ? parseFloat(arg).toFixed(match[7]) : parseFloat(arg); break;</td></tr><tr class="miss"><td class="line">284</td><td class="hits">0</td><td class="source">            case 'o': arg = arg.toString(8); break;</td></tr><tr class="hit"><td class="line">285</td><td class="hits">866</td><td class="source">            case 's': arg = ((arg = String(arg)) &amp;&amp; match[7] ? arg.substring(0, match[7]) : arg); break;</td></tr><tr class="miss"><td class="line">286</td><td class="hits">0</td><td class="source">            case 'u': arg = Math.abs(arg); break;</td></tr><tr class="miss"><td class="line">287</td><td class="hits">0</td><td class="source">            case 'x': arg = arg.toString(16); break;</td></tr><tr class="miss"><td class="line">288</td><td class="hits">0</td><td class="source">            case 'X': arg = arg.toString(16).toUpperCase(); break;</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">290</td><td class="hits">433</td><td class="source">          arg = (/[def]/.test(match[8]) &amp;&amp; match[3] &amp;&amp; arg &gt;= 0 ? '+'+ arg : arg);</td></tr><tr class="hit"><td class="line">291</td><td class="hits">433</td><td class="source">          pad_character = match[4] ? match[4] == '0' ? '0' : match[4].charAt(1) : ' ';</td></tr><tr class="hit"><td class="line">292</td><td class="hits">433</td><td class="source">          pad_length = match[6] - String(arg).length;</td></tr><tr class="hit"><td class="line">293</td><td class="hits">433</td><td class="source">          pad = match[6] ? str_repeat(pad_character, pad_length) : '';</td></tr><tr class="hit"><td class="line">294</td><td class="hits">433</td><td class="source">          output.push(match[5] ? arg + pad : pad + arg);</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">297</td><td class="hits">77</td><td class="source">      return output.join('');</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">300</td><td class="hits">1</td><td class="source">    str_format.cache = {};</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">302</td><td class="hits">1</td><td class="source">    str_format.parse = function(fmt) {</td></tr><tr class="hit"><td class="line">303</td><td class="hits">9</td><td class="source">      var _fmt = fmt, match = [], parse_tree = [], arg_names = 0;</td></tr><tr class="hit"><td class="line">304</td><td class="hits">9</td><td class="source">      while (_fmt) {</td></tr><tr class="hit"><td class="line">305</td><td class="hits">125</td><td class="source">        if ((match = /^[^\x25]+/.exec(_fmt)) !== null) {</td></tr><tr class="hit"><td class="line">306</td><td class="hits">67</td><td class="source">          parse_tree.push(match[0]);</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">308</td><td class="hits">58</td><td class="source">        else if ((match = /^\x25{2}/.exec(_fmt)) !== null) {</td></tr><tr class="miss"><td class="line">309</td><td class="hits">0</td><td class="source">          parse_tree.push('%');</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">311</td><td class="hits">58</td><td class="source">        else if ((match = /^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt)) !== null) {</td></tr><tr class="hit"><td class="line">312</td><td class="hits">58</td><td class="source">          if (match[2]) {</td></tr><tr class="hit"><td class="line">313</td><td class="hits">58</td><td class="source">            arg_names |= 1;</td></tr><tr class="hit"><td class="line">314</td><td class="hits">58</td><td class="source">            var field_list = [], replacement_field = match[2], field_match = [];</td></tr><tr class="hit"><td class="line">315</td><td class="hits">58</td><td class="source">            if ((field_match = /^([a-z_][a-z_\d]*)/i.exec(replacement_field)) !== null) {</td></tr><tr class="hit"><td class="line">316</td><td class="hits">58</td><td class="source">              field_list.push(field_match[1]);</td></tr><tr class="hit"><td class="line">317</td><td class="hits">58</td><td class="source">              while ((replacement_field = replacement_field.substring(field_match[0].length)) !== '') {</td></tr><tr class="miss"><td class="line">318</td><td class="hits">0</td><td class="source">                if ((field_match = /^\.([a-z_][a-z_\d]*)/i.exec(replacement_field)) !== null) {</td></tr><tr class="miss"><td class="line">319</td><td class="hits">0</td><td class="source">                  field_list.push(field_match[1]);</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source">                }</td></tr><tr class="miss"><td class="line">321</td><td class="hits">0</td><td class="source">                else if ((field_match = /^\[(\d+)\]/.exec(replacement_field)) !== null) {</td></tr><tr class="miss"><td class="line">322</td><td class="hits">0</td><td class="source">                  field_list.push(field_match[1]);</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source">                }</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source">                else {</td></tr><tr class="miss"><td class="line">325</td><td class="hits">0</td><td class="source">                  throw new Error('[_.sprintf] huh?');</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source">                }</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source">              }</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source">            else {</td></tr><tr class="miss"><td class="line">330</td><td class="hits">0</td><td class="source">              throw new Error('[_.sprintf] huh?');</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source">            }</td></tr><tr class="hit"><td class="line">332</td><td class="hits">58</td><td class="source">            match[2] = field_list;</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source">          else {</td></tr><tr class="miss"><td class="line">335</td><td class="hits">0</td><td class="source">            arg_names |= 2;</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">337</td><td class="hits">58</td><td class="source">          if (arg_names === 3) {</td></tr><tr class="miss"><td class="line">338</td><td class="hits">0</td><td class="source">            throw new Error('[_.sprintf] mixing positional and named placeholders is not (yet) supported');</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">340</td><td class="hits">58</td><td class="source">          parse_tree.push(match);</td></tr><tr><td class="line">341</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">        else {</td></tr><tr class="miss"><td class="line">343</td><td class="hits">0</td><td class="source">          throw new Error('[_.sprintf] huh?');</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">345</td><td class="hits">125</td><td class="source">        _fmt = _fmt.substring(match[0].length);</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">347</td><td class="hits">9</td><td class="source">      return parse_tree;</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">350</td><td class="hits">1</td><td class="source">    return str_format;</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source">  })();</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source">  // Defining underscore.string</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">357</td><td class="hits">1</td><td class="source">  var _s = {</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source">    VERSION: '2.3.1',</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source">    isBlank: function(str){</td></tr><tr class="miss"><td class="line">362</td><td class="hits">0</td><td class="source">      if (str == null) str = '';</td></tr><tr class="miss"><td class="line">363</td><td class="hits">0</td><td class="source">      return (/^\s*$/).test(str);</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source">    stripTags: function(str){</td></tr><tr class="miss"><td class="line">367</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">368</td><td class="hits">0</td><td class="source">      return String(str).replace(/&lt;\/?[^&gt;]+&gt;/g, '');</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source">    capitalize : function(str){</td></tr><tr class="miss"><td class="line">372</td><td class="hits">0</td><td class="source">      str = str == null ? '' : String(str);</td></tr><tr class="miss"><td class="line">373</td><td class="hits">0</td><td class="source">      return str.charAt(0).toUpperCase() + str.slice(1);</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source">    chop: function(str, step){</td></tr><tr class="miss"><td class="line">377</td><td class="hits">0</td><td class="source">      if (str == null) return [];</td></tr><tr class="miss"><td class="line">378</td><td class="hits">0</td><td class="source">      str = String(str);</td></tr><tr class="miss"><td class="line">379</td><td class="hits">0</td><td class="source">      step = ~~step;</td></tr><tr class="miss"><td class="line">380</td><td class="hits">0</td><td class="source">      return step &gt; 0 ? str.match(new RegExp('.{1,' + step + '}', 'g')) : [str];</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source">    clean: function(str){</td></tr><tr class="miss"><td class="line">384</td><td class="hits">0</td><td class="source">      return _s.strip(str).replace(/\s+/g, ' ');</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source">    count: function(str, substr){</td></tr><tr class="miss"><td class="line">388</td><td class="hits">0</td><td class="source">      if (str == null || substr == null) return 0;</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">390</td><td class="hits">0</td><td class="source">      str = String(str);</td></tr><tr class="miss"><td class="line">391</td><td class="hits">0</td><td class="source">      substr = String(substr);</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">393</td><td class="hits">0</td><td class="source">      var count = 0,</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source">        pos = 0,</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source">        length = substr.length;</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">397</td><td class="hits">0</td><td class="source">      while (true) {</td></tr><tr class="miss"><td class="line">398</td><td class="hits">0</td><td class="source">        pos = str.indexOf(substr, pos);</td></tr><tr class="miss"><td class="line">399</td><td class="hits">0</td><td class="source">        if (pos === -1) break;</td></tr><tr class="miss"><td class="line">400</td><td class="hits">0</td><td class="source">        count++;</td></tr><tr class="miss"><td class="line">401</td><td class="hits">0</td><td class="source">        pos += length;</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">404</td><td class="hits">0</td><td class="source">      return count;</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">    chars: function(str) {</td></tr><tr class="miss"><td class="line">408</td><td class="hits">0</td><td class="source">      if (str == null) return [];</td></tr><tr class="miss"><td class="line">409</td><td class="hits">0</td><td class="source">      return String(str).split('');</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source">    swapCase: function(str) {</td></tr><tr class="miss"><td class="line">413</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">414</td><td class="hits">0</td><td class="source">      return String(str).replace(/\S/g, function(c){</td></tr><tr class="miss"><td class="line">415</td><td class="hits">0</td><td class="source">        return c === c.toUpperCase() ? c.toLowerCase() : c.toUpperCase();</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source">    escapeHTML: function(str) {</td></tr><tr class="miss"><td class="line">420</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">421</td><td class="hits">0</td><td class="source">      return String(str).replace(/[&amp;&lt;&gt;&quot;']/g, function(m){ return '&amp;' + reversedEscapeChars[m] + ';'; });</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">    unescapeHTML: function(str) {</td></tr><tr class="miss"><td class="line">425</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">426</td><td class="hits">0</td><td class="source">      return String(str).replace(/\&amp;([^;]+);/g, function(entity, entityCode){</td></tr><tr class="miss"><td class="line">427</td><td class="hits">0</td><td class="source">        var match;</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">429</td><td class="hits">0</td><td class="source">        if (entityCode in escapeChars) {</td></tr><tr class="miss"><td class="line">430</td><td class="hits">0</td><td class="source">          return escapeChars[entityCode];</td></tr><tr class="miss"><td class="line">431</td><td class="hits">0</td><td class="source">        } else if (match = entityCode.match(/^#x([\da-fA-F]+)$/)) {</td></tr><tr class="miss"><td class="line">432</td><td class="hits">0</td><td class="source">          return String.fromCharCode(parseInt(match[1], 16));</td></tr><tr class="miss"><td class="line">433</td><td class="hits">0</td><td class="source">        } else if (match = entityCode.match(/^#(\d+)$/)) {</td></tr><tr class="miss"><td class="line">434</td><td class="hits">0</td><td class="source">          return String.fromCharCode(~~match[1]);</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="miss"><td class="line">436</td><td class="hits">0</td><td class="source">          return entity;</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">438</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source">    escapeRegExp: function(str){</td></tr><tr class="miss"><td class="line">442</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">443</td><td class="hits">0</td><td class="source">      return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">    splice: function(str, i, howmany, substr){</td></tr><tr class="miss"><td class="line">447</td><td class="hits">0</td><td class="source">      var arr = _s.chars(str);</td></tr><tr class="miss"><td class="line">448</td><td class="hits">0</td><td class="source">      arr.splice(~~i, ~~howmany, substr);</td></tr><tr class="miss"><td class="line">449</td><td class="hits">0</td><td class="source">      return arr.join('');</td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source">    insert: function(str, i, substr){</td></tr><tr class="miss"><td class="line">453</td><td class="hits">0</td><td class="source">      return _s.splice(str, i, 0, substr);</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">456</td><td class="hits"></td><td class="source">    include: function(str, needle){</td></tr><tr class="miss"><td class="line">457</td><td class="hits">0</td><td class="source">      if (needle === '') return true;</td></tr><tr class="miss"><td class="line">458</td><td class="hits">0</td><td class="source">      if (str == null) return false;</td></tr><tr class="miss"><td class="line">459</td><td class="hits">0</td><td class="source">      return String(str).indexOf(needle) !== -1;</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source">    join: function() {</td></tr><tr class="miss"><td class="line">463</td><td class="hits">0</td><td class="source">      var args = slice.call(arguments),</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">        separator = args.shift();</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">466</td><td class="hits">0</td><td class="source">      if (separator == null) separator = '';</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">468</td><td class="hits">0</td><td class="source">      return args.join(separator);</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source">    lines: function(str) {</td></tr><tr class="miss"><td class="line">472</td><td class="hits">0</td><td class="source">      if (str == null) return [];</td></tr><tr class="miss"><td class="line">473</td><td class="hits">0</td><td class="source">      return String(str).split(&quot;\n&quot;);</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source">    reverse: function(str){</td></tr><tr class="miss"><td class="line">477</td><td class="hits">0</td><td class="source">      return _s.chars(str).reverse().join('');</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source">    startsWith: function(str, starts){</td></tr><tr class="miss"><td class="line">481</td><td class="hits">0</td><td class="source">      if (starts === '') return true;</td></tr><tr class="miss"><td class="line">482</td><td class="hits">0</td><td class="source">      if (str == null || starts == null) return false;</td></tr><tr class="miss"><td class="line">483</td><td class="hits">0</td><td class="source">      str = String(str); starts = String(starts);</td></tr><tr class="miss"><td class="line">484</td><td class="hits">0</td><td class="source">      return str.length &gt;= starts.length &amp;&amp; str.slice(0, starts.length) === starts;</td></tr><tr><td class="line">485</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">486</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source">    endsWith: function(str, ends){</td></tr><tr class="miss"><td class="line">488</td><td class="hits">0</td><td class="source">      if (ends === '') return true;</td></tr><tr class="miss"><td class="line">489</td><td class="hits">0</td><td class="source">      if (str == null || ends == null) return false;</td></tr><tr class="miss"><td class="line">490</td><td class="hits">0</td><td class="source">      str = String(str); ends = String(ends);</td></tr><tr class="miss"><td class="line">491</td><td class="hits">0</td><td class="source">      return str.length &gt;= ends.length &amp;&amp; str.slice(str.length - ends.length) === ends;</td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">494</td><td class="hits"></td><td class="source">    succ: function(str){</td></tr><tr class="miss"><td class="line">495</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">496</td><td class="hits">0</td><td class="source">      str = String(str);</td></tr><tr class="miss"><td class="line">497</td><td class="hits">0</td><td class="source">      return str.slice(0, -1) + String.fromCharCode(str.charCodeAt(str.length-1) + 1);</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source">    titleize: function(str){</td></tr><tr class="miss"><td class="line">501</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">502</td><td class="hits">0</td><td class="source">      return String(str).replace(/(?:^|\s)\S/g, function(c){ return c.toUpperCase(); });</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">505</td><td class="hits"></td><td class="source">    camelize: function(str){</td></tr><tr class="miss"><td class="line">506</td><td class="hits">0</td><td class="source">      return _s.trim(str).replace(/[-_\s]+(.)?/g, function(match, c){ return c.toUpperCase(); });</td></tr><tr><td class="line">507</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">508</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">509</td><td class="hits"></td><td class="source">    underscored: function(str){</td></tr><tr class="miss"><td class="line">510</td><td class="hits">0</td><td class="source">      return _s.trim(str).replace(/([a-z\d])([A-Z]+)/g, '$1_$2').replace(/[-\s]+/g, '_').toLowerCase();</td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">512</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">513</td><td class="hits"></td><td class="source">    dasherize: function(str){</td></tr><tr class="miss"><td class="line">514</td><td class="hits">0</td><td class="source">      return _s.trim(str).replace(/([A-Z])/g, '-$1').replace(/[-_\s]+/g, '-').toLowerCase();</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">517</td><td class="hits"></td><td class="source">    classify: function(str){</td></tr><tr class="miss"><td class="line">518</td><td class="hits">0</td><td class="source">      return _s.titleize(String(str).replace(/[\W_]/g, ' ')).replace(/\s/g, '');</td></tr><tr><td class="line">519</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">520</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">521</td><td class="hits"></td><td class="source">    humanize: function(str){</td></tr><tr class="miss"><td class="line">522</td><td class="hits">0</td><td class="source">      return _s.capitalize(_s.underscored(str).replace(/_id$/,'').replace(/_/g, ' '));</td></tr><tr><td class="line">523</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">524</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">525</td><td class="hits"></td><td class="source">    trim: function(str, characters){</td></tr><tr class="miss"><td class="line">526</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">527</td><td class="hits">0</td><td class="source">      if (!characters &amp;&amp; nativeTrim) return nativeTrim.call(str);</td></tr><tr class="miss"><td class="line">528</td><td class="hits">0</td><td class="source">      characters = defaultToWhiteSpace(characters);</td></tr><tr class="miss"><td class="line">529</td><td class="hits">0</td><td class="source">      return String(str).replace(new RegExp('\^' + characters + '+|' + characters + '+$', 'g'), '');</td></tr><tr><td class="line">530</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">531</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">532</td><td class="hits"></td><td class="source">    ltrim: function(str, characters){</td></tr><tr class="miss"><td class="line">533</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">534</td><td class="hits">0</td><td class="source">      if (!characters &amp;&amp; nativeTrimLeft) return nativeTrimLeft.call(str);</td></tr><tr class="miss"><td class="line">535</td><td class="hits">0</td><td class="source">      characters = defaultToWhiteSpace(characters);</td></tr><tr class="miss"><td class="line">536</td><td class="hits">0</td><td class="source">      return String(str).replace(new RegExp('^' + characters + '+'), '');</td></tr><tr><td class="line">537</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">538</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">539</td><td class="hits"></td><td class="source">    rtrim: function(str, characters){</td></tr><tr class="miss"><td class="line">540</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">541</td><td class="hits">0</td><td class="source">      if (!characters &amp;&amp; nativeTrimRight) return nativeTrimRight.call(str);</td></tr><tr class="miss"><td class="line">542</td><td class="hits">0</td><td class="source">      characters = defaultToWhiteSpace(characters);</td></tr><tr class="miss"><td class="line">543</td><td class="hits">0</td><td class="source">      return String(str).replace(new RegExp(characters + '+$'), '');</td></tr><tr><td class="line">544</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">545</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">546</td><td class="hits"></td><td class="source">    truncate: function(str, length, truncateStr){</td></tr><tr class="miss"><td class="line">547</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">548</td><td class="hits">0</td><td class="source">      str = String(str); truncateStr = truncateStr || '...';</td></tr><tr class="miss"><td class="line">549</td><td class="hits">0</td><td class="source">      length = ~~length;</td></tr><tr class="miss"><td class="line">550</td><td class="hits">0</td><td class="source">      return str.length &gt; length ? str.slice(0, length) + truncateStr : str;</td></tr><tr><td class="line">551</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">552</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">553</td><td class="hits"></td><td class="source">    /**</td></tr><tr><td class="line">554</td><td class="hits"></td><td class="source">     * _s.prune: a more elegant version of truncate</td></tr><tr><td class="line">555</td><td class="hits"></td><td class="source">     * prune extra chars, never leaving a half-chopped word.</td></tr><tr><td class="line">556</td><td class="hits"></td><td class="source">     * @author github.com/rwz</td></tr><tr><td class="line">557</td><td class="hits"></td><td class="source">     */</td></tr><tr><td class="line">558</td><td class="hits"></td><td class="source">    prune: function(str, length, pruneStr){</td></tr><tr class="miss"><td class="line">559</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr><td class="line">560</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">561</td><td class="hits">0</td><td class="source">      str = String(str); length = ~~length;</td></tr><tr class="miss"><td class="line">562</td><td class="hits">0</td><td class="source">      pruneStr = pruneStr != null ? String(pruneStr) : '...';</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">564</td><td class="hits">0</td><td class="source">      if (str.length &lt;= length) return str;</td></tr><tr><td class="line">565</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">566</td><td class="hits">0</td><td class="source">      var tmpl = function(c){ return c.toUpperCase() !== c.toLowerCase() ? 'A' : ' '; },</td></tr><tr><td class="line">567</td><td class="hits"></td><td class="source">        template = str.slice(0, length+1).replace(/.(?=\W*\w*$)/g, tmpl); // 'Hello, world' -&gt; 'HellAA AAAAA'</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">569</td><td class="hits">0</td><td class="source">      if (template.slice(template.length-2).match(/\w\w/))</td></tr><tr class="miss"><td class="line">570</td><td class="hits">0</td><td class="source">        template = template.replace(/\s*\S+$/, '');</td></tr><tr><td class="line">571</td><td class="hits"></td><td class="source">      else</td></tr><tr class="miss"><td class="line">572</td><td class="hits">0</td><td class="source">        template = _s.rtrim(template.slice(0, template.length-1));</td></tr><tr><td class="line">573</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">574</td><td class="hits">0</td><td class="source">      return (template+pruneStr).length &gt; str.length ? str : str.slice(0, template.length)+pruneStr;</td></tr><tr><td class="line">575</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">576</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">577</td><td class="hits"></td><td class="source">    words: function(str, delimiter) {</td></tr><tr class="miss"><td class="line">578</td><td class="hits">0</td><td class="source">      if (_s.isBlank(str)) return [];</td></tr><tr class="miss"><td class="line">579</td><td class="hits">0</td><td class="source">      return _s.trim(str, delimiter).split(delimiter || /\s+/);</td></tr><tr><td class="line">580</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">582</td><td class="hits"></td><td class="source">    pad: function(str, length, padStr, type) {</td></tr><tr class="miss"><td class="line">583</td><td class="hits">0</td><td class="source">      str = str == null ? '' : String(str);</td></tr><tr class="miss"><td class="line">584</td><td class="hits">0</td><td class="source">      length = ~~length;</td></tr><tr><td class="line">585</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">586</td><td class="hits">0</td><td class="source">      var padlen  = 0;</td></tr><tr><td class="line">587</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">588</td><td class="hits">0</td><td class="source">      if (!padStr)</td></tr><tr class="miss"><td class="line">589</td><td class="hits">0</td><td class="source">        padStr = ' ';</td></tr><tr class="miss"><td class="line">590</td><td class="hits">0</td><td class="source">      else if (padStr.length &gt; 1)</td></tr><tr class="miss"><td class="line">591</td><td class="hits">0</td><td class="source">        padStr = padStr.charAt(0);</td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">593</td><td class="hits">0</td><td class="source">      switch(type) {</td></tr><tr><td class="line">594</td><td class="hits"></td><td class="source">        case 'right':</td></tr><tr class="miss"><td class="line">595</td><td class="hits">0</td><td class="source">          padlen = length - str.length;</td></tr><tr class="miss"><td class="line">596</td><td class="hits">0</td><td class="source">          return str + strRepeat(padStr, padlen);</td></tr><tr><td class="line">597</td><td class="hits"></td><td class="source">        case 'both':</td></tr><tr class="miss"><td class="line">598</td><td class="hits">0</td><td class="source">          padlen = length - str.length;</td></tr><tr class="miss"><td class="line">599</td><td class="hits">0</td><td class="source">          return strRepeat(padStr, Math.ceil(padlen/2)) + str</td></tr><tr><td class="line">600</td><td class="hits"></td><td class="source">                  + strRepeat(padStr, Math.floor(padlen/2));</td></tr><tr><td class="line">601</td><td class="hits"></td><td class="source">        default: // 'left'</td></tr><tr class="miss"><td class="line">602</td><td class="hits">0</td><td class="source">          padlen = length - str.length;</td></tr><tr class="miss"><td class="line">603</td><td class="hits">0</td><td class="source">          return strRepeat(padStr, padlen) + str;</td></tr><tr><td class="line">604</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">605</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">606</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">607</td><td class="hits"></td><td class="source">    lpad: function(str, length, padStr) {</td></tr><tr class="miss"><td class="line">608</td><td class="hits">0</td><td class="source">      return _s.pad(str, length, padStr);</td></tr><tr><td class="line">609</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">610</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">611</td><td class="hits"></td><td class="source">    rpad: function(str, length, padStr) {</td></tr><tr class="miss"><td class="line">612</td><td class="hits">0</td><td class="source">      return _s.pad(str, length, padStr, 'right');</td></tr><tr><td class="line">613</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">614</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">615</td><td class="hits"></td><td class="source">    lrpad: function(str, length, padStr) {</td></tr><tr class="miss"><td class="line">616</td><td class="hits">0</td><td class="source">      return _s.pad(str, length, padStr, 'both');</td></tr><tr><td class="line">617</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">618</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">619</td><td class="hits"></td><td class="source">    sprintf: sprintf,</td></tr><tr><td class="line">620</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">621</td><td class="hits"></td><td class="source">    vsprintf: function(fmt, argv){</td></tr><tr class="miss"><td class="line">622</td><td class="hits">0</td><td class="source">      argv.unshift(fmt);</td></tr><tr class="miss"><td class="line">623</td><td class="hits">0</td><td class="source">      return sprintf.apply(null, argv);</td></tr><tr><td class="line">624</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">625</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">626</td><td class="hits"></td><td class="source">    toNumber: function(str, decimals) {</td></tr><tr class="miss"><td class="line">627</td><td class="hits">0</td><td class="source">      if (!str) return 0;</td></tr><tr class="miss"><td class="line">628</td><td class="hits">0</td><td class="source">      str = _s.trim(str);</td></tr><tr class="miss"><td class="line">629</td><td class="hits">0</td><td class="source">      if (!str.match(/^-?\d+(?:\.\d+)?$/)) return NaN;</td></tr><tr class="miss"><td class="line">630</td><td class="hits">0</td><td class="source">      return parseNumber(parseNumber(str).toFixed(~~decimals));</td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">632</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">633</td><td class="hits"></td><td class="source">    numberFormat : function(number, dec, dsep, tsep) {</td></tr><tr class="miss"><td class="line">634</td><td class="hits">0</td><td class="source">      if (isNaN(number) || number == null) return '';</td></tr><tr><td class="line">635</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">636</td><td class="hits">0</td><td class="source">      number = number.toFixed(~~dec);</td></tr><tr class="miss"><td class="line">637</td><td class="hits">0</td><td class="source">      tsep = typeof tsep == 'string' ? tsep : ',';</td></tr><tr><td class="line">638</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">639</td><td class="hits">0</td><td class="source">      var parts = number.split('.'), fnums = parts[0],</td></tr><tr><td class="line">640</td><td class="hits"></td><td class="source">        decimals = parts[1] ? (dsep || '.') + parts[1] : '';</td></tr><tr><td class="line">641</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">642</td><td class="hits">0</td><td class="source">      return fnums.replace(/(\d)(?=(?:\d{3})+$)/g, '$1' + tsep) + decimals;</td></tr><tr><td class="line">643</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">644</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">645</td><td class="hits"></td><td class="source">    strRight: function(str, sep){</td></tr><tr class="miss"><td class="line">646</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">647</td><td class="hits">0</td><td class="source">      str = String(str); sep = sep != null ? String(sep) : sep;</td></tr><tr class="miss"><td class="line">648</td><td class="hits">0</td><td class="source">      var pos = !sep ? -1 : str.indexOf(sep);</td></tr><tr class="miss"><td class="line">649</td><td class="hits">0</td><td class="source">      return ~pos ? str.slice(pos+sep.length, str.length) : str;</td></tr><tr><td class="line">650</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">651</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">652</td><td class="hits"></td><td class="source">    strRightBack: function(str, sep){</td></tr><tr class="miss"><td class="line">653</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">654</td><td class="hits">0</td><td class="source">      str = String(str); sep = sep != null ? String(sep) : sep;</td></tr><tr class="miss"><td class="line">655</td><td class="hits">0</td><td class="source">      var pos = !sep ? -1 : str.lastIndexOf(sep);</td></tr><tr class="miss"><td class="line">656</td><td class="hits">0</td><td class="source">      return ~pos ? str.slice(pos+sep.length, str.length) : str;</td></tr><tr><td class="line">657</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">658</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">659</td><td class="hits"></td><td class="source">    strLeft: function(str, sep){</td></tr><tr class="miss"><td class="line">660</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">661</td><td class="hits">0</td><td class="source">      str = String(str); sep = sep != null ? String(sep) : sep;</td></tr><tr class="miss"><td class="line">662</td><td class="hits">0</td><td class="source">      var pos = !sep ? -1 : str.indexOf(sep);</td></tr><tr class="miss"><td class="line">663</td><td class="hits">0</td><td class="source">      return ~pos ? str.slice(0, pos) : str;</td></tr><tr><td class="line">664</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">665</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">666</td><td class="hits"></td><td class="source">    strLeftBack: function(str, sep){</td></tr><tr class="miss"><td class="line">667</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr class="miss"><td class="line">668</td><td class="hits">0</td><td class="source">      str += ''; sep = sep != null ? ''+sep : sep;</td></tr><tr class="miss"><td class="line">669</td><td class="hits">0</td><td class="source">      var pos = str.lastIndexOf(sep);</td></tr><tr class="miss"><td class="line">670</td><td class="hits">0</td><td class="source">      return ~pos ? str.slice(0, pos) : str;</td></tr><tr><td class="line">671</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">672</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">673</td><td class="hits"></td><td class="source">    toSentence: function(array, separator, lastSeparator, serial) {</td></tr><tr class="miss"><td class="line">674</td><td class="hits">0</td><td class="source">      separator = separator || ', '</td></tr><tr class="miss"><td class="line">675</td><td class="hits">0</td><td class="source">      lastSeparator = lastSeparator || ' and '</td></tr><tr class="miss"><td class="line">676</td><td class="hits">0</td><td class="source">      var a = array.slice(), lastMember = a.pop();</td></tr><tr><td class="line">677</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">678</td><td class="hits">0</td><td class="source">      if (array.length &gt; 2 &amp;&amp; serial) lastSeparator = _s.rtrim(separator) + lastSeparator;</td></tr><tr><td class="line">679</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">680</td><td class="hits">0</td><td class="source">      return a.length ? a.join(separator) + lastSeparator + lastMember : lastMember;</td></tr><tr><td class="line">681</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">682</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">683</td><td class="hits"></td><td class="source">    toSentenceSerial: function() {</td></tr><tr class="miss"><td class="line">684</td><td class="hits">0</td><td class="source">      var args = slice.call(arguments);</td></tr><tr class="miss"><td class="line">685</td><td class="hits">0</td><td class="source">      args[3] = true;</td></tr><tr class="miss"><td class="line">686</td><td class="hits">0</td><td class="source">      return _s.toSentence.apply(_s, args);</td></tr><tr><td class="line">687</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">688</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">689</td><td class="hits"></td><td class="source">    slugify: function(str) {</td></tr><tr class="miss"><td class="line">690</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr><td class="line">691</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">692</td><td class="hits">0</td><td class="source">      var from  = &quot;ąàáäâãåæćęèéëêìíïîłńòóöôõøùúüûñçżź&quot;,</td></tr><tr><td class="line">693</td><td class="hits"></td><td class="source">          to    = &quot;aaaaaaaaceeeeeiiiilnoooooouuuunczz&quot;,</td></tr><tr><td class="line">694</td><td class="hits"></td><td class="source">          regex = new RegExp(defaultToWhiteSpace(from), 'g');</td></tr><tr><td class="line">695</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">696</td><td class="hits">0</td><td class="source">      str = String(str).toLowerCase().replace(regex, function(c){</td></tr><tr class="miss"><td class="line">697</td><td class="hits">0</td><td class="source">        var index = from.indexOf(c);</td></tr><tr class="miss"><td class="line">698</td><td class="hits">0</td><td class="source">        return to.charAt(index) || '-';</td></tr><tr><td class="line">699</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">700</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">701</td><td class="hits">0</td><td class="source">      return _s.dasherize(str.replace(/[^\w\s-]/g, ''));</td></tr><tr><td class="line">702</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">704</td><td class="hits"></td><td class="source">    surround: function(str, wrapper) {</td></tr><tr class="miss"><td class="line">705</td><td class="hits">0</td><td class="source">      return [wrapper, str, wrapper].join('');</td></tr><tr><td class="line">706</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">707</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">708</td><td class="hits"></td><td class="source">    quote: function(str) {</td></tr><tr class="miss"><td class="line">709</td><td class="hits">0</td><td class="source">      return _s.surround(str, '&quot;');</td></tr><tr><td class="line">710</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">711</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">712</td><td class="hits"></td><td class="source">    exports: function() {</td></tr><tr class="miss"><td class="line">713</td><td class="hits">0</td><td class="source">      var result = {};</td></tr><tr><td class="line">714</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">715</td><td class="hits">0</td><td class="source">      for (var prop in this) {</td></tr><tr class="miss"><td class="line">716</td><td class="hits">0</td><td class="source">        if (!this.hasOwnProperty(prop) || prop.match(/^(?:include|contains|reverse)$/)) continue;</td></tr><tr class="miss"><td class="line">717</td><td class="hits">0</td><td class="source">        result[prop] = this[prop];</td></tr><tr><td class="line">718</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">719</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">720</td><td class="hits">0</td><td class="source">      return result;</td></tr><tr><td class="line">721</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">722</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">723</td><td class="hits"></td><td class="source">    repeat: function(str, qty, separator){</td></tr><tr class="miss"><td class="line">724</td><td class="hits">0</td><td class="source">      if (str == null) return '';</td></tr><tr><td class="line">725</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">726</td><td class="hits">0</td><td class="source">      qty = ~~qty;</td></tr><tr><td class="line">727</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">728</td><td class="hits"></td><td class="source">      // using faster implementation if separator is not needed;</td></tr><tr class="miss"><td class="line">729</td><td class="hits">0</td><td class="source">      if (separator == null) return strRepeat(String(str), qty);</td></tr><tr><td class="line">730</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">731</td><td class="hits"></td><td class="source">      // this one is about 300x slower in Google Chrome</td></tr><tr class="miss"><td class="line">732</td><td class="hits">0</td><td class="source">      for (var repeat = []; qty &gt; 0; repeat[--qty] = str) {}</td></tr><tr class="miss"><td class="line">733</td><td class="hits">0</td><td class="source">      return repeat.join(separator);</td></tr><tr><td class="line">734</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">735</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">736</td><td class="hits"></td><td class="source">    levenshtein: function(str1, str2) {</td></tr><tr class="miss"><td class="line">737</td><td class="hits">0</td><td class="source">      if (str1 == null &amp;&amp; str2 == null) return 0;</td></tr><tr class="miss"><td class="line">738</td><td class="hits">0</td><td class="source">      if (str1 == null) return String(str2).length;</td></tr><tr class="miss"><td class="line">739</td><td class="hits">0</td><td class="source">      if (str2 == null) return String(str1).length;</td></tr><tr><td class="line">740</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">741</td><td class="hits">0</td><td class="source">      str1 = String(str1); str2 = String(str2);</td></tr><tr><td class="line">742</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">743</td><td class="hits">0</td><td class="source">      var current = [], prev, value;</td></tr><tr><td class="line">744</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">745</td><td class="hits">0</td><td class="source">      for (var i = 0; i &lt;= str2.length; i++)</td></tr><tr class="miss"><td class="line">746</td><td class="hits">0</td><td class="source">        for (var j = 0; j &lt;= str1.length; j++) {</td></tr><tr class="miss"><td class="line">747</td><td class="hits">0</td><td class="source">          if (i &amp;&amp; j)</td></tr><tr class="miss"><td class="line">748</td><td class="hits">0</td><td class="source">            if (str1.charAt(j - 1) === str2.charAt(i - 1))</td></tr><tr class="miss"><td class="line">749</td><td class="hits">0</td><td class="source">              value = prev;</td></tr><tr><td class="line">750</td><td class="hits"></td><td class="source">            else</td></tr><tr class="miss"><td class="line">751</td><td class="hits">0</td><td class="source">              value = Math.min(current[j], current[j - 1], prev) + 1;</td></tr><tr><td class="line">752</td><td class="hits"></td><td class="source">          else</td></tr><tr class="miss"><td class="line">753</td><td class="hits">0</td><td class="source">            value = i + j;</td></tr><tr><td class="line">754</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">755</td><td class="hits">0</td><td class="source">          prev = current[j];</td></tr><tr class="miss"><td class="line">756</td><td class="hits">0</td><td class="source">          current[j] = value;</td></tr><tr><td class="line">757</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">758</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">759</td><td class="hits">0</td><td class="source">      return current.pop();</td></tr><tr><td class="line">760</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">761</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">762</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">763</td><td class="hits">1</td><td class="source">  var isValidData = function(data) {</td></tr><tr class="hit"><td class="line">764</td><td class="hits">44</td><td class="source">    return Boolean( (typeof data === 'object') &amp;&amp; (data !== null) );</td></tr><tr><td class="line">765</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">766</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">767</td><td class="hits">1</td><td class="source">  return neo4jmapper_helpers = {</td></tr><tr><td class="line">768</td><td class="hits"></td><td class="source">    sortStringAndOptionsArguments: sortStringAndOptionsArguments,</td></tr><tr><td class="line">769</td><td class="hits"></td><td class="source">    sortOptionsAndCallbackArguments: sortOptionsAndCallbackArguments,</td></tr><tr><td class="line">770</td><td class="hits"></td><td class="source">    flattenObject: flattenObject,</td></tr><tr><td class="line">771</td><td class="hits"></td><td class="source">    unflattenObject: unflattenObject,</td></tr><tr><td class="line">772</td><td class="hits"></td><td class="source">    conditionalParameterToString: conditionalParameterToString,</td></tr><tr><td class="line">773</td><td class="hits"></td><td class="source">    extractAttributesFromCondition: extractAttributesFromCondition,</td></tr><tr><td class="line">774</td><td class="hits"></td><td class="source">    getIdFromObject: getIdFromObject,</td></tr><tr><td class="line">775</td><td class="hits"></td><td class="source">    escapeString: escapeString,</td></tr><tr><td class="line">776</td><td class="hits"></td><td class="source">    sprintf: sprintf,</td></tr><tr><td class="line">777</td><td class="hits"></td><td class="source">    constructorNameOfFunction: constructorNameOfFunction,</td></tr><tr><td class="line">778</td><td class="hits"></td><td class="source">    cypherKeyValueToString: cypherKeyValueToString,</td></tr><tr><td class="line">779</td><td class="hits"></td><td class="source">    isValidData: isValidData</td></tr><tr><td class="line">780</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">781</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">782</td><td class="hits"></td><td class="source">})();</td></tr><tr><td class="line">783</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">784</td><td class="hits">1</td><td class="source">if (typeof window !== 'object') {</td></tr><tr class="hit"><td class="line">785</td><td class="hits">1</td><td class="source">  module.exports = exports = neo4jmapper_helpers;</td></tr><tr><td class="line">786</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">787</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/philipp/code/neo4jmapper/src/index.js">/Users/philipp/code/neo4jmapper/src/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">11</div><div class="hits">11</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">module.exports = exports = function(urlOrOptions) {</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">3</td><td class="hits">4</td><td class="source">  var Neo4jRestful = require('./neo4jrestful');</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">4</td><td class="source">  var Graph         = require('./graph');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">4</td><td class="source">  var node          = require('./node');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">4</td><td class="source">  var relationship  = require('./relationship');</td></tr><tr class="hit"><td class="line">8</td><td class="hits">4</td><td class="source">  var path          = require('./path');</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  // create a new client</td></tr><tr class="hit"><td class="line">11</td><td class="hits">4</td><td class="source">  var neo4jrestful = new Neo4jRestful(urlOrOptions);</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">4</td><td class="source">  var Node          = node(neo4jrestful);</td></tr><tr class="hit"><td class="line">14</td><td class="hits">4</td><td class="source">  var Relationship  = relationship(neo4jrestful);</td></tr><tr class="hit"><td class="line">15</td><td class="hits">4</td><td class="source">  var Path          = path(neo4jrestful);</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">4</td><td class="source">  return {</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    Node: Node,</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">    Relationship: Relationship,</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    Path: Path,</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">    Graph: Graph(neo4jrestful),</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">    client: neo4jrestful,</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    helpers: require('./helpers')</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/Users/philipp/code/neo4jmapper/src/neo4jrestful.js">/Users/philipp/code/neo4jmapper/src/neo4jrestful.js</h2><div id="stats" class="medium"><div class="percentage">72%</div><div class="sloc">241</div><div class="hits">174</div><div class="misses">67</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var initNeo4jRestful = function() {</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">  // will be initialized on first construction</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">  var Node                = null</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">    , Relationship        = null</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">    , Path                = null</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">    , node                = null</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    , relationship        = null</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    , path                = null</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    , _singleton_instance = null</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    , helpers             = null</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    , _                   = null</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    , jQuery              = null;</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">  if (typeof window === 'object') {</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    // browser</td></tr><tr class="miss"><td class="line">17</td><td class="hits">0</td><td class="source">    helpers      = neo4jmapper_helpers;</td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">    node         = initNode;</td></tr><tr class="miss"><td class="line">19</td><td class="hits">0</td><td class="source">    path         = initPath;</td></tr><tr class="miss"><td class="line">20</td><td class="hits">0</td><td class="source">    relationship = initRelationship;</td></tr><tr class="miss"><td class="line">21</td><td class="hits">0</td><td class="source">    _            = window._;</td></tr><tr class="miss"><td class="line">22</td><td class="hits">0</td><td class="source">    jQuery       = window.jQuery;</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  } else {</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    // nodejs</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">    helpers      = require('./helpers');</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">    _            = require('underscore');</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">    jQuery       = require('jquery');</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">    node         = require('./node');</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">    relationship = require('./relationship');</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">    path         = require('./path');</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">  var QueryError = function(message, options, name) {</td></tr><tr class="miss"><td class="line">34</td><td class="hits">0</td><td class="source">      this.name = (typeof name === 'string') ? name : &quot;QueryError&quot;;</td></tr><tr class="miss"><td class="line">35</td><td class="hits">0</td><td class="source">      this.message = message || '';</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">      if (typeof options === 'object') {</td></tr><tr class="miss"><td class="line">37</td><td class="hits">0</td><td class="source">        this.exception = options.exception || null;</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">        this.cypher = options.cypher || null;</td></tr><tr class="miss"><td class="line">39</td><td class="hits">0</td><td class="source">        this.stacktrace = options.stacktrace || null;</td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">        this.statusCode = options.statusCode || null;</td></tr><tr class="miss"><td class="line">41</td><td class="hits">0</td><td class="source">        this.method = options.method || null;</td></tr><tr class="miss"><td class="line">42</td><td class="hits">0</td><td class="source">        this.url = options.url || null;</td></tr><tr class="miss"><td class="line">43</td><td class="hits">0</td><td class="source">        this.data = options.data || null;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">  var CypherQueryError = function(message, options) {</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">    var error = QueryError(message, options, 'CypherQueryError');</td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">    return _.extend(this, error);</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">   * Constructor</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">  Neo4jRestful = function(url, options) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">4</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">57</td><td class="hits">4</td><td class="source">    if (typeof options !== 'object') {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">4</td><td class="source">      options = (typeof url === 'object') ? url : {};</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">60</td><td class="hits">4</td><td class="source">    if (typeof url === 'string') {</td></tr><tr class="hit"><td class="line">61</td><td class="hits">3</td><td class="source">      options.url = url;</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">63</td><td class="hits">4</td><td class="source">    if (typeof options.url === 'string') {</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">      // check url</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">      // ensure one trailing slash</td></tr><tr class="hit"><td class="line">66</td><td class="hits">4</td><td class="source">      options.url = options.url.replace(/\/*$/, '/');</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">      // stop here if we don't have a valid url</td></tr><tr class="hit"><td class="line">68</td><td class="hits">4</td><td class="source">      if (!/http(s)*\:\/\/.+(\:[0-9]+)*\//.test(options.url)) {</td></tr><tr class="miss"><td class="line">69</td><td class="hits">0</td><td class="source">        var message = &quot;Your URL (&quot;+url+&quot;) needs to match the default url pattern 'http(s)://domain(:port)/…'&quot;;</td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">        throw Error(message);</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">73</td><td class="hits">0</td><td class="source">      throw Error('No url found. Argument must be either an URL as string or an option object including an `.url` property.');</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">76</td><td class="hits">4</td><td class="source">    self.baseUrl = options.url;</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">78</td><td class="hits">4</td><td class="source">    if (Node === null)</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">      Node = node(self);</td></tr><tr class="hit"><td class="line">80</td><td class="hits">4</td><td class="source">    if (Relationship === null)</td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">      Relationship = relationship(self);</td></tr><tr class="hit"><td class="line">82</td><td class="hits">4</td><td class="source">    if (Path === null)</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">      Path = path(self);</td></tr><tr class="hit"><td class="line">84</td><td class="hits">4</td><td class="source">    if (_singleton_instance === null) {</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">      // initially set singleton to first constructed connection</td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">      _singleton_instance = this;</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">88</td><td class="hits">4</td><td class="source">    self._queue = _.extend({},Neo4jRestful.prototype._queue);</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">90</td><td class="hits">4</td><td class="source">    self._queue.stack = [];</td></tr><tr class="hit"><td class="line">91</td><td class="hits">4</td><td class="source">    self.checkAvailability(function(err, isAvailable, debug) {</td></tr><tr class="hit"><td class="line">92</td><td class="hits">4</td><td class="source">      self.connection_established = isAvailable;</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">96</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.options = null;</td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.header = {</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">    'Accept': 'application/json',</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">    'Content-Type': 'application/json'</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">  };</td></tr><tr class="hit"><td class="line">101</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.timeout = 5000;</td></tr><tr class="hit"><td class="line">102</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.baseUrl = null;</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.debug = null;</td></tr><tr class="hit"><td class="line">104</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype._absoluteUrl = null;</td></tr><tr class="hit"><td class="line">105</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.exact_version = null;</td></tr><tr class="hit"><td class="line">106</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.version = null;</td></tr><tr class="hit"><td class="line">107</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.ignore_exception_pattern = /^(Node|Relationship)NotFoundException$/;</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">109</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype._queue = {</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">    stack: null, // contains all queued requests</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">    interval_id: null, // processes id of interval </td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">    is_processing: false, // flag to avoid async queue process</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">    ping_timeout: 10000, // to avoid endless waiting for a non available service set timeout to 10[s] by default</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">    started_on: null, // used for avoiding endless waiting</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">    max_queue_length: 63</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.connection_established = false;</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">120</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.singleton = function() {</td></tr><tr class="miss"><td class="line">121</td><td class="hits">0</td><td class="source">    if (_singleton_instance)</td></tr><tr class="miss"><td class="line">122</td><td class="hits">0</td><td class="source">      return _singleton_instance;</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">    else {</td></tr><tr class="miss"><td class="line">124</td><td class="hits">0</td><td class="source">      var instance = new Neo4jRestful(null);</td></tr><tr class="miss"><td class="line">125</td><td class="hits">0</td><td class="source">      return instance;</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">128</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.set_singleton_instance = function(instance) {</td></tr><tr class="miss"><td class="line">129</td><td class="hits">0</td><td class="source">    _singleton_instance = instance;</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">132</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.query = function(cypher, options, cb) {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">70</td><td class="source">    var args;</td></tr><tr class="hit"><td class="line">134</td><td class="hits">70</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">135</td><td class="hits">70</td><td class="source">    ( ( args = helpers.sortOptionsAndCallbackArguments(options, cb) ) &amp;&amp; ( options = args.options ) &amp;&amp; ( cb = args.callback ) );</td></tr><tr class="hit"><td class="line">136</td><td class="hits">70</td><td class="source">    if (typeof cypher === 'string') {</td></tr><tr class="hit"><td class="line">137</td><td class="hits">70</td><td class="source">      this.log('**info**', 'cypher:', cypher.trim().replace(/\s+/g,' '));</td></tr><tr class="hit"><td class="line">138</td><td class="hits">70</td><td class="source">      this.post('/db/data/cypher',{</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">        data: {</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">          query: cypher,</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">          params: {}</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">      }, function(err, result, debug){</td></tr><tr class="hit"><td class="line">144</td><td class="hits">70</td><td class="source">        return cb(err, result, debug);</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">149</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.checkAvailability = function(cb) {</td></tr><tr class="hit"><td class="line">150</td><td class="hits">7</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">151</td><td class="hits">7</td><td class="source">    jQuery.ajax({</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">      url: self.baseUrl+'db/data/',</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">      type: 'GET',</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">      cache: false,</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">      timeout: this.timeout,</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">      success: function(res,status) {</td></tr><tr class="hit"><td class="line">157</td><td class="hits">7</td><td class="source">        if ((status === 'success')&amp;&amp;(res)&amp;&amp;(res.neo4j_version)) {</td></tr><tr class="hit"><td class="line">158</td><td class="hits">7</td><td class="source">          self.exact_version = res.neo4j_version;</td></tr><tr class="hit"><td class="line">159</td><td class="hits">7</td><td class="source">          self.version = Number(self.exact_version.replace(/^([0-9]+\.*[0-9]*)(.*)$/, '$1'));</td></tr><tr class="hit"><td class="line">160</td><td class="hits">7</td><td class="source">          var error = (self.version &lt; 2) ? Error('Neo4jMapper is not build+tested for neo4j version below v2') : null;</td></tr><tr class="hit"><td class="line">161</td><td class="hits">7</td><td class="source">          cb(error, res.neo4j_version);</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="miss"><td class="line">163</td><td class="hits">0</td><td class="source">          cb(Error(&quot;Connection established, but can't detect neo4j database version… Sure it's neo4j url?&quot;), null, null);</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">      },</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">      error: function(err) {</td></tr><tr class="miss"><td class="line">167</td><td class="hits">0</td><td class="source">        cb(err, false, err.status);</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">172</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.absoluteUrl = function() {</td></tr><tr class="hit"><td class="line">173</td><td class="hits">227</td><td class="source">    if (this.url) {</td></tr><tr class="hit"><td class="line">174</td><td class="hits">227</td><td class="source">      if (/^(\/\/|http(s)*\:\/\/)/.test(this.url)) {</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">        // TODO: check for http or https, but would cost a extra cb</td></tr><tr class="miss"><td class="line">176</td><td class="hits">0</td><td class="source">        this._absoluteUrl = this.url.replace(/^\/\//,'http://').replace(/^\//,'');</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">      else {</td></tr><tr class="hit"><td class="line">179</td><td class="hits">227</td><td class="source">        this._absoluteUrl = this.baseUrl + this.url.replace(/^\/{1}/,'');</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">181</td><td class="hits">227</td><td class="source">      return this._absoluteUrl;</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">185</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.request = function(url, options, cb) {</td></tr><tr class="hit"><td class="line">186</td><td class="hits">227</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">187</td><td class="hits">227</td><td class="source">    var debug = null;</td></tr><tr class="hit"><td class="line">188</td><td class="hits">227</td><td class="source">    var defaultOptions = {</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">      type: 'GET',</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">      data: null,</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">      debug: false,</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">      // use copy of header, not reference</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">      header: _.extend({},this.header)</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">195</td><td class="hits">227</td><td class="source">    if (typeof options === 'undefined')</td></tr><tr class="miss"><td class="line">196</td><td class="hits">0</td><td class="source">      options = _.extend({},defaultOptions);</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">198</td><td class="hits">227</td><td class="source">      options = _.extend(defaultOptions, options);  </td></tr><tr class="hit"><td class="line">199</td><td class="hits">227</td><td class="source">    this.url = url;</td></tr><tr class="hit"><td class="line">200</td><td class="hits">227</td><td class="source">    var requestedUrl = this.absoluteUrl();</td></tr><tr class="hit"><td class="line">201</td><td class="hits">227</td><td class="source">    var type = options.type;</td></tr><tr class="hit"><td class="line">202</td><td class="hits">227</td><td class="source">    var data = options.data;</td></tr><tr class="hit"><td class="line">203</td><td class="hits">227</td><td class="source">    var header = options.header;</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">205</td><td class="hits">227</td><td class="source">    if ( (typeof data === 'object') &amp;&amp; (data !== null) )</td></tr><tr class="hit"><td class="line">206</td><td class="hits">157</td><td class="source">     data = JSON.stringify(options.data);</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">208</td><td class="hits">227</td><td class="source">    this.log('**debug**', 'URI:', type+&quot;:&quot;+requestedUrl);</td></tr><tr class="hit"><td class="line">209</td><td class="hits">227</td><td class="source">    this.log('**debug**', 'sendedData:', data);</td></tr><tr class="hit"><td class="line">210</td><td class="hits">227</td><td class="source">    this.log('**debug**', 'sendedHeader:', header);</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">    // we can set a debug flag on neo4jrestful</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source">    // to avoid passing each time for every request a debug flag</td></tr><tr class="hit"><td class="line">214</td><td class="hits">227</td><td class="source">    if (this.debug)</td></tr><tr class="hit"><td class="line">215</td><td class="hits">32</td><td class="source">      options.debug = true;</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">217</td><td class="hits">227</td><td class="source">    if (options.debug) {</td></tr><tr class="hit"><td class="line">218</td><td class="hits">32</td><td class="source">      debug = {</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">        options: options,</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">        requested_url: requestedUrl,</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">        type: type,</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source">        data: data,</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">        header: header,</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">        res: null,</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">        status: null,</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">        err: null</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">230</td><td class="hits">227</td><td class="source">    var _options = {</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">      requestedUrl: requestedUrl,</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">      type: type,</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">      data: data,</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">      options: options,</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">      debug: debug,</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">      url: url</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">239</td><td class="hits">227</td><td class="source">    if (!this.connection_established) {</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">      // add to queue</td></tr><tr class="miss"><td class="line">241</td><td class="hits">0</td><td class="source">      if (self._queue.stack.length &lt; self._queue.max_queue_length)</td></tr><tr class="miss"><td class="line">242</td><td class="hits">0</td><td class="source">        self._queue.stack.push({options: _options, cb: cb});</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">      // start interval process</td></tr><tr class="miss"><td class="line">244</td><td class="hits">0</td><td class="source">      this._processQueue(_options,cb);</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">246</td><td class="hits">227</td><td class="source">      return this.makeRequest(_options, cb);</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">250</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype._processQueue = function() {</td></tr><tr class="miss"><td class="line">251</td><td class="hits">0</td><td class="source">    var intervalTime = 50;</td></tr><tr class="miss"><td class="line">252</td><td class="hits">0</td><td class="source">    var self = this;</td></tr><tr class="miss"><td class="line">253</td><td class="hits">0</td><td class="source">    if (!self._queue.started_on)</td></tr><tr class="miss"><td class="line">254</td><td class="hits">0</td><td class="source">      self._queue.started_on = new Date().getTime()</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source">    // only start one interval process per connection object</td></tr><tr class="miss"><td class="line">256</td><td class="hits">0</td><td class="source">    if (!self.query.interval_id) {</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">      // initially we have to start an interval</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">      // for checking constantly for an established connection</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">      // and send the requests</td></tr><tr class="miss"><td class="line">260</td><td class="hits">0</td><td class="source">      self.query.interval_id = setInterval(function(){</td></tr><tr class="miss"><td class="line">261</td><td class="hits">0</td><td class="source">        if ( (self._queue.started_on+self._queue.ping_timeout) &lt; new Date().getTime() ) {</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">          // we reached the timeout</td></tr><tr class="miss"><td class="line">263</td><td class="hits">0</td><td class="source">          var timeoutReachedMessage = &quot;Timeout of &quot;+(Math.round((self._queue.ping_timeout)/100)/10)+&quot;[s] for neo4j '&quot;+self.baseUrl+&quot;' reached&quot;;</td></tr><tr class="miss"><td class="line">264</td><td class="hits">0</td><td class="source">          clearInterval(self.query.interval_id);</td></tr><tr class="miss"><td class="line">265</td><td class="hits">0</td><td class="source">          self.query.interval_id = null;</td></tr><tr class="miss"><td class="line">266</td><td class="hits">0</td><td class="source">          throw Error(timeoutReachedMessage);</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">        // abort here if we have a process running</td></tr><tr class="miss"><td class="line">269</td><td class="hits">0</td><td class="source">        if (self._queue.is_processing)</td></tr><tr class="miss"><td class="line">270</td><td class="hits">0</td><td class="source">          return null;</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">        // process queue only if we have a connection established</td></tr><tr class="miss"><td class="line">272</td><td class="hits">0</td><td class="source">        if ((self.connection_established)&amp;&amp;(self._queue.stack.length &gt; 0)) {</td></tr><tr class="miss"><td class="line">273</td><td class="hits">0</td><td class="source">          var request = self._queue.stack.pop();        </td></tr><tr class="miss"><td class="line">274</td><td class="hits">0</td><td class="source">          self._queue.is_processing = true;</td></tr><tr class="miss"><td class="line">275</td><td class="hits">0</td><td class="source">          self.makeRequest(request.options, function(err, result, debug){</td></tr><tr class="miss"><td class="line">276</td><td class="hits">0</td><td class="source">            self._queue.is_processing = false;</td></tr><tr class="miss"><td class="line">277</td><td class="hits">0</td><td class="source">            request.cb(err, result, debug);</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">          // stop interval if queue is empty</td></tr><tr class="miss"><td class="line">280</td><td class="hits">0</td><td class="source">          if (self._queue.stack.length &lt; 1) {</td></tr><tr class="miss"><td class="line">281</td><td class="hits">0</td><td class="source">            clearInterval(self.query.interval_id);</td></tr><tr class="miss"><td class="line">282</td><td class="hits">0</td><td class="source">            self.query.interval_id = null;</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source">        } else {</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source">          // check constantly availability</td></tr><tr class="miss"><td class="line">286</td><td class="hits">0</td><td class="source">          self._queue.is_processing = true;</td></tr><tr class="miss"><td class="line">287</td><td class="hits">0</td><td class="source">          self.checkAvailability(function(err, isAvailable, debug) {</td></tr><tr class="miss"><td class="line">288</td><td class="hits">0</td><td class="source">            self.connection_established = isAvailable;</td></tr><tr class="miss"><td class="line">289</td><td class="hits">0</td><td class="source">            self._queue.is_processing = false;</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">        </td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source">      }, intervalTime);</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">297</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.onProcess = function(res, next, debug) {</td></tr><tr class="hit"><td class="line">298</td><td class="hits">220</td><td class="source">    if (_.isArray(res)) {</td></tr><tr class="hit"><td class="line">299</td><td class="hits">43</td><td class="source">      for (var i=0; i &lt; res.length; i++) {</td></tr><tr class="hit"><td class="line">300</td><td class="hits">24</td><td class="source">        res[i] = this.createObjectFromResponseData(res[i]);</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">302</td><td class="hits">177</td><td class="source">    } else if (_.isObject(res)) {</td></tr><tr class="hit"><td class="line">303</td><td class="hits">138</td><td class="source">      res = this.createObjectFromResponseData(res);</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">305</td><td class="hits">220</td><td class="source">    next(null, res, debug);</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">308</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.onSuccess = function(next, res, status, options) {</td></tr><tr class="hit"><td class="line">309</td><td class="hits">220</td><td class="source">    if (options.debug) {</td></tr><tr class="hit"><td class="line">310</td><td class="hits">32</td><td class="source">      options._debug.res = res;</td></tr><tr class="hit"><td class="line">311</td><td class="hits">32</td><td class="source">      options._debug.status = status;</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">313</td><td class="hits">220</td><td class="source">    if (status === 'success') {</td></tr><tr class="hit"><td class="line">314</td><td class="hits">220</td><td class="source">      if (typeof this.onProcess === 'function')</td></tr><tr class="hit"><td class="line">315</td><td class="hits">220</td><td class="source">        return this.onProcess(res, next, options._debug);</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source">      else</td></tr><tr class="miss"><td class="line">317</td><td class="hits">0</td><td class="source">        return next(null, res, options._debug);</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">319</td><td class="hits">0</td><td class="source">      next(res, status, options._debug);</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">323</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.onError = function(cb, responseError, res, options) {</td></tr><tr class="hit"><td class="line">324</td><td class="hits">7</td><td class="source">    var err = responseError;</td></tr><tr class="hit"><td class="line">325</td><td class="hits">7</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">326</td><td class="hits">7</td><td class="source">    var statusCode = err.status;</td></tr><tr class="hit"><td class="line">327</td><td class="hits">7</td><td class="source">    var error = ( err &amp;&amp; err.responseText ) ? Error(err.responseText) : err;</td></tr><tr class="hit"><td class="line">328</td><td class="hits">7</td><td class="source">    if (options.debug) {</td></tr><tr class="miss"><td class="line">329</td><td class="hits">0</td><td class="source">      options._debug.res = res;</td></tr><tr class="miss"><td class="line">330</td><td class="hits">0</td><td class="source">      options._debug.err = err;</td></tr><tr class="miss"><td class="line">331</td><td class="hits">0</td><td class="source">      options._debug.error = error;</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">334</td><td class="hits">7</td><td class="source">    try {</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source">      // try to extract the first &lt;p&gt; or &lt;pre&gt; from html body, else return error object for better debugging</td></tr><tr class="hit"><td class="line">336</td><td class="hits">7</td><td class="source">      if (jQuery(err.responseText).find('body pre:first, body p:first')[0])</td></tr><tr class="miss"><td class="line">337</td><td class="hits">0</td><td class="source">        err.responseText = jQuery(err.responseText).find('body pre:first, body p:first').first().text().trim().replace(/(\s|\n)+/g,' ');</td></tr><tr class="miss"><td class="line">338</td><td class="hits">0</td><td class="source">      else if (jQuery(err.responseText).text()) {</td></tr><tr class="miss"><td class="line">339</td><td class="hits">0</td><td class="source">        err.responseText = jQuery(err.responseText).text().trim();</td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">341</td><td class="hits"></td><td class="source">    } catch(e) {</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">      // ignore exception</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source">    // try to create a valuable error object from response</td></tr><tr class="hit"><td class="line">345</td><td class="hits">7</td><td class="source">    if ((err)&amp;&amp;(err.responseText)&amp;&amp;(typeof err.responseText === 'string')) {</td></tr><tr class="hit"><td class="line">346</td><td class="hits">7</td><td class="source">      try {</td></tr><tr class="hit"><td class="line">347</td><td class="hits">7</td><td class="source">        var err = JSON.parse(err.responseText);</td></tr><tr class="hit"><td class="line">348</td><td class="hits">7</td><td class="source">        var ErrorHandler = (/^(\/)*db\/data(\/)*$/.test(options.url)) ? CypherQueryError : QueryError;</td></tr><tr class="hit"><td class="line">349</td><td class="hits">7</td><td class="source">        err = new ErrorHandler(err.message, {</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source">          stacktrace: err.stacktrace,</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source">          exception: err.exception,</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source">          statusCode: statusCode,</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source">          url: options.url,</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source">          method: options.method,</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source">          data: data</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source">      } catch (e) {</td></tr><tr class="hit"><td class="line">358</td><td class="hits">7</td><td class="source">        self.log('**debug** Could not create/parse a valuable error object', e);</td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">361</td><td class="hits">7</td><td class="source">    if ( (err.exception) &amp;&amp; (self.ignore_exception_pattern) &amp;&amp; (self.ignore_exception_pattern.test(err.exception)) ) {</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">      // we ignore by default notfound exceptions, because they are no &quot;syntactical&quot; errors</td></tr><tr class="hit"><td class="line">363</td><td class="hits">2</td><td class="source">      return cb(null, null, options._debug);</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">    } else {</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source">      // console.log('(!!!')</td></tr><tr class="hit"><td class="line">366</td><td class="hits">5</td><td class="source">      return cb(err, null, options._debug);</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">371</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.makeRequest = function(_options, cb) {</td></tr><tr class="hit"><td class="line">372</td><td class="hits">227</td><td class="source">    _options = _.extend({</td></tr><tr><td class="line">373</td><td class="hits"></td><td class="source">      cache: false,</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source">      timeout: 1000,</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">      loadNode: true // enables the load hooks</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source">    }, _options);</td></tr><tr class="hit"><td class="line">377</td><td class="hits">227</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">378</td><td class="hits">227</td><td class="source">    var data = _options.data;</td></tr><tr class="hit"><td class="line">379</td><td class="hits">227</td><td class="source">    var options = _options.options;</td></tr><tr class="hit"><td class="line">380</td><td class="hits">227</td><td class="source">    options.absolute_url = _options.requestedUrl;</td></tr><tr class="hit"><td class="line">381</td><td class="hits">227</td><td class="source">    options.url = _options.url;</td></tr><tr class="hit"><td class="line">382</td><td class="hits">227</td><td class="source">    options.method = _options.type;</td></tr><tr class="hit"><td class="line">383</td><td class="hits">227</td><td class="source">    options._debug = _options.debug;</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">385</td><td class="hits">227</td><td class="source">    jQuery.ajax({</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source">      url: options.absolute_url,</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source">      type: options.method,</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source">      headers: this.header,</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source">      data: data,</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">      cache: _options.cache,</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source">      timeout: _options.timeout,</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source">      success: function(res,status) {</td></tr><tr class="hit"><td class="line">393</td><td class="hits">220</td><td class="source">        self.onSuccess(cb, res, status, options);</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source">      },</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source">      error: function(err, res) {</td></tr><tr class="hit"><td class="line">396</td><td class="hits">7</td><td class="source">        self.onError(cb, err, res, options);</td></tr><tr><td class="line">397</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source">    })</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">401</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.get = function(url, options, cb) {</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source">    // TODO: distinct between jquery and request module</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source">    // shorthand, because it's copied on many methods</td></tr><tr class="hit"><td class="line">404</td><td class="hits">52</td><td class="source">    var args;</td></tr><tr class="hit"><td class="line">405</td><td class="hits">52</td><td class="source">    ( ( args = helpers.sortOptionsAndCallbackArguments(options, cb) ) &amp;&amp; ( options = args.options ) &amp;&amp; ( cb = args.callback ) &amp;&amp; ( options.type = 'GET' ) );</td></tr><tr class="hit"><td class="line">406</td><td class="hits">52</td><td class="source">    return this.request(url, options, cb);</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">409</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.post = function(url, options, cb) {</td></tr><tr class="hit"><td class="line">410</td><td class="hits">147</td><td class="source">    var args;</td></tr><tr class="hit"><td class="line">411</td><td class="hits">147</td><td class="source">    ( ( args = helpers.sortOptionsAndCallbackArguments(options, cb) ) &amp;&amp; ( options = args.options ) &amp;&amp; ( cb = args.callback ) &amp;&amp; ( options.type = 'POST' ) );</td></tr><tr class="hit"><td class="line">412</td><td class="hits">147</td><td class="source">    return this.request(url, options, cb);</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">414</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.put = function(url, options, cb) {</td></tr><tr class="hit"><td class="line">415</td><td class="hits">10</td><td class="source">    var args;</td></tr><tr class="hit"><td class="line">416</td><td class="hits">10</td><td class="source">    ( ( args = helpers.sortOptionsAndCallbackArguments(options, cb) ) &amp;&amp; ( options = args.options ) &amp;&amp; ( cb = args.callback ) &amp;&amp; ( options.type = 'PUT' ) );</td></tr><tr class="hit"><td class="line">417</td><td class="hits">10</td><td class="source">    return this.request(url, options, cb);</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">420</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.delete = function(url, options, cb) {</td></tr><tr class="hit"><td class="line">421</td><td class="hits">18</td><td class="source">    var args;</td></tr><tr class="hit"><td class="line">422</td><td class="hits">18</td><td class="source">    ( ( args = helpers.sortOptionsAndCallbackArguments(options, cb) ) &amp;&amp; ( options = args.options ) &amp;&amp; ( cb = args.callback ) &amp;&amp; ( options.type = 'DELETE' ) );</td></tr><tr class="hit"><td class="line">423</td><td class="hits">18</td><td class="source">    return this.request(url, options, cb);</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">426</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.log = function(){ /* &gt; /dev/null */ };</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">428</td><td class="hits">1</td><td class="source">  Neo4jRestful.prototype.createObjectFromResponseData = function(responseData, Class) {</td></tr><tr class="hit"><td class="line">429</td><td class="hits">205</td><td class="source">    var uri = (responseData) ? responseData.self : null;</td></tr><tr class="hit"><td class="line">430</td><td class="hits">205</td><td class="source">    var useLabels = true;</td></tr><tr class="hit"><td class="line">431</td><td class="hits">205</td><td class="source">    if (typeof Class !== 'function')</td></tr><tr class="hit"><td class="line">432</td><td class="hits">162</td><td class="source">      Class = Node;</td></tr><tr class="hit"><td class="line">433</td><td class="hits">205</td><td class="source">    if (uri) {</td></tr><tr class="hit"><td class="line">434</td><td class="hits">111</td><td class="source">      if (/\/db\/data\/node\/[1-9]{1}[0-9]*\/*$/.test(uri)) {</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source">        // we have a node or an inheriated class</td></tr><tr class="hit"><td class="line">436</td><td class="hits">85</td><td class="source">        var n = new Class();</td></tr><tr class="hit"><td class="line">437</td><td class="hits">85</td><td class="source">        n = n.populateWithDataFromResponse(responseData);</td></tr><tr class="hit"><td class="line">438</td><td class="hits">85</td><td class="source">        return n;</td></tr><tr class="hit"><td class="line">439</td><td class="hits">26</td><td class="source">      } else if (/\/db\/data\/relationship\/[1-9]{1}[0-9]*\/*$/.test(uri)) {</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source">        // we have a relationship</td></tr><tr class="hit"><td class="line">441</td><td class="hits">26</td><td class="source">        var r = new Relationship();</td></tr><tr class="hit"><td class="line">442</td><td class="hits">26</td><td class="source">        r = r.populateWithDataFromResponse(responseData);</td></tr><tr class="hit"><td class="line">443</td><td class="hits">26</td><td class="source">        return r;</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">447</td><td class="hits">94</td><td class="source">      if ((_.isNumber(responseData.length))&amp;&amp;(_.isString(responseData.start))) {</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">        // we have a path</td></tr><tr class="hit"><td class="line">449</td><td class="hits">1</td><td class="source">        var p = new Path();</td></tr><tr class="hit"><td class="line">450</td><td class="hits">1</td><td class="source">        p = p.populateWithDataFromResponse(responseData);</td></tr><tr class="hit"><td class="line">451</td><td class="hits">1</td><td class="source">        return p;</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">453</td><td class="hits">93</td><td class="source">    return responseData;</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">456</td><td class="hits">1</td><td class="source">  return Neo4jRestful;</td></tr><tr><td class="line">457</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">460</td><td class="hits">1</td><td class="source">if (typeof window !== 'object') {</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source">  // nodejs</td></tr><tr class="hit"><td class="line">462</td><td class="hits">1</td><td class="source">  initNeo4jRestful();</td></tr><tr class="hit"><td class="line">463</td><td class="hits">1</td><td class="source">  module.exports = exports = Neo4jRestful;</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/philipp/code/neo4jmapper/src/node.js">/Users/philipp/code/neo4jmapper/src/node.js</h2><div id="stats" class="high"><div class="percentage">82%</div><div class="sloc">979</div><div class="hits">809</div><div class="misses">170</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var initNode = function(neo4jrestful) {</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">10</td><td class="source">  var _neo4jrestful = null</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">    , helpers = null</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">    , _ = null;</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">10</td><td class="source">  if (typeof window === 'object') {</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    // browser</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    // TODO: find a solution for bson object id</td></tr><tr class="miss"><td class="line">10</td><td class="hits">0</td><td class="source">    helpers = neo4jmapper_helpers;</td></tr><tr class="miss"><td class="line">11</td><td class="hits">0</td><td class="source">    _       = window._;</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  } else {</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    // nodejs</td></tr><tr class="hit"><td class="line">14</td><td class="hits">10</td><td class="source">    helpers  = require('./helpers');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">10</td><td class="source">    _        = require('underscore')</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  // we can only check for object type,</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  // better would be to check for constructor neo4jrestful</td></tr><tr class="hit"><td class="line">20</td><td class="hits">10</td><td class="source">  if (_.isObject(neo4jrestful))</td></tr><tr class="hit"><td class="line">21</td><td class="hits">10</td><td class="source">    _neo4jrestful = neo4jrestful;</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">10</td><td class="source">  var cypher_defaults = {</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    limit: '',</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    skip: '',</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    sort: '',</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    filter: '',</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    match: '',</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    return_properties: [],</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    where: [],</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    // and_where: [],</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    from: null,</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    to: null,</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    direction: null,</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    order_by: '',</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">    order_direction: 'ASC',</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    relation: '',</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">    outgoing: null,</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    incoming: null,</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    With: null,</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">    distinct: null,</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">    label: null,</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    node_identifier: null, // can be a|b|n</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    by_id: null,</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    // flasgs</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    _count: null,</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    _distinct: null,</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    _find_by_id: null</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">   * Constructor</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">54</td><td class="hits">10</td><td class="source">  Node = function Node(data, id) {</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    // will be used for labels and classes</td></tr><tr class="hit"><td class="line">56</td><td class="hits">252</td><td class="source">    if (!this.constructor_name)</td></tr><tr class="hit"><td class="line">57</td><td class="hits">252</td><td class="source">      this.constructor_name = helpers.constructorNameOfFunction(this) || 'Node';</td></tr><tr class="hit"><td class="line">58</td><td class="hits">252</td><td class="source">    this.init(data, id);</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">61</td><td class="hits">10</td><td class="source">  Node.prototype.init = function(data, id) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">253</td><td class="source">    this.id = id || null;</td></tr><tr class="hit"><td class="line">63</td><td class="hits">253</td><td class="source">    this.data = _.extend({}, data);</td></tr><tr class="hit"><td class="line">64</td><td class="hits">253</td><td class="source">    this.resetQuery();</td></tr><tr class="hit"><td class="line">65</td><td class="hits">253</td><td class="source">    if (id) {</td></tr><tr class="hit"><td class="line">66</td><td class="hits">15</td><td class="source">      this.setUriById(id);</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">    // nested objects must be extended nestedly</td></tr><tr class="hit"><td class="line">69</td><td class="hits">253</td><td class="source">    this.fields = _.extend({}, {</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">      defaults: _.extend({}, this.fields.defaults),</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">      indexes: _.extend({}, this.fields.indexes),</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">      unique: _.extend({}, this.fields.unique)</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">74</td><td class="hits">253</td><td class="source">    this.labels = [];</td></tr><tr class="hit"><td class="line">75</td><td class="hits">253</td><td class="source">    this.is_instanced = true;</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">    // we will use a label by default if we have defined an inherited class of node</td></tr><tr class="hit"><td class="line">77</td><td class="hits">253</td><td class="source">    if ((this.constructor_name !== 'Node')&amp;&amp;(this.constructor_name !== 'Relationship')&amp;&amp;(this.constructor_name !== 'Path')) {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">38</td><td class="source">      this.label = this.cypher.label = this.constructor_name;</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">   * Instantiate a node from a specific model</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">   * Model can be a constructor() or a 'string'</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">   * and must be registered in Node::registered_models()</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">87</td><td class="hits">10</td><td class="source">  Node.prototype.convert_node_to_model = function(node, model, fallbackModel) {</td></tr><tr class="hit"><td class="line">88</td><td class="hits">4</td><td class="source">    if (node.hasId()) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">4</td><td class="source">      if (typeof fallbackModel !== 'function')</td></tr><tr class="hit"><td class="line">90</td><td class="hits">1</td><td class="source">        fallbackModel = this.constructor;</td></tr><tr class="hit"><td class="line">91</td><td class="hits">4</td><td class="source">      if (typeof model === 'function') {</td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">        model = model.constructor_name || helpers.constructorNameOfFunction(model) || null;</td></tr><tr class="hit"><td class="line">93</td><td class="hits">3</td><td class="source">      } else if (node.label) {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">3</td><td class="source">        model = node.label;</td></tr><tr class="miss"><td class="line">95</td><td class="hits">0</td><td class="source">      } else if (typeof fallbackModel === 'function') {</td></tr><tr class="miss"><td class="line">96</td><td class="hits">0</td><td class="source">        model = helpers.constructorNameOfFunction(fallbackModel);</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="miss"><td class="line">98</td><td class="hits">0</td><td class="source">        throw Error('No model or label found')</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">100</td><td class="hits">4</td><td class="source">      var Class = node.registered_model(model) || fallbackModel;</td></tr><tr class="hit"><td class="line">101</td><td class="hits">4</td><td class="source">      var singleton = new Class()</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">      // node.constructor_name = singleton.constructor_name;</td></tr><tr class="hit"><td class="line">103</td><td class="hits">4</td><td class="source">      return node.copyTo(singleton);</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">105</td><td class="hits">0</td><td class="source">    return null;</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">108</td><td class="hits">10</td><td class="source">  Node.prototype.neo4jrestful = _neo4jrestful;</td></tr><tr class="hit"><td class="line">109</td><td class="hits">10</td><td class="source">  Node.prototype.data = {};</td></tr><tr class="hit"><td class="line">110</td><td class="hits">10</td><td class="source">  Node.prototype.id = null;</td></tr><tr class="hit"><td class="line">111</td><td class="hits">10</td><td class="source">  Node.prototype._id_ = null; // _id_ is the private key store to ensure that this.id deosn't get manipulated accidently</td></tr><tr class="hit"><td class="line">112</td><td class="hits">10</td><td class="source">  Node.prototype.fields = {</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">    defaults: {},</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">    indexes: {},</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">    unique: {}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">118</td><td class="hits">10</td><td class="source">  Node.prototype.uri = null;</td></tr><tr class="hit"><td class="line">119</td><td class="hits">10</td><td class="source">  Node.prototype._response = null;</td></tr><tr class="hit"><td class="line">120</td><td class="hits">10</td><td class="source">  Node.prototype._modified_query = false;</td></tr><tr class="hit"><td class="line">121</td><td class="hits">10</td><td class="source">  Node.prototype.is_singleton = false;</td></tr><tr class="hit"><td class="line">122</td><td class="hits">10</td><td class="source">  Node.prototype.is_persisted = false;</td></tr><tr class="hit"><td class="line">123</td><td class="hits">10</td><td class="source">  Node.prototype.cypher = {};</td></tr><tr class="hit"><td class="line">124</td><td class="hits">10</td><td class="source">  Node.prototype.is_instanced = null;</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">126</td><td class="hits">10</td><td class="source">  Node.prototype.labels = null;</td></tr><tr class="hit"><td class="line">127</td><td class="hits">10</td><td class="source">  Node.prototype.label = null;</td></tr><tr class="hit"><td class="line">128</td><td class="hits">10</td><td class="source">  Node.prototype.constructor_name = null;</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">130</td><td class="hits">10</td><td class="source">  Node.prototype.__models__ = {};</td></tr><tr class="hit"><td class="line">131</td><td class="hits">10</td><td class="source">  Node.prototype.__already_initialized__ = false; // flag to avoid many initializations</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">  // you should **never** change this value</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">  // it's used to dictinct nodes and relationships</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">  // many queries containg `node()` command will use this value</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">  // e.g. n = node(*)</td></tr><tr class="hit"><td class="line">137</td><td class="hits">10</td><td class="source">  Node.prototype.__type__ = 'node';</td></tr><tr class="hit"><td class="line">138</td><td class="hits">10</td><td class="source">  Node.prototype.__type_identifier__ = 'n';</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">141</td><td class="hits">10</td><td class="source">  Node.prototype.singleton = function(id) {</td></tr><tr class="hit"><td class="line">142</td><td class="hits">98</td><td class="source">    var Class = this.constructor;</td></tr><tr class="hit"><td class="line">143</td><td class="hits">98</td><td class="source">    var node = new Class({},id);</td></tr><tr class="hit"><td class="line">144</td><td class="hits">98</td><td class="source">    node.neo4jrestful = _neo4jrestful;</td></tr><tr class="hit"><td class="line">145</td><td class="hits">98</td><td class="source">    node.resetQuery();</td></tr><tr class="hit"><td class="line">146</td><td class="hits">98</td><td class="source">    node.is_singleton = true;</td></tr><tr class="hit"><td class="line">147</td><td class="hits">98</td><td class="source">    node.resetQuery();</td></tr><tr class="hit"><td class="line">148</td><td class="hits">98</td><td class="source">    return node;</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">151</td><td class="hits">10</td><td class="source">  Node.prototype.initialize = function(cb) {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">10</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">153</td><td class="hits">10</td><td class="source">    if (typeof cb !== 'function')</td></tr><tr class="hit"><td class="line">154</td><td class="hits">9</td><td class="source">      cb = function() { /* /dev/null */ };</td></tr><tr class="hit"><td class="line">155</td><td class="hits">10</td><td class="source">    if (!this.__already_initialized__) {</td></tr><tr class="hit"><td class="line">156</td><td class="hits">9</td><td class="source">      return this.onBeforeInitialize(function(err){</td></tr><tr class="hit"><td class="line">157</td><td class="hits">9</td><td class="source">        self.onAfterInitialize(cb);</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">160</td><td class="hits">1</td><td class="source">      return cb(null, null);</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">164</td><td class="hits">19</td><td class="source">  Node.prototype.onBeforeInitialize = function(next) { next(null,null); }</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">166</td><td class="hits">10</td><td class="source">  Node.prototype.onAfterInitialize = function(cb) {</td></tr><tr class="hit"><td class="line">167</td><td class="hits">9</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">168</td><td class="hits">9</td><td class="source">    this.__already_initialized__ = true;</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">    // Index fields</td></tr><tr class="hit"><td class="line">170</td><td class="hits">9</td><td class="source">    var fieldsToIndex = this.fieldsToIndex();</td></tr><tr class="hit"><td class="line">171</td><td class="hits">9</td><td class="source">    var fieldsWithUniqueValues = this.fieldsWithUniqueValues();</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">    // we create an object to get the label</td></tr><tr class="hit"><td class="line">173</td><td class="hits">9</td><td class="source">    var node = new this.constructor();</td></tr><tr class="hit"><td class="line">174</td><td class="hits">9</td><td class="source">    var label = node.label;</td></tr><tr class="hit"><td class="line">175</td><td class="hits">9</td><td class="source">    if (label) {</td></tr><tr class="hit"><td class="line">176</td><td class="hits">9</td><td class="source">      if (fieldsToIndex) {</td></tr><tr class="hit"><td class="line">177</td><td class="hits">2</td><td class="source">        var jobsToBeDone = Object.keys(fieldsToIndex).length;</td></tr><tr class="hit"><td class="line">178</td><td class="hits">2</td><td class="source">        var errors  = [];</td></tr><tr class="hit"><td class="line">179</td><td class="hits">2</td><td class="source">        var results = [];</td></tr><tr class="hit"><td class="line">180</td><td class="hits">2</td><td class="source">        var debugs  = []</td></tr><tr class="hit"><td class="line">181</td><td class="hits">2</td><td class="source">        _.each(fieldsToIndex, function(toBeIndexed, field) {</td></tr><tr class="hit"><td class="line">182</td><td class="hits">3</td><td class="source">          if (toBeIndexed === true) {</td></tr><tr class="hit"><td class="line">183</td><td class="hits">3</td><td class="source">            self.neo4jrestful.query('CREATE INDEX ON :'+label+'(`'+field+'`);', function(err, result, debug) {</td></tr><tr class="hit"><td class="line">184</td><td class="hits">3</td><td class="source">              if (err)</td></tr><tr class="hit"><td class="line">185</td><td class="hits">3</td><td class="source">                errors.push(err);</td></tr><tr class="hit"><td class="line">186</td><td class="hits">3</td><td class="source">              if (result)</td></tr><tr class="miss"><td class="line">187</td><td class="hits">0</td><td class="source">                results.push(result);</td></tr><tr class="hit"><td class="line">188</td><td class="hits">3</td><td class="source">              if (debug)</td></tr><tr class="miss"><td class="line">189</td><td class="hits">0</td><td class="source">                debugs.push(debugs);</td></tr><tr class="hit"><td class="line">190</td><td class="hits">3</td><td class="source">              jobsToBeDone--;</td></tr><tr class="hit"><td class="line">191</td><td class="hits">3</td><td class="source">              if (jobsToBeDone === 0) {</td></tr><tr class="hit"><td class="line">192</td><td class="hits">2</td><td class="source">                cb((errors.length &gt; 0) ? errors : null, results, (debugs.length &gt; 0) ? debugs : null);</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">              }</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">      // inactive</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">      // http://docs.neo4j.org/chunked/snapshot/query-constraints.html</td></tr><tr class="hit"><td class="line">200</td><td class="hits">9</td><td class="source">      if (fieldsWithUniqueValues === 'deactivated, because it´s not implemented in neo4j, yet') {</td></tr><tr class="miss"><td class="line">201</td><td class="hits">0</td><td class="source">        _.each(fieldsWithUniqueValues, function(isUnique, field) {</td></tr><tr class="miss"><td class="line">202</td><td class="hits">0</td><td class="source">          if (isUnique)</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">            //CREATE CONSTRAINT ON (book:Book) ASSERT book.isbn IS UNIQUE</td></tr><tr class="miss"><td class="line">204</td><td class="hits">0</td><td class="source">            self.neo4jrestful.query('CREATE CONSTRAINT ON (n:'+label+') ASSERT n.`'+field+'` IS UNIQUE;', function(err, result, debug) {</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">              // maybe better ways how to report if an error occurs</td></tr><tr class="miss"><td class="line">206</td><td class="hits">0</td><td class="source">              cb(err, result, debug);</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">211</td><td class="hits">0</td><td class="source">      cb(Error('No label found'), null);</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">   * Copys only the relevant data(s) of a node to another object</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">218</td><td class="hits">10</td><td class="source">  Node.prototype.copyTo = function(n) {</td></tr><tr class="hit"><td class="line">219</td><td class="hits">78</td><td class="source">    n.id = n._id_ = this._id_;</td></tr><tr class="hit"><td class="line">220</td><td class="hits">78</td><td class="source">    n.data   = _.extend(this.data);</td></tr><tr class="hit"><td class="line">221</td><td class="hits">78</td><td class="source">    n.labels = _.clone(this.labels);</td></tr><tr class="hit"><td class="line">222</td><td class="hits">78</td><td class="source">    if (this.label)</td></tr><tr class="hit"><td class="line">223</td><td class="hits">4</td><td class="source">      n.label  = this.label;</td></tr><tr class="hit"><td class="line">224</td><td class="hits">78</td><td class="source">    n.uri = this.uri;</td></tr><tr class="hit"><td class="line">225</td><td class="hits">78</td><td class="source">    n._response = _.extend(this._response);</td></tr><tr class="hit"><td class="line">226</td><td class="hits">78</td><td class="source">    return n;</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">  // TODO: implement createByLabel(label)</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">231</td><td class="hits">10</td><td class="source">  Node.prototype.register_model = function(Class, label, cb) {</td></tr><tr class="hit"><td class="line">232</td><td class="hits">10</td><td class="source">    var name = helpers.constructorNameOfFunction(Class);</td></tr><tr class="hit"><td class="line">233</td><td class="hits">10</td><td class="source">    if (typeof label === 'string') {</td></tr><tr class="miss"><td class="line">234</td><td class="hits">0</td><td class="source">      name = label; </td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">236</td><td class="hits">10</td><td class="source">      cb = label;</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">238</td><td class="hits">10</td><td class="source">    Node.prototype.__models__[name] = Class;</td></tr><tr class="hit"><td class="line">239</td><td class="hits">10</td><td class="source">    Class.prototype.initialize(cb);</td></tr><tr class="hit"><td class="line">240</td><td class="hits">10</td><td class="source">    return Class;</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">243</td><td class="hits">10</td><td class="source">  Node.prototype.unregister_model = function(Class) {</td></tr><tr class="hit"><td class="line">244</td><td class="hits">2</td><td class="source">    var name = (typeof Class === 'string') ? Class : helpers.constructorNameOfFunction(Class);</td></tr><tr class="hit"><td class="line">245</td><td class="hits">2</td><td class="source">    if (typeof Node.prototype.__models__[name] === 'function')</td></tr><tr class="hit"><td class="line">246</td><td class="hits">2</td><td class="source">      delete Node.prototype.__models__[name];</td></tr><tr class="hit"><td class="line">247</td><td class="hits">2</td><td class="source">    return Node.prototype.__models__;</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">250</td><td class="hits">10</td><td class="source">  Node.prototype.registered_models = function() {</td></tr><tr class="hit"><td class="line">251</td><td class="hits">14</td><td class="source">    return Node.prototype.__models__;</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">254</td><td class="hits">10</td><td class="source">  Node.prototype.registered_model = function(model) {</td></tr><tr class="hit"><td class="line">255</td><td class="hits">11</td><td class="source">    if (typeof model === 'function') {</td></tr><tr class="miss"><td class="line">256</td><td class="hits">0</td><td class="source">      model = helpers.constructorNameOfFunction(model);</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">258</td><td class="hits">11</td><td class="source">    return this.registered_models()[model] || null;</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">261</td><td class="hits">10</td><td class="source">  Node.prototype.resetQuery = function() {</td></tr><tr class="hit"><td class="line">262</td><td class="hits">449</td><td class="source">    this.cypher = {}</td></tr><tr class="hit"><td class="line">263</td><td class="hits">449</td><td class="source">    _.extend(this.cypher, cypher_defaults);</td></tr><tr class="hit"><td class="line">264</td><td class="hits">449</td><td class="source">    this.cypher.where = [];</td></tr><tr class="hit"><td class="line">265</td><td class="hits">449</td><td class="source">    this.cypher.match = [];</td></tr><tr class="hit"><td class="line">266</td><td class="hits">449</td><td class="source">    this.cypher.return_properties = [];</td></tr><tr class="hit"><td class="line">267</td><td class="hits">449</td><td class="source">    this._modified_query = false;</td></tr><tr class="hit"><td class="line">268</td><td class="hits">449</td><td class="source">    if (this.id)</td></tr><tr class="hit"><td class="line">269</td><td class="hits">19</td><td class="source">      this.cypher.from = this.id;</td></tr><tr class="hit"><td class="line">270</td><td class="hits">449</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">273</td><td class="hits">10</td><td class="source">  Node.prototype.hasId = function() {</td></tr><tr class="hit"><td class="line">274</td><td class="hits">244</td><td class="source">    return ((this.is_instanced) &amp;&amp; (this.id &gt; 0)) ? true : false;</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">277</td><td class="hits">10</td><td class="source">  Node.prototype.setUriById = function(id) {</td></tr><tr class="hit"><td class="line">278</td><td class="hits">15</td><td class="source">    if (_.isNumber(id))</td></tr><tr class="hit"><td class="line">279</td><td class="hits">15</td><td class="source">      return this.uri = this.neo4jrestful.baseUrl+'db/data/node/'+id;</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">282</td><td class="hits">10</td><td class="source">  Node.prototype.flattenData = function(useReference) {</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source">    // strongly recommend not to mutate attached node's data</td></tr><tr class="hit"><td class="line">284</td><td class="hits">68</td><td class="source">    if (typeof useReference !== 'boolean')</td></tr><tr class="hit"><td class="line">285</td><td class="hits">68</td><td class="source">      useReference = false;</td></tr><tr class="hit"><td class="line">286</td><td class="hits">68</td><td class="source">    this._modified_query = false;</td></tr><tr class="hit"><td class="line">287</td><td class="hits">68</td><td class="source">    if ((typeof this.data === 'object') &amp;&amp; (this.data !== null)) {</td></tr><tr class="hit"><td class="line">288</td><td class="hits">68</td><td class="source">      var data = (useReference) ? this.data : _.extend(this.data);</td></tr><tr class="hit"><td class="line">289</td><td class="hits">68</td><td class="source">      data = helpers.flattenObject(data);</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source">      // remove null values since nodejs cant store them</td></tr><tr class="hit"><td class="line">291</td><td class="hits">68</td><td class="source">      for(var key in data) {</td></tr><tr class="hit"><td class="line">292</td><td class="hits">105</td><td class="source">        if ((typeof data[key] === 'undefined') || (data[key]===null))</td></tr><tr class="miss"><td class="line">293</td><td class="hits">0</td><td class="source">          delete data[key];</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">295</td><td class="hits">68</td><td class="source">      return data;</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">297</td><td class="hits">0</td><td class="source">    return this.data;</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">300</td><td class="hits">10</td><td class="source">  Node.prototype.unflattenData = function(useReference) {</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source">    // strongly recommend not to mutate attached node's data</td></tr><tr class="hit"><td class="line">302</td><td class="hits">85</td><td class="source">    if (typeof useReference !== 'boolean')</td></tr><tr class="hit"><td class="line">303</td><td class="hits">85</td><td class="source">      useReference = false;</td></tr><tr class="hit"><td class="line">304</td><td class="hits">85</td><td class="source">    this._modified_query = false;</td></tr><tr class="hit"><td class="line">305</td><td class="hits">85</td><td class="source">    var data = (useReference) ? this.data : _.extend(this.data);</td></tr><tr class="hit"><td class="line">306</td><td class="hits">85</td><td class="source">    return helpers.unflattenObject(data);</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">309</td><td class="hits">10</td><td class="source">  Node.prototype.hasValidData = function() {</td></tr><tr class="hit"><td class="line">310</td><td class="hits">39</td><td class="source">    return helpers.isValidData(this.data);</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">313</td><td class="hits">10</td><td class="source">  Node.prototype.applyDefaultValues = function() {</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source">    // flatten data and defaults</td></tr><tr class="hit"><td class="line">315</td><td class="hits">39</td><td class="source">    var data     = helpers.flattenObject(this.data);</td></tr><tr class="hit"><td class="line">316</td><td class="hits">39</td><td class="source">    var defaults = helpers.flattenObject(this.fields.defaults);</td></tr><tr class="hit"><td class="line">317</td><td class="hits">39</td><td class="source">    for (var key in defaults) {</td></tr><tr class="hit"><td class="line">318</td><td class="hits">33</td><td class="source">      if (((typeof data[key] === 'undefined')||(data[key] === null))&amp;&amp;(typeof defaults[key] !== 'undefined'))</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source">        // set a default value by defined function</td></tr><tr class="hit"><td class="line">320</td><td class="hits">33</td><td class="source">        if (typeof defaults[key] === 'function')</td></tr><tr class="hit"><td class="line">321</td><td class="hits">16</td><td class="source">          data[key] = defaults[key](this);</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source">        else</td></tr><tr class="hit"><td class="line">323</td><td class="hits">17</td><td class="source">          data[key] = defaults[key];</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">325</td><td class="hits">39</td><td class="source">    this.data = helpers.unflattenObject(data);</td></tr><tr class="hit"><td class="line">326</td><td class="hits">39</td><td class="source">    return this;</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">329</td><td class="hits">10</td><td class="source">  Node.prototype.hasFieldsToIndex = function() {</td></tr><tr class="hit"><td class="line">330</td><td class="hits">53</td><td class="source">    if (this.hasId())</td></tr><tr class="hit"><td class="line">331</td><td class="hits">53</td><td class="source">      return _.keys(this.fields.indexes).length;</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source">    else</td></tr><tr class="miss"><td class="line">333</td><td class="hits">0</td><td class="source">      return null;</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">336</td><td class="hits">10</td><td class="source">  Node.prototype.fieldsToIndex = function() {</td></tr><tr class="hit"><td class="line">337</td><td class="hits">25</td><td class="source">    return ( (this.fields.indexes) &amp;&amp; (_.keys(this.fields.indexes).length &gt; 0) ) ? helpers.flattenObject(this.fields.indexes) : null;</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">340</td><td class="hits">10</td><td class="source">  Node.prototype.fieldsWithUniqueValues = function() {</td></tr><tr class="hit"><td class="line">341</td><td class="hits">9</td><td class="source">    return ( (this.fields.unique) &amp;&amp; (_.keys(this.fields.unique).length &gt; 0) ) ? this.fields.unique : null;</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">344</td><td class="hits">10</td><td class="source">  Node.prototype.indexFields = function(cb) {</td></tr><tr class="hit"><td class="line">345</td><td class="hits">16</td><td class="source">    if (this.hasFieldsToIndex()) {</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source">      // var join = Join.create();</td></tr><tr class="hit"><td class="line">347</td><td class="hits">16</td><td class="source">      var doneCount = 0;</td></tr><tr class="hit"><td class="line">348</td><td class="hits">16</td><td class="source">      var fieldsToIndex = this.fieldsToIndex();</td></tr><tr class="hit"><td class="line">349</td><td class="hits">16</td><td class="source">      var todoCount = 0;</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source">      // var max = Object.keys(fieldsToIndex).length;</td></tr><tr class="hit"><td class="line">351</td><td class="hits">16</td><td class="source">      for (var key in fieldsToIndex) {</td></tr><tr class="hit"><td class="line">352</td><td class="hits">17</td><td class="source">        var namespace = this.fields.indexes[key];</td></tr><tr class="hit"><td class="line">353</td><td class="hits">17</td><td class="source">        var value = this.data[key];</td></tr><tr class="hit"><td class="line">354</td><td class="hits">17</td><td class="source">        if ((_.isString(namespace))&amp;&amp;(typeof value !== 'undefined')&amp;&amp;(value !== null)) {</td></tr><tr class="hit"><td class="line">355</td><td class="hits">14</td><td class="source">          todoCount++;</td></tr><tr class="hit"><td class="line">356</td><td class="hits">14</td><td class="source">          this.addIndex(namespace, key, value, function(err, data, debug){</td></tr><tr class="hit"><td class="line">357</td><td class="hits">14</td><td class="source">            doneCount = doneCount+1;</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source">            // done</td></tr><tr class="hit"><td class="line">359</td><td class="hits">14</td><td class="source">            if (doneCount &gt;= todoCount)</td></tr><tr class="hit"><td class="line">360</td><td class="hits">14</td><td class="source">              cb(null, doneCount);</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">364</td><td class="hits">16</td><td class="source">      if (todoCount === 0)</td></tr><tr class="hit"><td class="line">365</td><td class="hits">2</td><td class="source">        cb(null, doneCount);</td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">367</td><td class="hits">16</td><td class="source">    return null;</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">370</td><td class="hits">10</td><td class="source">  Node.prototype.index_schema = function(namespace, fields, cb) {</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source">    // POST http://localhost:7474/db/data/schema/index/person</td></tr><tr class="miss"><td class="line">372</td><td class="hits">0</td><td class="source">    var self = this;</td></tr><tr class="miss"><td class="line">373</td><td class="hits">0</td><td class="source">    if (_.isString(namespace) &amp;&amp; _.isArray(fields)) {</td></tr><tr class="miss"><td class="line">374</td><td class="hits">0</td><td class="source">      self.neo4jrestful.post('/db/data/schema/index/'+namespace, { data: fields }, cb);</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">376</td><td class="hits">0</td><td class="source">    return null;</td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">379</td><td class="hits">10</td><td class="source">  Node.prototype.save = function(cb) {</td></tr><tr class="hit"><td class="line">380</td><td class="hits">39</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">381</td><td class="hits">39</td><td class="source">    self.onBeforeSave(self, function(err) {</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">      // don't execute if an error is passed through</td></tr><tr class="hit"><td class="line">383</td><td class="hits">39</td><td class="source">      if ((typeof err !== 'undefined')&amp;&amp;(err !== null))</td></tr><tr class="miss"><td class="line">384</td><td class="hits">0</td><td class="source">        cb(err, null);</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source">      else</td></tr><tr class="hit"><td class="line">386</td><td class="hits">39</td><td class="source">        self.onSave(function(err, node, debug) {</td></tr><tr class="hit"><td class="line">387</td><td class="hits">39</td><td class="source">          self.onAfterSave(self, cb, debug);</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">392</td><td class="hits">48</td><td class="source">  Node.prototype.onBeforeSave = function(node, next) { next(null, null); }</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">394</td><td class="hits">10</td><td class="source">  Node.prototype.onSave = function(cb) {</td></tr><tr class="hit"><td class="line">395</td><td class="hits">39</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">396</td><td class="hits">39</td><td class="source">    if (this.is_singleton)</td></tr><tr class="miss"><td class="line">397</td><td class="hits">0</td><td class="source">      return cb(Error('Singleton instances can not be persisted'), null);</td></tr><tr class="hit"><td class="line">398</td><td class="hits">39</td><td class="source">    if (!this.hasValidData())</td></tr><tr class="miss"><td class="line">399</td><td class="hits">0</td><td class="source">      return cb(Error('Node does not contain valid data. `node.data` must be an object.'));</td></tr><tr class="hit"><td class="line">400</td><td class="hits">39</td><td class="source">    this._modified_query = false;</td></tr><tr class="hit"><td class="line">401</td><td class="hits">39</td><td class="source">    this.applyDefaultValues();</td></tr><tr class="hit"><td class="line">402</td><td class="hits">39</td><td class="source">    var method = null;</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">404</td><td class="hits">39</td><td class="source">    function _prepareData(err, data, debug) {</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source">      // copy persisted data on initially instanced node</td></tr><tr class="hit"><td class="line">406</td><td class="hits">37</td><td class="source">      data.copyTo(self);</td></tr><tr class="hit"><td class="line">407</td><td class="hits">37</td><td class="source">      data = self;</td></tr><tr class="hit"><td class="line">408</td><td class="hits">37</td><td class="source">      self.is_singleton = false;</td></tr><tr class="hit"><td class="line">409</td><td class="hits">37</td><td class="source">      self.is_instanced = true;</td></tr><tr class="hit"><td class="line">410</td><td class="hits">37</td><td class="source">      self.is_persisted = true;</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source">      // if we have defined fields to index</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source">      // we need to call the cb after indexing</td></tr><tr class="hit"><td class="line">413</td><td class="hits">37</td><td class="source">      if (self.hasFieldsToIndex()) {</td></tr><tr class="hit"><td class="line">414</td><td class="hits">16</td><td class="source">        return self.indexFields(function(){</td></tr><tr class="hit"><td class="line">415</td><td class="hits">16</td><td class="source">          if (debug)</td></tr><tr class="hit"><td class="line">416</td><td class="hits">9</td><td class="source">            debug.indexedFields = true;</td></tr><tr class="hit"><td class="line">417</td><td class="hits">16</td><td class="source">          cb(null, data, debug);</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source">      else</td></tr><tr class="hit"><td class="line">421</td><td class="hits">21</td><td class="source">        return cb(null, data, debug);</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">424</td><td class="hits">39</td><td class="source">    this.id = this._id_;</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">426</td><td class="hits">39</td><td class="source">    if (this.id &gt; 0) {</td></tr><tr class="hit"><td class="line">427</td><td class="hits">2</td><td class="source">      method = 'update';</td></tr><tr class="hit"><td class="line">428</td><td class="hits">2</td><td class="source">      this.neo4jrestful.put('/db/data/node/'+this._id_+'/properties', { data: this.flattenData() }, function(err, node, debug) {</td></tr><tr class="hit"><td class="line">429</td><td class="hits">2</td><td class="source">        self.populateWithDataFromResponse(node._response);</td></tr><tr class="hit"><td class="line">430</td><td class="hits">2</td><td class="source">        cb(err, node, debug);</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">433</td><td class="hits">37</td><td class="source">      method = 'create';   </td></tr><tr class="hit"><td class="line">434</td><td class="hits">37</td><td class="source">      this.neo4jrestful.post('/db/data/node', { data: this.flattenData() }, function(err, node, debug) {</td></tr><tr class="hit"><td class="line">435</td><td class="hits">37</td><td class="source">        if (node)</td></tr><tr class="hit"><td class="line">436</td><td class="hits">37</td><td class="source">          node.copyTo(self);</td></tr><tr class="hit"><td class="line">437</td><td class="hits">37</td><td class="source">        _prepareData(err, node, debug);</td></tr><tr><td class="line">438</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">442</td><td class="hits">10</td><td class="source">  Node.prototype.onAfterSave = function(node, next, debug) {</td></tr><tr class="hit"><td class="line">443</td><td class="hits">39</td><td class="source">    var labels = node.labelsAsArray();</td></tr><tr class="hit"><td class="line">444</td><td class="hits">39</td><td class="source">    if ((typeof err !== 'undefined')&amp;&amp;(err !== null)) {</td></tr><tr class="miss"><td class="line">445</td><td class="hits">0</td><td class="source">      return next(err, node, debug);</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">447</td><td class="hits">39</td><td class="source">      if (labels.length &gt; 0) {</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">        // we need to post the label in an extra reqiuest</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source">        // cypher inappropriate since it can't handle { attributes.with.dots: 'value' } …</td></tr><tr class="hit"><td class="line">450</td><td class="hits">12</td><td class="source">        node.createLabels(labels, function(labelError, notUseableData, debugLabel) {</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source">          // add label err if we have one</td></tr><tr class="hit"><td class="line">452</td><td class="hits">12</td><td class="source">          if (labelError)</td></tr><tr class="miss"><td class="line">453</td><td class="hits">0</td><td class="source">            err = (err) ? [ err, labelError ] : labelError;</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source">          // add debug label if we have one</td></tr><tr class="hit"><td class="line">455</td><td class="hits">12</td><td class="source">          if (debug)</td></tr><tr class="miss"><td class="line">456</td><td class="hits">0</td><td class="source">            debug = (debugLabel) ? [ debug, debugLabel ] : debug;</td></tr><tr class="hit"><td class="line">457</td><td class="hits">12</td><td class="source">          return next(labelError, node, debug);</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">460</td><td class="hits">27</td><td class="source">        return next(null, node, debug);</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">465</td><td class="hits">10</td><td class="source">  Node.prototype.update = function(data, cb) {</td></tr><tr class="hit"><td class="line">466</td><td class="hits">2</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">467</td><td class="hits">2</td><td class="source">    if (this._id_ &gt; 0) {</td></tr><tr class="hit"><td class="line">468</td><td class="hits">2</td><td class="source">      if (helpers.isValidData(data)) {</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source">        // we apply the data upon the current data</td></tr><tr class="hit"><td class="line">470</td><td class="hits">1</td><td class="source">        this.data = _.extend(this.data, data);</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">472</td><td class="hits">1</td><td class="source">        cb = data;</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">474</td><td class="hits">2</td><td class="source">      this.save(cb);</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">476</td><td class="hits">0</td><td class="source">      return cb(Error('You have to save() the node one time before you can perform an update'), null);</td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">480</td><td class="hits">10</td><td class="source">  Node.prototype.load = function(cb) {</td></tr><tr class="hit"><td class="line">481</td><td class="hits">32</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">482</td><td class="hits">32</td><td class="source">    this.onBeforeLoad(self, function(err, node){</td></tr><tr class="hit"><td class="line">483</td><td class="hits">32</td><td class="source">      if (err)</td></tr><tr class="miss"><td class="line">484</td><td class="hits">0</td><td class="source">        cb(err, node);</td></tr><tr><td class="line">485</td><td class="hits"></td><td class="source">      else</td></tr><tr class="hit"><td class="line">486</td><td class="hits">32</td><td class="source">        self.onAfterLoad(node, cb);</td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source">    })</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">490</td><td class="hits">10</td><td class="source">  Node.prototype.onBeforeLoad = function(node, next) {</td></tr><tr class="hit"><td class="line">491</td><td class="hits">32</td><td class="source">    if (node.hasId()) {</td></tr><tr class="hit"><td class="line">492</td><td class="hits">32</td><td class="source">      node.allLabels(function(err, labels, debug) {</td></tr><tr class="hit"><td class="line">493</td><td class="hits">32</td><td class="source">        if (err)</td></tr><tr class="miss"><td class="line">494</td><td class="hits">0</td><td class="source">          return next(err, labels);</td></tr><tr class="hit"><td class="line">495</td><td class="hits">32</td><td class="source">        node.labels = _.clone(labels);</td></tr><tr class="hit"><td class="line">496</td><td class="hits">32</td><td class="source">        if (labels.length === 1)</td></tr><tr class="hit"><td class="line">497</td><td class="hits">9</td><td class="source">          node.label = labels[0]</td></tr><tr class="hit"><td class="line">498</td><td class="hits">32</td><td class="source">        next(null, node);</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">501</td><td class="hits">0</td><td class="source">      next(null, node);</td></tr><tr><td class="line">502</td><td class="hits"></td><td class="source">    } </td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">505</td><td class="hits">10</td><td class="source">  Node.prototype.onAfterLoad = function(node, next) {</td></tr><tr class="hit"><td class="line">506</td><td class="hits">32</td><td class="source">    next(null, node);</td></tr><tr><td class="line">507</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">508</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">509</td><td class="hits">10</td><td class="source">  Node.prototype.populateWithDataFromResponse = function(data) {</td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source">    // if we are working on the prototype object</td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source">    // we won't mutate it and create a new node instance insetad</td></tr><tr class="hit"><td class="line">512</td><td class="hits">87</td><td class="source">    var node;</td></tr><tr class="hit"><td class="line">513</td><td class="hits">87</td><td class="source">    if (!this.is_instanced)</td></tr><tr class="miss"><td class="line">514</td><td class="hits">0</td><td class="source">      node = new Node();</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">516</td><td class="hits">87</td><td class="source">      node = this;</td></tr><tr class="hit"><td class="line">517</td><td class="hits">87</td><td class="source">    node._modified_query = false;</td></tr><tr class="hit"><td class="line">518</td><td class="hits">87</td><td class="source">    if (data) {</td></tr><tr class="hit"><td class="line">519</td><td class="hits">85</td><td class="source">      if (_.isObject(data) &amp;&amp; (!_.isArray(data)))</td></tr><tr class="hit"><td class="line">520</td><td class="hits">85</td><td class="source">        node._response = data;</td></tr><tr><td class="line">521</td><td class="hits"></td><td class="source">      else</td></tr><tr class="miss"><td class="line">522</td><td class="hits">0</td><td class="source">        node._response = data[0];</td></tr><tr class="hit"><td class="line">523</td><td class="hits">85</td><td class="source">      node.data = node._response.data;</td></tr><tr class="hit"><td class="line">524</td><td class="hits">85</td><td class="source">      node.data = node.unflattenData();</td></tr><tr class="hit"><td class="line">525</td><td class="hits">85</td><td class="source">      node.uri  = node._response.self;</td></tr><tr><td class="line">526</td><td class="hits"></td><td class="source">      //'http://localhost:7474/db/data/node/3648'</td></tr><tr class="hit"><td class="line">527</td><td class="hits">85</td><td class="source">      if ((node._response.self) &amp;&amp; (node._response.self.match(/[0-9]+$/))) {</td></tr><tr class="hit"><td class="line">528</td><td class="hits">85</td><td class="source">        node.id = node._id_ = Number(node._response.self.match(/[0-9]+$/)[0]);</td></tr><tr><td class="line">529</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">530</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">531</td><td class="hits">87</td><td class="source">    node.is_persisted = true;</td></tr><tr class="hit"><td class="line">532</td><td class="hits">87</td><td class="source">    return node;</td></tr><tr><td class="line">533</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">534</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">535</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">536</td><td class="hits"></td><td class="source">   * Query Methods (via chaining)</td></tr><tr><td class="line">537</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">538</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">539</td><td class="hits">10</td><td class="source">  Node.prototype.withLabel = function(label, cb) {</td></tr><tr class="hit"><td class="line">540</td><td class="hits">12</td><td class="source">    var self = this;</td></tr><tr><td class="line">541</td><td class="hits"></td><td class="source">    // return here if we have an instances node</td></tr><tr class="hit"><td class="line">542</td><td class="hits">12</td><td class="source">    if ( (self.hasId()) || (typeof label !== 'string') )</td></tr><tr class="miss"><td class="line">543</td><td class="hits">0</td><td class="source">      return self; // return self for chaining</td></tr><tr class="hit"><td class="line">544</td><td class="hits">12</td><td class="source">    self._modified_query = true;</td></tr><tr class="hit"><td class="line">545</td><td class="hits">12</td><td class="source">    self.cypher.label = label;</td></tr><tr class="hit"><td class="line">546</td><td class="hits">12</td><td class="source">    self.exec(cb);</td></tr><tr class="hit"><td class="line">547</td><td class="hits">12</td><td class="source">    return self; // return self for chaining</td></tr><tr><td class="line">548</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">549</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">550</td><td class="hits">10</td><td class="source">  Node.prototype.shortestPathTo = function(end, type, cb) {</td></tr><tr class="hit"><td class="line">551</td><td class="hits">1</td><td class="source">    if (typeof type === 'function') {</td></tr><tr class="miss"><td class="line">552</td><td class="hits">0</td><td class="source">      cb = type;</td></tr><tr class="miss"><td class="line">553</td><td class="hits">0</td><td class="source">      type = '';</td></tr><tr><td class="line">554</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">555</td><td class="hits">1</td><td class="source">    return this.pathBetween(this, end, { 'type': type, 'algorithm' : 'shortestPath' }, function(err, result, debug){</td></tr><tr class="hit"><td class="line">556</td><td class="hits">1</td><td class="source">      if ((!err)&amp;&amp;(result))</td></tr><tr><td class="line">557</td><td class="hits"></td><td class="source">        // shortestPath result has always only one result</td></tr><tr class="hit"><td class="line">558</td><td class="hits">1</td><td class="source">        return cb(err, result[0], debug);</td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source">      else</td></tr><tr class="miss"><td class="line">560</td><td class="hits">0</td><td class="source">        return cb(err, result, debug);</td></tr><tr><td class="line">561</td><td class="hits"></td><td class="source">    });</td></tr><tr class="miss"><td class="line">562</td><td class="hits">0</td><td class="source">    return null;</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">564</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">565</td><td class="hits">10</td><td class="source">  Node.prototype.pathBetween = function(start, end, options, cb) {</td></tr><tr class="hit"><td class="line">566</td><td class="hits">1</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">567</td><td class="hits">1</td><td class="source">    var defaultOptions = {</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source">      'max_depth': 0,</td></tr><tr><td class="line">569</td><td class="hits"></td><td class="source">      'relationships': {</td></tr><tr><td class="line">570</td><td class="hits"></td><td class="source">        'type': '',</td></tr><tr><td class="line">571</td><td class="hits"></td><td class="source">        'direction': 'out'  // not in use, yet</td></tr><tr><td class="line">572</td><td class="hits"></td><td class="source">      },</td></tr><tr><td class="line">573</td><td class="hits"></td><td class="source">      'algorithm' : 'shortestPath'</td></tr><tr><td class="line">574</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">575</td><td class="hits">1</td><td class="source">    if (typeof options === 'object') {</td></tr><tr class="hit"><td class="line">576</td><td class="hits">1</td><td class="source">      options = _.extend(defaultOptions, options);</td></tr><tr><td class="line">577</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">578</td><td class="hits">0</td><td class="source">      cb = options;</td></tr><tr class="miss"><td class="line">579</td><td class="hits">0</td><td class="source">      options = _.extend(defaultOptions);</td></tr><tr><td class="line">580</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source">    // allow shorthands for easier usage</td></tr><tr class="hit"><td class="line">582</td><td class="hits">1</td><td class="source">    if (options.max)</td></tr><tr class="miss"><td class="line">583</td><td class="hits">0</td><td class="source">      options.max_depth = options.max;</td></tr><tr class="hit"><td class="line">584</td><td class="hits">1</td><td class="source">    if (options.type)</td></tr><tr class="hit"><td class="line">585</td><td class="hits">1</td><td class="source">      options.relationships.type = options.type;</td></tr><tr class="hit"><td class="line">586</td><td class="hits">1</td><td class="source">    if (options.direction)</td></tr><tr class="miss"><td class="line">587</td><td class="hits">0</td><td class="source">      options.relationships.direction = options.direction;</td></tr><tr class="hit"><td class="line">588</td><td class="hits">1</td><td class="source">    start = helpers.getIdFromObject(start);</td></tr><tr class="hit"><td class="line">589</td><td class="hits">1</td><td class="source">    end = helpers.getIdFromObject(end);</td></tr><tr class="hit"><td class="line">590</td><td class="hits">1</td><td class="source">    if ((start)&amp;&amp;(end)) {</td></tr><tr><td class="line">591</td><td class="hits"></td><td class="source">      // START martin=node(3), michael=node(7)</td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source">      // MATCH p = allShortestPaths(martin-[*]-michael)</td></tr><tr><td class="line">593</td><td class="hits"></td><td class="source">      // RETURN p</td></tr><tr class="hit"><td class="line">594</td><td class="hits">1</td><td class="source">      var type = (options.relationships.type) ? ':'+options.relationships.type : options.relationships.type;</td></tr><tr class="hit"><td class="line">595</td><td class="hits">1</td><td class="source">      this.cypher.start = 'a = node('+start+'), b = node('+end+')';</td></tr><tr><td class="line">596</td><td class="hits"></td><td class="source">      </td></tr><tr class="hit"><td class="line">597</td><td class="hits">1</td><td class="source">      var matchString = 'p = '+options.algorithm+'(a-['+type+( (options.max_depth&gt;0) ? '..'+options.max_depth : '*' )+']-b)';</td></tr><tr><td class="line">598</td><td class="hits"></td><td class="source">      </td></tr><tr class="hit"><td class="line">599</td><td class="hits">1</td><td class="source">      this.cypher.match.push(matchString.replace(/\[\:\*+/, '[*'));</td></tr><tr class="hit"><td class="line">600</td><td class="hits">1</td><td class="source">      this.cypher.return_properties = ['p'];</td></tr><tr><td class="line">601</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">602</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">603</td><td class="hits">1</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">604</td><td class="hits">1</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">605</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">606</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">607</td><td class="hits">10</td><td class="source">  Node.prototype.count = function(identifier, cb) {</td></tr><tr class="hit"><td class="line">608</td><td class="hits">7</td><td class="source">    this._modified_query = true;</td></tr><tr class="hit"><td class="line">609</td><td class="hits">7</td><td class="source">    this.cypher._count = true;</td></tr><tr class="hit"><td class="line">610</td><td class="hits">7</td><td class="source">    if (typeof identifier === 'function') {</td></tr><tr class="hit"><td class="line">611</td><td class="hits">6</td><td class="source">      cb = identifier;</td></tr><tr class="hit"><td class="line">612</td><td class="hits">6</td><td class="source">      identifier = '*';</td></tr><tr><td class="line">613</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">614</td><td class="hits">1</td><td class="source">    else if (typeof identifier !== 'string')</td></tr><tr class="hit"><td class="line">615</td><td class="hits">1</td><td class="source">      identifier = '*';</td></tr><tr><td class="line">616</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">617</td><td class="hits">7</td><td class="source">    if (!this.cypher.start) {</td></tr><tr class="hit"><td class="line">618</td><td class="hits">4</td><td class="source">      this.cypher.start = this.__type_identifier__+' = '+this.__type__+'(*)'; // all nodes by default</td></tr><tr><td class="line">619</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">620</td><td class="hits">7</td><td class="source">    this.cypher.return_properties = 'COUNT('+((this.cypher._distinct) ? 'DISTINCT ' : '')+identifier+')';</td></tr><tr class="hit"><td class="line">621</td><td class="hits">7</td><td class="source">    if (this.cypher._distinct)</td></tr><tr class="hit"><td class="line">622</td><td class="hits">1</td><td class="source">      this.cypher._distinct = false;</td></tr><tr><td class="line">623</td><td class="hits"></td><td class="source">    // we only need the count column to return in this case</td></tr><tr class="hit"><td class="line">624</td><td class="hits">7</td><td class="source">    if (typeof cb === 'function')</td></tr><tr class="hit"><td class="line">625</td><td class="hits">6</td><td class="source">      this.exec(function(err, result, debug){</td></tr><tr class="hit"><td class="line">626</td><td class="hits">6</td><td class="source">        if ((result)&amp;&amp;(result.data)) {</td></tr><tr class="miss"><td class="line">627</td><td class="hits">0</td><td class="source">          if (result.data.length === 1)</td></tr><tr class="miss"><td class="line">628</td><td class="hits">0</td><td class="source">            result = result.data[0][0];</td></tr><tr><td class="line">629</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">630</td><td class="hits">6</td><td class="source">        cb(err, result, debug);</td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source">      });</td></tr><tr class="hit"><td class="line">632</td><td class="hits">7</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">633</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">634</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">635</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">636</td><td class="hits"></td><td class="source">   * Query-Building methods</td></tr><tr><td class="line">637</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">638</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">639</td><td class="hits">10</td><td class="source">  Node.prototype._prepareQuery = function() {</td></tr><tr class="hit"><td class="line">640</td><td class="hits">77</td><td class="source">    var query = _.extend(this.cypher);</td></tr><tr class="hit"><td class="line">641</td><td class="hits">77</td><td class="source">    var label = (query.label) ? ':'+query.label : '';</td></tr><tr><td class="line">642</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">643</td><td class="hits">77</td><td class="source">    if (!query.start) {</td></tr><tr class="hit"><td class="line">644</td><td class="hits">54</td><td class="source">      if (query.from &gt; 0) {</td></tr><tr class="miss"><td class="line">645</td><td class="hits">0</td><td class="source">        query.start = 'n = node('+query.from+')';</td></tr><tr class="miss"><td class="line">646</td><td class="hits">0</td><td class="source">        query.return_properties.push('n');</td></tr><tr><td class="line">647</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">648</td><td class="hits">54</td><td class="source">      if (query.to &gt; 0) {</td></tr><tr class="miss"><td class="line">649</td><td class="hits">0</td><td class="source">        query.start += ', m = node('+query.to+')';</td></tr><tr class="miss"><td class="line">650</td><td class="hits">0</td><td class="source">        query.return_properties.push('m');</td></tr><tr><td class="line">651</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">652</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">653</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">654</td><td class="hits">77</td><td class="source">    var relationships = '';</td></tr><tr><td class="line">655</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">656</td><td class="hits">77</td><td class="source">    if ((query.return_properties)&amp;&amp;(query.return_properties.constructor === Array))</td></tr><tr class="hit"><td class="line">657</td><td class="hits">70</td><td class="source">      query.return_properties = _.uniq(query.return_properties).join(', ')</td></tr><tr><td class="line">658</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">659</td><td class="hits">77</td><td class="source">    if (query.relationship) {</td></tr><tr class="hit"><td class="line">660</td><td class="hits">6</td><td class="source">      if (query.relationship.constructor === Array) {</td></tr><tr class="hit"><td class="line">661</td><td class="hits">2</td><td class="source">        relationships = ':'+helpers.escapeString(query.relationship.join('|'));</td></tr><tr><td class="line">662</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">663</td><td class="hits">4</td><td class="source">        relationships = ':'+helpers.escapeString(query.relationship);</td></tr><tr><td class="line">664</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">665</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">666</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">667</td><td class="hits"></td><td class="source">    // build in/outgoing directions</td></tr><tr class="hit"><td class="line">668</td><td class="hits">77</td><td class="source">    if ((query.incoming)||(query.outgoing)) {</td></tr><tr><td class="line">669</td><td class="hits"></td><td class="source">      // query.outgoing = (query.outgoing) ? query.outgoing : '-';</td></tr><tr><td class="line">670</td><td class="hits"></td><td class="source">      // query.incoming = (query.incoming) ? query.incoming : '-';</td></tr><tr class="hit"><td class="line">671</td><td class="hits">14</td><td class="source">      var x = '';</td></tr><tr class="hit"><td class="line">672</td><td class="hits">14</td><td class="source">      var y = '';</td></tr><tr class="hit"><td class="line">673</td><td class="hits">14</td><td class="source">      if ((query.incoming)&amp;&amp;(query.outgoing))</td></tr><tr class="miss"><td class="line">674</td><td class="hits">0</td><td class="source">        x = y = '-';</td></tr><tr><td class="line">675</td><td class="hits"></td><td class="source">      else {</td></tr><tr class="hit"><td class="line">676</td><td class="hits">14</td><td class="source">        if (query.incoming) {</td></tr><tr class="hit"><td class="line">677</td><td class="hits">6</td><td class="source">          x = '&lt;-';</td></tr><tr class="hit"><td class="line">678</td><td class="hits">6</td><td class="source">          y = '-';</td></tr><tr><td class="line">679</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">680</td><td class="hits">14</td><td class="source">        if (query.outgoing) {</td></tr><tr class="hit"><td class="line">681</td><td class="hits">8</td><td class="source">          x = '-';</td></tr><tr class="hit"><td class="line">682</td><td class="hits">8</td><td class="source">          y = '-&gt;';</td></tr><tr><td class="line">683</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">684</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">685</td><td class="hits">14</td><td class="source">      query.match.push('(n'+label+')'+x+'[r'+relationships+']'+y+'('+( (this.cypher.to &gt; 0) ? 'm' : '' )+')');</td></tr><tr><td class="line">686</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">687</td><td class="hits"></td><td class="source">    // guess return objects from start string if it's not set</td></tr><tr><td class="line">688</td><td class="hits"></td><td class="source">    // e.g. START n = node(*), a = node(2) WHERE … RETURN (~&gt;) n, a;</td></tr><tr class="hit"><td class="line">689</td><td class="hits">77</td><td class="source">    if ((!query.return_properties)||((query.return_properties)&amp;&amp;(query.return_properties.length == 0)&amp;&amp;(query.start))) {</td></tr><tr class="miss"><td class="line">690</td><td class="hits">0</td><td class="source">      var _start = ' '+query.start</td></tr><tr class="miss"><td class="line">691</td><td class="hits">0</td><td class="source">      if (/ [a-zA-Z]+ \= /.test(_start)) {</td></tr><tr class="miss"><td class="line">692</td><td class="hits">0</td><td class="source">        var matches = _start;</td></tr><tr class="miss"><td class="line">693</td><td class="hits">0</td><td class="source">        query.return_properties = [];</td></tr><tr class="miss"><td class="line">694</td><td class="hits">0</td><td class="source">        matches = matches.match(/[\s\,]([a-z]+) \= /g);</td></tr><tr class="miss"><td class="line">695</td><td class="hits">0</td><td class="source">        for (var i = 0; i &lt; matches.length; i++) {</td></tr><tr class="miss"><td class="line">696</td><td class="hits">0</td><td class="source">          query.return_properties.push(matches[i].replace(/^[\s\,]*([a-z]+).*$/i,'$1'));</td></tr><tr><td class="line">697</td><td class="hits"></td><td class="source">        }</td></tr><tr class="miss"><td class="line">698</td><td class="hits">0</td><td class="source">        if ((this.neo4jrestful.version &gt;= 2)&amp;&amp;(query.return_properties.length === 1)&amp;&amp;(query.return_properties[0] === 'n')) {</td></tr><tr><td class="line">699</td><td class="hits"></td><td class="source">          // try adding labels if we have only n[node] as return propert</td></tr><tr class="miss"><td class="line">700</td><td class="hits">0</td><td class="source">          query.return_properties.push('labels(n)');</td></tr><tr><td class="line">701</td><td class="hits"></td><td class="source">        }</td></tr><tr class="miss"><td class="line">702</td><td class="hits">0</td><td class="source">        query.return_properties = query.return_properties.join(', ');</td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">704</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">705</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">706</td><td class="hits"></td><td class="source">    // Set a fallback to START n = node(*) </td></tr><tr class="hit"><td class="line">707</td><td class="hits">77</td><td class="source">    if ((!query.start)&amp;&amp;(!(query.match.length &gt; 0))) {</td></tr><tr><td class="line">708</td><td class="hits"></td><td class="source">      // query.start = 'n = node(*)';</td></tr><tr class="hit"><td class="line">709</td><td class="hits">46</td><td class="source">      query.start = this.__type_identifier__+' = '+this.__type__+'(*)';</td></tr><tr><td class="line">710</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">711</td><td class="hits">77</td><td class="source">    if ((!(query.match.length&gt;0))&amp;&amp;(this.label)) {</td></tr><tr><td class="line">712</td><td class="hits"></td><td class="source">      // e.g. ~&gt; MATCH n:Person</td></tr><tr class="hit"><td class="line">713</td><td class="hits">9</td><td class="source">      query.match.push(this.__type_identifier__+':'+this.label);</td></tr><tr><td class="line">714</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">715</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">716</td><td class="hits"></td><td class="source">    // rule(s) for findById</td></tr><tr class="hit"><td class="line">717</td><td class="hits">77</td><td class="source">    if (query.by_id &gt; 0) {</td></tr><tr class="hit"><td class="line">718</td><td class="hits">40</td><td class="source">      var identifier = query.node_identifier || this.__type_identifier__;</td></tr><tr><td class="line">719</td><td class="hits"></td><td class="source">      // put in where clause if `START n = node(*)` or no START statement exists</td></tr><tr class="hit"><td class="line">720</td><td class="hits">40</td><td class="source">      if ( (!query.start) || (/^\s*n\s*\=\s*node\(\*\)\s*$/.test(query.start)) ) {</td></tr><tr><td class="line">721</td><td class="hits"></td><td class="source">        // we have to use the id method for the special key `id`</td></tr><tr class="hit"><td class="line">722</td><td class="hits">33</td><td class="source">        query.where.push(&quot;id(&quot;+identifier+&quot;) = &quot;+query.by_id);</td></tr><tr><td class="line">723</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">724</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">725</td><td class="hits">77</td><td class="source">    return query;</td></tr><tr><td class="line">726</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">727</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">728</td><td class="hits">10</td><td class="source">  Node.prototype.toCypherQuery = function() {</td></tr><tr class="hit"><td class="line">729</td><td class="hits">77</td><td class="source">    var query = this._prepareQuery();</td></tr><tr class="hit"><td class="line">730</td><td class="hits">77</td><td class="source">    var template = &quot;&quot;;</td></tr><tr class="hit"><td class="line">731</td><td class="hits">77</td><td class="source">    if (query.start)</td></tr><tr class="hit"><td class="line">732</td><td class="hits">69</td><td class="source">      template += &quot;START %(start)s &quot;;</td></tr><tr class="hit"><td class="line">733</td><td class="hits">77</td><td class="source">    if (query.match.length &gt; 0)</td></tr><tr class="hit"><td class="line">734</td><td class="hits">34</td><td class="source">      template += &quot;MATCH %(match)s &quot;;</td></tr><tr class="hit"><td class="line">735</td><td class="hits">77</td><td class="source">      template += &quot;%(With)s &quot;;</td></tr><tr class="hit"><td class="line">736</td><td class="hits">77</td><td class="source">      template += &quot;%(where)s &quot;;</td></tr><tr class="hit"><td class="line">737</td><td class="hits">77</td><td class="source">      template += &quot;%(action)s %(return_properties)s &quot;;</td></tr><tr class="hit"><td class="line">738</td><td class="hits">77</td><td class="source">    if (query.order_by)</td></tr><tr class="hit"><td class="line">739</td><td class="hits">3</td><td class="source">      template += &quot;ORDER BY %(order_by)s &quot;;</td></tr><tr class="hit"><td class="line">740</td><td class="hits">77</td><td class="source">    if (query.skip)</td></tr><tr class="hit"><td class="line">741</td><td class="hits">3</td><td class="source">      template += &quot;SKIP %(skip)s &quot;;</td></tr><tr class="hit"><td class="line">742</td><td class="hits">77</td><td class="source">    if (query.limit)</td></tr><tr class="hit"><td class="line">743</td><td class="hits">16</td><td class="source">      template += &quot;LIMIT %(limit)s&quot;;</td></tr><tr class="hit"><td class="line">744</td><td class="hits">77</td><td class="source">      template += &quot;;&quot;;</td></tr><tr><td class="line">745</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">746</td><td class="hits">77</td><td class="source">    var cypher = helpers.sprintf(template, {</td></tr><tr><td class="line">747</td><td class="hits"></td><td class="source">      start:              query.start,</td></tr><tr><td class="line">748</td><td class="hits"></td><td class="source">      from:               '',</td></tr><tr><td class="line">749</td><td class="hits"></td><td class="source">      match:              (query.match.length &gt; 0) ? query.match.join(' AND ') : '',</td></tr><tr><td class="line">750</td><td class="hits"></td><td class="source">      With:               (query.With) ? query.With : '',</td></tr><tr><td class="line">751</td><td class="hits"></td><td class="source">      action:             (query.action) ? query.action : 'RETURN'+((query._distinct) ? ' DISTINCT ' : ''),</td></tr><tr><td class="line">752</td><td class="hits"></td><td class="source">      return_properties:  query.return_properties,</td></tr><tr><td class="line">753</td><td class="hits"></td><td class="source">      where:              ((query.where)&amp;&amp;(query.where.length &gt; 0)) ? 'WHERE '+query.where.join(' AND ') : '',</td></tr><tr><td class="line">754</td><td class="hits"></td><td class="source">      to:                 '',</td></tr><tr><td class="line">755</td><td class="hits"></td><td class="source">      order_by:           (query.order_by) ? query.order_by+' '+query.order_direction : '',</td></tr><tr><td class="line">756</td><td class="hits"></td><td class="source">      limit:              query.limit,</td></tr><tr><td class="line">757</td><td class="hits"></td><td class="source">      skip:               query.skip  </td></tr><tr><td class="line">758</td><td class="hits"></td><td class="source">    })</td></tr><tr class="hit"><td class="line">759</td><td class="hits">77</td><td class="source">    cypher = cypher.trim().replace(/\s+;$/,';');</td></tr><tr class="hit"><td class="line">760</td><td class="hits">77</td><td class="source">    return cypher;</td></tr><tr><td class="line">761</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">762</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">763</td><td class="hits">10</td><td class="source">  Node.prototype._start_node_id = function(fallback) {</td></tr><tr class="hit"><td class="line">764</td><td class="hits">18</td><td class="source">    if (typeof fallback === 'undefined')</td></tr><tr class="miss"><td class="line">765</td><td class="hits">0</td><td class="source">      fallback = '*'</td></tr><tr class="hit"><td class="line">766</td><td class="hits">18</td><td class="source">    if (this.cypher.from &gt; 0)</td></tr><tr class="miss"><td class="line">767</td><td class="hits">0</td><td class="source">      return this.cypher.from;</td></tr><tr class="hit"><td class="line">768</td><td class="hits">18</td><td class="source">    if (this.cypher.by_id)</td></tr><tr class="hit"><td class="line">769</td><td class="hits">7</td><td class="source">      return this.cypher.by_id;</td></tr><tr><td class="line">770</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">771</td><td class="hits">11</td><td class="source">      return (this.hasId()) ? this.id : fallback; </td></tr><tr><td class="line">772</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">773</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">774</td><td class="hits">10</td><td class="source">  Node.prototype._end_node_id = function(fallback) {</td></tr><tr class="hit"><td class="line">775</td><td class="hits">3</td><td class="source">    if (typeof fallback === 'undefined')</td></tr><tr class="miss"><td class="line">776</td><td class="hits">0</td><td class="source">      fallback = '*'</td></tr><tr class="hit"><td class="line">777</td><td class="hits">3</td><td class="source">    return (this.cypher.to &gt; 0) ? this.cypher.to : fallback; </td></tr><tr><td class="line">778</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">779</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">780</td><td class="hits">10</td><td class="source">  Node.prototype.singletonForQuery = function(cypher) {</td></tr><tr class="hit"><td class="line">781</td><td class="hits">25</td><td class="source">    var singleton = this.singleton()</td></tr><tr class="hit"><td class="line">782</td><td class="hits">25</td><td class="source">    singleton.cypher = _.extend(singleton.cypher, cypher);</td></tr><tr class="hit"><td class="line">783</td><td class="hits">25</td><td class="source">    return (this.hasId()) ? singleton.findById(this.id) : this;</td></tr><tr><td class="line">784</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">785</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">786</td><td class="hits">10</td><td class="source">  Node.prototype.exec = function(cb, cypher_or_request) {</td></tr><tr class="hit"><td class="line">787</td><td class="hits">222</td><td class="source">    var request = null;</td></tr><tr class="hit"><td class="line">788</td><td class="hits">222</td><td class="source">    var cypherQuery = null;</td></tr><tr><td class="line">789</td><td class="hits"></td><td class="source">    // you can alternatively use an url </td></tr><tr class="hit"><td class="line">790</td><td class="hits">222</td><td class="source">    if (typeof cypher_or_request === 'string')</td></tr><tr class="miss"><td class="line">791</td><td class="hits">0</td><td class="source">      cypherQuery = cypher_or_request;</td></tr><tr class="hit"><td class="line">792</td><td class="hits">222</td><td class="source">    else if (typeof cypher_or_request === 'object')</td></tr><tr class="miss"><td class="line">793</td><td class="hits">0</td><td class="source">      request = _.extend({ type: 'get', data: {}, url: null }, cypher_or_request);</td></tr><tr><td class="line">794</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">795</td><td class="hits">222</td><td class="source">    if (typeof cb === 'function') {</td></tr><tr class="hit"><td class="line">796</td><td class="hits">52</td><td class="source">      var cypher = this.toCypherQuery();</td></tr><tr><td class="line">797</td><td class="hits"></td><td class="source">      // reset node, because it might be called from prototype</td></tr><tr><td class="line">798</td><td class="hits"></td><td class="source">      // if we have only one return property, we resort this</td></tr><tr class="hit"><td class="line">799</td><td class="hits">52</td><td class="source">      if ( (this.cypher.return_properties)&amp;&amp;(this.cypher.return_properties.length === 1) ) {</td></tr><tr class="hit"><td class="line">800</td><td class="hits">46</td><td class="source">        if (cypherQuery)</td></tr><tr class="miss"><td class="line">801</td><td class="hits">0</td><td class="source">          return this.query(cypherQuery, cb);</td></tr><tr class="hit"><td class="line">802</td><td class="hits">46</td><td class="source">        else if (request)</td></tr><tr class="miss"><td class="line">803</td><td class="hits">0</td><td class="source">          return this.query(request, cb);</td></tr><tr><td class="line">804</td><td class="hits"></td><td class="source">        else</td></tr><tr><td class="line">805</td><td class="hits"></td><td class="source">          // default, use the build cypher query</td></tr><tr class="hit"><td class="line">806</td><td class="hits">46</td><td class="source">          return this.query(cypher, cb);</td></tr><tr><td class="line">807</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">808</td><td class="hits">6</td><td class="source">        return this.query(cypher, cb);</td></tr><tr><td class="line">809</td><td class="hits"></td><td class="source">      } </td></tr><tr><td class="line">810</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">811</td><td class="hits">170</td><td class="source">    return null;</td></tr><tr><td class="line">812</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">813</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">814</td><td class="hits">10</td><td class="source">  Node.prototype.query = function(cypherQuery, options, cb) {</td></tr><tr class="hit"><td class="line">815</td><td class="hits">52</td><td class="source">    var self = this;</td></tr><tr><td class="line">816</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">817</td><td class="hits">52</td><td class="source">    var DefaultConstructor = this.recommendConstructor();</td></tr><tr><td class="line">818</td><td class="hits"></td><td class="source">    // To check that it's invoked by Noder::find() or Person::find()</td></tr><tr class="hit"><td class="line">819</td><td class="hits">52</td><td class="source">    var constructorNameOfStaticMethod = helpers.constructorNameOfFunction(DefaultConstructor);</td></tr><tr><td class="line">820</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">821</td><td class="hits">52</td><td class="source">    var _deliverResultset = function(self, cb, err, sortedData, debug) {</td></tr><tr class="hit"><td class="line">822</td><td class="hits">51</td><td class="source">      if ( (self.cypher._find_by_id) &amp;&amp; (self.cypher.return_properties.length === 1) &amp;&amp; (self.cypher.return_properties[0] === 'n') &amp;&amp; (sortedData[0]) )</td></tr><tr class="miss"><td class="line">823</td><td class="hits">0</td><td class="source">        sortedData = sortedData[0];</td></tr><tr class="hit"><td class="line">824</td><td class="hits">51</td><td class="source">      else if ( (self.cypher.limit === 1) &amp;&amp; (sortedData.length === 1) )</td></tr><tr class="hit"><td class="line">825</td><td class="hits">1</td><td class="source">        sortedData = sortedData[0];</td></tr><tr class="hit"><td class="line">826</td><td class="hits">50</td><td class="source">      else if ( (self.cypher.limit === 1) &amp;&amp; (sortedData.length === 0) )</td></tr><tr class="hit"><td class="line">827</td><td class="hits">1</td><td class="source">        sortedData = null;</td></tr><tr class="hit"><td class="line">828</td><td class="hits">51</td><td class="source">      return cb(err, sortedData, debug);</td></tr><tr><td class="line">829</td><td class="hits"></td><td class="source">    } </td></tr><tr><td class="line">830</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">831</td><td class="hits">52</td><td class="source">    var _processData = function(err, data, debug, cb) {</td></tr><tr class="hit"><td class="line">832</td><td class="hits">52</td><td class="source">      if ((err)||(data === null))</td></tr><tr class="hit"><td class="line">833</td><td class="hits">1</td><td class="source">        return cb(err, data, debug);</td></tr><tr><td class="line">834</td><td class="hits"></td><td class="source">      else {</td></tr><tr class="hit"><td class="line">835</td><td class="hits">51</td><td class="source">        var sortedData = [];</td></tr><tr class="hit"><td class="line">836</td><td class="hits">51</td><td class="source">        var jobsToDo = data.data.length;</td></tr><tr class="hit"><td class="line">837</td><td class="hits">51</td><td class="source">        for (var x=0; x &lt; data.data.length; x++) {</td></tr><tr class="hit"><td class="line">838</td><td class="hits">43</td><td class="source">          if (typeof data.data[x][0] === 'undefined') {</td></tr><tr class="miss"><td class="line">839</td><td class="hits">0</td><td class="source">            jobsToDo--;</td></tr><tr class="miss"><td class="line">840</td><td class="hits">0</td><td class="source">            break;</td></tr><tr><td class="line">841</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">842</td><td class="hits">43</td><td class="source">          var basicNode = self.neo4jrestful.createObjectFromResponseData(data.data[x][0], DefaultConstructor);</td></tr><tr class="hit"><td class="line">843</td><td class="hits">43</td><td class="source">          (function(x){</td></tr><tr class="hit"><td class="line">844</td><td class="hits">43</td><td class="source">            if (typeof basicNode.load === 'function') {</td></tr><tr class="hit"><td class="line">845</td><td class="hits">36</td><td class="source">              basicNode.load(function(err, node) {</td></tr><tr><td class="line">846</td><td class="hits"></td><td class="source">                // convert node to it's model if it has a distinct label and differs from static method</td></tr><tr class="hit"><td class="line">847</td><td class="hits">36</td><td class="source">                if ( (node.label) &amp;&amp; (node.label !== constructorNameOfStaticMethod) )</td></tr><tr class="hit"><td class="line">848</td><td class="hits">3</td><td class="source">                  Node.prototype.convert_node_to_model(node, node.label, DefaultConstructor);</td></tr><tr class="hit"><td class="line">849</td><td class="hits">36</td><td class="source">                jobsToDo--;</td></tr><tr class="hit"><td class="line">850</td><td class="hits">36</td><td class="source">                sortedData[x] = node;</td></tr><tr class="hit"><td class="line">851</td><td class="hits">36</td><td class="source">                if (jobsToDo === 0)</td></tr><tr class="hit"><td class="line">852</td><td class="hits">33</td><td class="source">                  return _deliverResultset(self, cb, err, sortedData, debug);</td></tr><tr><td class="line">853</td><td class="hits"></td><td class="source">              });</td></tr><tr><td class="line">854</td><td class="hits"></td><td class="source">            } else {</td></tr><tr><td class="line">855</td><td class="hits"></td><td class="source">              // no load() function found</td></tr><tr class="hit"><td class="line">856</td><td class="hits">7</td><td class="source">              sortedData[x] = basicNode;</td></tr><tr class="hit"><td class="line">857</td><td class="hits">7</td><td class="source">              jobsToDo--;</td></tr><tr><td class="line">858</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">859</td><td class="hits"></td><td class="source">          })(x);</td></tr><tr><td class="line">860</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">861</td><td class="hits">51</td><td class="source">        if (jobsToDo === 0) {</td></tr><tr><td class="line">862</td><td class="hits"></td><td class="source">          // TODO: check why before refactoring it also worked without this condition</td></tr><tr class="hit"><td class="line">863</td><td class="hits">18</td><td class="source">          if ( (data.data[0]) &amp;&amp; (typeof data.data[0][0] !== 'object') )</td></tr><tr class="hit"><td class="line">864</td><td class="hits">6</td><td class="source">            sortedData = data.data[0][0];</td></tr><tr class="hit"><td class="line">865</td><td class="hits">18</td><td class="source">          return _deliverResultset(self, cb, err, sortedData, debug);</td></tr><tr><td class="line">866</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">867</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">868</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">869</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">870</td><td class="hits"></td><td class="source">    // sort arguments</td></tr><tr class="hit"><td class="line">871</td><td class="hits">52</td><td class="source">    if (typeof options !== 'object') {</td></tr><tr class="hit"><td class="line">872</td><td class="hits">52</td><td class="source">      cb = options;</td></tr><tr class="hit"><td class="line">873</td><td class="hits">52</td><td class="source">      options = {};</td></tr><tr><td class="line">874</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">875</td><td class="hits">52</td><td class="source">    if (this.label)</td></tr><tr class="hit"><td class="line">876</td><td class="hits">7</td><td class="source">      options.label = this.label;</td></tr><tr><td class="line">877</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">878</td><td class="hits">52</td><td class="source">    if (typeof cypherQuery === 'string') {</td></tr><tr class="hit"><td class="line">879</td><td class="hits">52</td><td class="source">      return this.neo4jrestful.query(cypherQuery, options, function(err, data, debug) {</td></tr><tr class="hit"><td class="line">880</td><td class="hits">52</td><td class="source">        _processData(err, data, debug, cb);</td></tr><tr><td class="line">881</td><td class="hits"></td><td class="source">      });</td></tr><tr class="miss"><td class="line">882</td><td class="hits">0</td><td class="source">    } else if (typeof cypherQuery === 'object') {</td></tr><tr><td class="line">883</td><td class="hits"></td><td class="source">      // we expect a raw request object here</td></tr><tr><td class="line">884</td><td class="hits"></td><td class="source">      // this is used to make get/post/put restful request</td></tr><tr><td class="line">885</td><td class="hits"></td><td class="source">      // with the faeture of process node data</td></tr><tr class="miss"><td class="line">886</td><td class="hits">0</td><td class="source">      var request = cypherQuery;</td></tr><tr class="miss"><td class="line">887</td><td class="hits">0</td><td class="source">      if ( (!request.type) || (!request.data) || (!request.url) ) {</td></tr><tr class="miss"><td class="line">888</td><td class="hits">0</td><td class="source">        return cb(Error(&quot;The 1st argument as request object must have the properties .url, .data and .type&quot;), null);</td></tr><tr><td class="line">889</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">890</td><td class="hits">0</td><td class="source">      return this.neo4jrestful[request.type](request.url, request.data, function(err, data, debug) {</td></tr><tr><td class="line">891</td><td class="hits"></td><td class="source">        // transform to resultset</td></tr><tr class="miss"><td class="line">892</td><td class="hits">0</td><td class="source">        data = {</td></tr><tr><td class="line">893</td><td class="hits"></td><td class="source">          data: [ [ data ] ]</td></tr><tr><td class="line">894</td><td class="hits"></td><td class="source">        };</td></tr><tr class="miss"><td class="line">895</td><td class="hits">0</td><td class="source">        _processData(err, data, debug, cb);</td></tr><tr><td class="line">896</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">897</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">898</td><td class="hits">0</td><td class="source">      return cb(Error(&quot;First argument must be a string with the cypher query&quot;), null);</td></tr><tr><td class="line">899</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">900</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">901</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">902</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">903</td><td class="hits"></td><td class="source">   * Relationship methods</td></tr><tr><td class="line">904</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">905</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">906</td><td class="hits">10</td><td class="source">  Node.prototype.incomingRelationships = function(relation, cb) {</td></tr><tr class="hit"><td class="line">907</td><td class="hits">7</td><td class="source">    var self = this.singletonForQuery();</td></tr><tr class="hit"><td class="line">908</td><td class="hits">7</td><td class="source">    self._modified_query = true;</td></tr><tr class="hit"><td class="line">909</td><td class="hits">7</td><td class="source">    if (typeof relation !== 'function') {</td></tr><tr class="hit"><td class="line">910</td><td class="hits">7</td><td class="source">      self.cypher.relationship = relation;</td></tr><tr><td class="line">911</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">912</td><td class="hits">0</td><td class="source">      cb = relation;</td></tr><tr><td class="line">913</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">914</td><td class="hits">7</td><td class="source">    self.cypher.node_identifier = 'n';</td></tr><tr class="hit"><td class="line">915</td><td class="hits">7</td><td class="source">    self.cypher.start = 'n = node('+self._start_node_id('*')+')';</td></tr><tr class="hit"><td class="line">916</td><td class="hits">7</td><td class="source">    self.cypher.start += (self.cypher.to &gt; 0) ? ', m = node('+self._end_node_id('*')+')' : ''</td></tr><tr class="hit"><td class="line">917</td><td class="hits">7</td><td class="source">    self.cypher.incoming = true;</td></tr><tr class="hit"><td class="line">918</td><td class="hits">7</td><td class="source">    self.cypher.outgoing = false;</td></tr><tr class="hit"><td class="line">919</td><td class="hits">7</td><td class="source">    self.cypher.return_properties = ['r'];</td></tr><tr class="hit"><td class="line">920</td><td class="hits">7</td><td class="source">    self.exec(cb);</td></tr><tr class="hit"><td class="line">921</td><td class="hits">7</td><td class="source">    return self; // return self for chaining</td></tr><tr><td class="line">922</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">923</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">924</td><td class="hits">10</td><td class="source">  Node.prototype.outgoingRelationships = function(relation, cb) {</td></tr><tr class="hit"><td class="line">925</td><td class="hits">8</td><td class="source">    var self = this.singletonForQuery();</td></tr><tr class="hit"><td class="line">926</td><td class="hits">8</td><td class="source">    self._modified_query = true;</td></tr><tr class="hit"><td class="line">927</td><td class="hits">8</td><td class="source">    if (typeof relation !== 'function') {</td></tr><tr class="hit"><td class="line">928</td><td class="hits">7</td><td class="source">      self.cypher.relationship = relation;</td></tr><tr class="hit"><td class="line">929</td><td class="hits">7</td><td class="source">      cb = relation;</td></tr><tr><td class="line">930</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">931</td><td class="hits">1</td><td class="source">      cb = relation;</td></tr><tr><td class="line">932</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">933</td><td class="hits">8</td><td class="source">    self.cypher.node_identifier = 'n';</td></tr><tr class="hit"><td class="line">934</td><td class="hits">8</td><td class="source">    self.cypher.start = 'n = node('+self._start_node_id('*')+')';</td></tr><tr class="hit"><td class="line">935</td><td class="hits">8</td><td class="source">    self.cypher.start += (self.cypher.to &gt; 0) ? ', m = node('+self._end_node_id('*')+')' : ''</td></tr><tr class="hit"><td class="line">936</td><td class="hits">8</td><td class="source">    self.cypher.incoming = false;</td></tr><tr class="hit"><td class="line">937</td><td class="hits">8</td><td class="source">    self.cypher.outgoing = true;</td></tr><tr class="hit"><td class="line">938</td><td class="hits">8</td><td class="source">    self.cypher.return_properties = ['r'];</td></tr><tr class="hit"><td class="line">939</td><td class="hits">8</td><td class="source">    self.exec(cb);</td></tr><tr class="hit"><td class="line">940</td><td class="hits">8</td><td class="source">    return self; // return self for chaining</td></tr><tr><td class="line">941</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">942</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">943</td><td class="hits">10</td><td class="source">  Node.prototype.incomingRelationshipsFrom = function(node, relation, cb) {</td></tr><tr class="hit"><td class="line">944</td><td class="hits">2</td><td class="source">    var self = this.singletonForQuery();</td></tr><tr class="hit"><td class="line">945</td><td class="hits">2</td><td class="source">    self._modified_query = true;</td></tr><tr class="hit"><td class="line">946</td><td class="hits">2</td><td class="source">    self.cypher.from = self.id || null;</td></tr><tr class="hit"><td class="line">947</td><td class="hits">2</td><td class="source">    self.cypher.to = helpers.getIdFromObject(node);</td></tr><tr class="hit"><td class="line">948</td><td class="hits">2</td><td class="source">    if (typeof relation !== 'function')</td></tr><tr class="hit"><td class="line">949</td><td class="hits">2</td><td class="source">      self.cypher.relationship = relation;</td></tr><tr class="hit"><td class="line">950</td><td class="hits">2</td><td class="source">    self.cypher.return_properties = ['r'];</td></tr><tr class="hit"><td class="line">951</td><td class="hits">2</td><td class="source">    return self.incomingRelationships(relation, cb);</td></tr><tr><td class="line">952</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">953</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">954</td><td class="hits">10</td><td class="source">  Node.prototype.outgoingRelationshipsTo = function(node, relation, cb) {</td></tr><tr class="hit"><td class="line">955</td><td class="hits">1</td><td class="source">    var self = this.singletonForQuery();</td></tr><tr class="hit"><td class="line">956</td><td class="hits">1</td><td class="source">    self._modified_query = true;</td></tr><tr class="hit"><td class="line">957</td><td class="hits">1</td><td class="source">    self.cypher.to = helpers.getIdFromObject(node);</td></tr><tr class="hit"><td class="line">958</td><td class="hits">1</td><td class="source">    if (typeof relation !== 'function')</td></tr><tr class="hit"><td class="line">959</td><td class="hits">1</td><td class="source">      self.cypher.relationship = relation;</td></tr><tr class="hit"><td class="line">960</td><td class="hits">1</td><td class="source">    self.cypher.return_properties = ['r'];</td></tr><tr class="hit"><td class="line">961</td><td class="hits">1</td><td class="source">    self.exec(cb);</td></tr><tr class="hit"><td class="line">962</td><td class="hits">1</td><td class="source">    return self.outgoingRelationships(relation, cb);</td></tr><tr><td class="line">963</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">964</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">965</td><td class="hits">10</td><td class="source">  Node.prototype.allDirections = function(relation, cb) {</td></tr><tr class="miss"><td class="line">966</td><td class="hits">0</td><td class="source">    var self = this.singletonForQuery();</td></tr><tr class="miss"><td class="line">967</td><td class="hits">0</td><td class="source">    self._modified_query = true;</td></tr><tr class="miss"><td class="line">968</td><td class="hits">0</td><td class="source">    if (typeof relation !== 'function')</td></tr><tr class="miss"><td class="line">969</td><td class="hits">0</td><td class="source">      self.cypher.relationship = relation;</td></tr><tr class="miss"><td class="line">970</td><td class="hits">0</td><td class="source">    self.cypher.node_identifier = 'n';</td></tr><tr class="miss"><td class="line">971</td><td class="hits">0</td><td class="source">    self.cypher.start = 'n = node('+self._start_node_id('*')+'), m = node('+self._end_node_id('*')+')';</td></tr><tr class="miss"><td class="line">972</td><td class="hits">0</td><td class="source">    self.cypher.incoming = true;</td></tr><tr class="miss"><td class="line">973</td><td class="hits">0</td><td class="source">    self.cypher.outgoing = true;</td></tr><tr class="miss"><td class="line">974</td><td class="hits">0</td><td class="source">    self.cypher.return_properties = ['n', 'm', 'r'];</td></tr><tr class="miss"><td class="line">975</td><td class="hits">0</td><td class="source">    self.exec(cb);</td></tr><tr class="miss"><td class="line">976</td><td class="hits">0</td><td class="source">    return self; // return self for chaining</td></tr><tr><td class="line">977</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">978</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">979</td><td class="hits">10</td><td class="source">  Node.prototype.relationshipsBetween = function(node, relation, cb) {</td></tr><tr class="miss"><td class="line">980</td><td class="hits">0</td><td class="source">    var self = this.singletonForQuery();</td></tr><tr class="miss"><td class="line">981</td><td class="hits">0</td><td class="source">    self._modified_query = true;</td></tr><tr class="miss"><td class="line">982</td><td class="hits">0</td><td class="source">    self.cypher.to = helpers.getIdFromObject(node);</td></tr><tr class="miss"><td class="line">983</td><td class="hits">0</td><td class="source">    if (typeof relation !== 'function')</td></tr><tr class="miss"><td class="line">984</td><td class="hits">0</td><td class="source">      self.cypher.relationship = relation;</td></tr><tr class="miss"><td class="line">985</td><td class="hits">0</td><td class="source">    self.cypher.return_properties = ['r'];</td></tr><tr class="miss"><td class="line">986</td><td class="hits">0</td><td class="source">    self.exec(cb);</td></tr><tr class="miss"><td class="line">987</td><td class="hits">0</td><td class="source">    return self.allDirections(relation, cb);</td></tr><tr><td class="line">988</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">989</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">990</td><td class="hits">10</td><td class="source">  Node.prototype.allRelationships = function(relation, cb) {</td></tr><tr class="hit"><td class="line">991</td><td class="hits">7</td><td class="source">    var self = this.singletonForQuery();</td></tr><tr class="hit"><td class="line">992</td><td class="hits">7</td><td class="source">    var label = (this.cypher.label) ? ':'+this.cypher.label : '';</td></tr><tr class="hit"><td class="line">993</td><td class="hits">7</td><td class="source">    if (typeof relation === 'string') {</td></tr><tr class="hit"><td class="line">994</td><td class="hits">1</td><td class="source">      relation = ':'+relation;</td></tr><tr><td class="line">995</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">996</td><td class="hits">6</td><td class="source">      cb = relation;</td></tr><tr class="hit"><td class="line">997</td><td class="hits">6</td><td class="source">      relation = '';</td></tr><tr><td class="line">998</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">999</td><td class="hits">7</td><td class="source">    self._modified_query = true;</td></tr><tr class="hit"><td class="line">1000</td><td class="hits">7</td><td class="source">    self.cypher.match.push('n'+label+'-[r'+relation+']-()');</td></tr><tr class="hit"><td class="line">1001</td><td class="hits">7</td><td class="source">    self.cypher.return_properties = ['r'];</td></tr><tr class="hit"><td class="line">1002</td><td class="hits">7</td><td class="source">    self.exec(cb);</td></tr><tr class="hit"><td class="line">1003</td><td class="hits">7</td><td class="source">    return self; // return self for chaining</td></tr><tr><td class="line">1004</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1005</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1006</td><td class="hits">10</td><td class="source">  Node.prototype.limit = function(limit, cb) {</td></tr><tr class="hit"><td class="line">1007</td><td class="hits">6</td><td class="source">    this._modified_query = true;</td></tr><tr class="hit"><td class="line">1008</td><td class="hits">6</td><td class="source">    this.cypher.limit = Number(limit);</td></tr><tr class="hit"><td class="line">1009</td><td class="hits">6</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">1010</td><td class="hits">6</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">1011</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1012</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1013</td><td class="hits">10</td><td class="source">  Node.prototype.skip = function(skip, cb) {</td></tr><tr class="hit"><td class="line">1014</td><td class="hits">3</td><td class="source">    this._modified_query = true;</td></tr><tr class="hit"><td class="line">1015</td><td class="hits">3</td><td class="source">    this.cypher.skip = Number(skip);</td></tr><tr class="hit"><td class="line">1016</td><td class="hits">3</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">1017</td><td class="hits">3</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">1018</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1019</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1020</td><td class="hits">10</td><td class="source">  Node.prototype.distinct = function(cb) {</td></tr><tr class="hit"><td class="line">1021</td><td class="hits">1</td><td class="source">    this._modified_query = true;</td></tr><tr class="hit"><td class="line">1022</td><td class="hits">1</td><td class="source">    this.cypher._distinct = true;</td></tr><tr class="hit"><td class="line">1023</td><td class="hits">1</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">1024</td><td class="hits">1</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">1025</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1026</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1027</td><td class="hits">10</td><td class="source">  Node.prototype.orderBy = function(property, direction, cb) {</td></tr><tr class="hit"><td class="line">1028</td><td class="hits">3</td><td class="source">    this._modified_query = true;</td></tr><tr class="hit"><td class="line">1029</td><td class="hits">3</td><td class="source">    if (typeof direction === 'string')</td></tr><tr class="hit"><td class="line">1030</td><td class="hits">3</td><td class="source">      this.cypher.order_direction = direction;</td></tr><tr class="hit"><td class="line">1031</td><td class="hits">3</td><td class="source">    this.cypher.order_by = property;</td></tr><tr class="hit"><td class="line">1032</td><td class="hits">3</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">1033</td><td class="hits">3</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">1034</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1035</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1036</td><td class="hits">10</td><td class="source">  Node.prototype.match = function(string, cb) {</td></tr><tr class="hit"><td class="line">1037</td><td class="hits">3</td><td class="source">    this.cypher.match.push(string);</td></tr><tr class="hit"><td class="line">1038</td><td class="hits">3</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">1039</td><td class="hits">3</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">1040</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1041</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1042</td><td class="hits">10</td><td class="source">  Node.prototype.where = function(where, cb) {</td></tr><tr class="hit"><td class="line">1043</td><td class="hits">16</td><td class="source">    this._modified_query = true;</td></tr><tr class="hit"><td class="line">1044</td><td class="hits">16</td><td class="source">    this.cypher.where = [];</td></tr><tr class="hit"><td class="line">1045</td><td class="hits">16</td><td class="source">    return this.andWhere(where, cb);</td></tr><tr><td class="line">1046</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1047</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1048</td><td class="hits">10</td><td class="source">  Node.prototype.andWhere = function(where, cb, _options) {</td></tr><tr class="hit"><td class="line">1049</td><td class="hits">50</td><td class="source">    this._modified_query = true;</td></tr><tr class="hit"><td class="line">1050</td><td class="hits">50</td><td class="source">    if ((_.isObject(where))&amp;&amp;(!_.isArray(where)))</td></tr><tr class="hit"><td class="line">1051</td><td class="hits">15</td><td class="source">      where = [ where ];</td></tr><tr class="hit"><td class="line">1052</td><td class="hits">50</td><td class="source">    var attributes = helpers.extractAttributesFromCondition(_.extend(where));</td></tr><tr class="hit"><td class="line">1053</td><td class="hits">50</td><td class="source">    for (var i = 0; i &lt; attributes.length; i++) {</td></tr><tr class="hit"><td class="line">1054</td><td class="hits">26</td><td class="source">      this.whereHasProperty(attributes[i]);</td></tr><tr><td class="line">1055</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1056</td><td class="hits">50</td><td class="source">    if (typeof _options === 'undefined')</td></tr><tr class="hit"><td class="line">1057</td><td class="hits">48</td><td class="source">      _options = {};</td></tr><tr class="hit"><td class="line">1058</td><td class="hits">50</td><td class="source">    if (typeof _options.identifier !== 'string')</td></tr><tr><td class="line">1059</td><td class="hits"></td><td class="source">      // good or bad idea that we use by default n as identifier?</td></tr><tr class="hit"><td class="line">1060</td><td class="hits">48</td><td class="source">      _options.identifier = 'n';</td></tr><tr class="hit"><td class="line">1061</td><td class="hits">50</td><td class="source">    this.cypher.where.push(helpers.conditionalParameterToString(_.extend(where),undefined,_options));</td></tr><tr class="hit"><td class="line">1062</td><td class="hits">50</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">1063</td><td class="hits">50</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">1064</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1065</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">1066</td><td class="hits">10</td><td class="source">  Node.prototype.whereStartNode = function(where, cb) {</td></tr><tr class="miss"><td class="line">1067</td><td class="hits">0</td><td class="source">    this.cypher.where = [];</td></tr><tr class="miss"><td class="line">1068</td><td class="hits">0</td><td class="source">    return this.andWhere(where, cb, { identifier: 'n' });</td></tr><tr><td class="line">1069</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1070</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1071</td><td class="hits">10</td><td class="source">  Node.prototype.whereEndNode = function(where, cb) {</td></tr><tr class="miss"><td class="line">1072</td><td class="hits">0</td><td class="source">    this.cypher.where = [];</td></tr><tr class="miss"><td class="line">1073</td><td class="hits">0</td><td class="source">    return this.andWhere(where, cb, { identifier: 'm' });</td></tr><tr><td class="line">1074</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1075</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1076</td><td class="hits">10</td><td class="source">  Node.prototype.whereNode = function(where, cb) {</td></tr><tr class="hit"><td class="line">1077</td><td class="hits">1</td><td class="source">    this.cypher.where = [];</td></tr><tr class="hit"><td class="line">1078</td><td class="hits">1</td><td class="source">    return this.andWhere(where, cb, { identifier: 'n' });</td></tr><tr><td class="line">1079</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1080</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1081</td><td class="hits">10</td><td class="source">  Node.prototype.whereRelationship = function(where, cb) {</td></tr><tr class="hit"><td class="line">1082</td><td class="hits">1</td><td class="source">    this.cypher.where = [];</td></tr><tr class="hit"><td class="line">1083</td><td class="hits">1</td><td class="source">    return this.andWhere(where, cb, { identifier: 'r' });</td></tr><tr><td class="line">1084</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1085</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1086</td><td class="hits">10</td><td class="source">  Node.prototype.andWhereStartNode = function(where, cb) {</td></tr><tr class="miss"><td class="line">1087</td><td class="hits">0</td><td class="source">    return this.andWhere(where, cb, {identifier: 'n' });</td></tr><tr><td class="line">1088</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1089</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1090</td><td class="hits">10</td><td class="source">  Node.prototype.andWhereEndNode = function(where, cb) {</td></tr><tr class="miss"><td class="line">1091</td><td class="hits">0</td><td class="source">    return this.andWhere(where, cb, { identifier: 'm' });</td></tr><tr><td class="line">1092</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1093</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1094</td><td class="hits">10</td><td class="source">  Node.prototype.andWhereNode = function(where, cb) {</td></tr><tr class="miss"><td class="line">1095</td><td class="hits">0</td><td class="source">    return this.andWhere(where, cb, { identifier: 'n' });</td></tr><tr><td class="line">1096</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1097</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1098</td><td class="hits">10</td><td class="source">  Node.prototype.andWereRelationship = function(where, cb) {</td></tr><tr class="miss"><td class="line">1099</td><td class="hits">0</td><td class="source">    return this.andWhere(where, cb, { identifier: 'r' });</td></tr><tr><td class="line">1100</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1101</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1102</td><td class="hits">10</td><td class="source">  Node.prototype.whereHasProperty = function(property, identifier, cb) {</td></tr><tr class="hit"><td class="line">1103</td><td class="hits">29</td><td class="source">    if (_.isFunction(identifier)) {</td></tr><tr class="miss"><td class="line">1104</td><td class="hits">0</td><td class="source">      cb = identifier;</td></tr><tr class="miss"><td class="line">1105</td><td class="hits">0</td><td class="source">      identifier = null;</td></tr><tr><td class="line">1106</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1107</td><td class="hits">29</td><td class="source">    this._modified_query = true;</td></tr><tr class="hit"><td class="line">1108</td><td class="hits">29</td><td class="source">    if (typeof property !== 'string') {</td></tr><tr><td class="line">1109</td><td class="hits"></td><td class="source">      // we need a property to proceed</td></tr><tr class="miss"><td class="line">1110</td><td class="hits">0</td><td class="source">      return cb(Error('Property name is mandatory.'),null);</td></tr><tr><td class="line">1111</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1112</td><td class="hits">29</td><td class="source">    if (this.cypher.return_properties.length === 0) {</td></tr><tr class="hit"><td class="line">1113</td><td class="hits">3</td><td class="source">      this.findAll();</td></tr><tr><td class="line">1114</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1115</td><td class="hits"></td><td class="source">    // no identifier found, guessing from return properties</td></tr><tr class="hit"><td class="line">1116</td><td class="hits">29</td><td class="source">    if (typeof identifier !== 'string')</td></tr><tr class="hit"><td class="line">1117</td><td class="hits">29</td><td class="source">      identifier = this.cypher.return_properties[this.cypher.return_properties.length-1];</td></tr><tr class="hit"><td class="line">1118</td><td class="hits">29</td><td class="source">    this.andWhere('HAS ('+identifier+'.`'+property+'`)');</td></tr><tr class="hit"><td class="line">1119</td><td class="hits">29</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">1120</td><td class="hits">29</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">1121</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1122</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1123</td><td class="hits">10</td><td class="source">  Node.prototype.whereNodeHasProperty = function(property, cb) {</td></tr><tr class="miss"><td class="line">1124</td><td class="hits">0</td><td class="source">    return this.whereHasProperty(property, 'n', cb);</td></tr><tr><td class="line">1125</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1126</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1127</td><td class="hits">10</td><td class="source">  Node.prototype.whereStartNodeHasProperty = function(property, cb) {</td></tr><tr class="miss"><td class="line">1128</td><td class="hits">0</td><td class="source">    return this.whereHasProperty(property, 'n', cb);</td></tr><tr><td class="line">1129</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1130</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1131</td><td class="hits">10</td><td class="source">  Node.prototype.whereEndNodeHasProperty = function(property, cb) {</td></tr><tr class="miss"><td class="line">1132</td><td class="hits">0</td><td class="source">    return this.whereHasProperty(property, 'm', cb);</td></tr><tr><td class="line">1133</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1134</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1135</td><td class="hits">10</td><td class="source">  Node.prototype.whereRelationshipHasProperty = function(property, cb) {</td></tr><tr class="miss"><td class="line">1136</td><td class="hits">0</td><td class="source">    return this.whereHasProperty(property, 'r', cb);</td></tr><tr><td class="line">1137</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1138</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1139</td><td class="hits">10</td><td class="source">  Node.prototype.delete = function(cb) {</td></tr><tr class="hit"><td class="line">1140</td><td class="hits">7</td><td class="source">    if (this.hasId())</td></tr><tr class="miss"><td class="line">1141</td><td class="hits">0</td><td class="source">      return cb(Error('To delete a node, use remove(). delete() is for queries.'),null);</td></tr><tr class="hit"><td class="line">1142</td><td class="hits">7</td><td class="source">    this._modified_query = true;</td></tr><tr class="hit"><td class="line">1143</td><td class="hits">7</td><td class="source">    this.cypher.action = 'DELETE';</td></tr><tr class="hit"><td class="line">1144</td><td class="hits">7</td><td class="source">    this.cypher.limit = '';</td></tr><tr class="hit"><td class="line">1145</td><td class="hits">7</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">1146</td><td class="hits">7</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">1147</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1148</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1149</td><td class="hits">10</td><td class="source">  Node.prototype.remove = function(cb) {</td></tr><tr class="hit"><td class="line">1150</td><td class="hits">17</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1151</td><td class="hits">17</td><td class="source">    this.onBeforeRemove(function(err) {</td></tr><tr class="hit"><td class="line">1152</td><td class="hits">17</td><td class="source">      if (self.is_singleton)</td></tr><tr class="miss"><td class="line">1153</td><td class="hits">0</td><td class="source">        return cb(Error(&quot;To delete results of a query use delete(). remove() is for removing an instanced node.&quot;),null);</td></tr><tr class="hit"><td class="line">1154</td><td class="hits">17</td><td class="source">      if (self.hasId()) {</td></tr><tr class="hit"><td class="line">1155</td><td class="hits">17</td><td class="source">        return self.neo4jrestful.delete('/db/data/node/'+self.id, cb);</td></tr><tr><td class="line">1156</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1157</td><td class="hits"></td><td class="source">    })</td></tr><tr class="hit"><td class="line">1158</td><td class="hits">17</td><td class="source">    return this;</td></tr><tr><td class="line">1159</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1160</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1161</td><td class="hits">26</td><td class="source">  Node.prototype.onBeforeRemove = function(next) { next(null,null); }</td></tr><tr><td class="line">1162</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1163</td><td class="hits">10</td><td class="source">  Node.prototype.removeWithRelationships = function(cb) {</td></tr><tr class="hit"><td class="line">1164</td><td class="hits">5</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1165</td><td class="hits">5</td><td class="source">    return this.removeAllRelationships(function(err) {</td></tr><tr class="hit"><td class="line">1166</td><td class="hits">5</td><td class="source">      if (err)</td></tr><tr class="miss"><td class="line">1167</td><td class="hits">0</td><td class="source">        return cb(err, null);</td></tr><tr><td class="line">1168</td><td class="hits"></td><td class="source">      // remove now node</td></tr><tr class="hit"><td class="line">1169</td><td class="hits">5</td><td class="source">      return self.remove(cb);</td></tr><tr><td class="line">1170</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">1171</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1172</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1173</td><td class="hits"></td><td class="source">  // Node.prototype.removeRelationshipsFrom = function() { }</td></tr><tr><td class="line">1174</td><td class="hits"></td><td class="source">  // Node.prototype.removeRelationshipsTo = function() { }</td></tr><tr><td class="line">1175</td><td class="hits"></td><td class="source">  // Node.prototype.removeRelationshipsBetween = function() {}</td></tr><tr class="hit"><td class="line">1176</td><td class="hits">10</td><td class="source">  Node.prototype.removeOutgoinRelationships = function(type, cb) {</td></tr><tr class="miss"><td class="line">1177</td><td class="hits">0</td><td class="source">    return this.removeRelationships(type, cb, { direction: '-&gt;' });</td></tr><tr><td class="line">1178</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">1179</td><td class="hits">10</td><td class="source">  Node.prototype.removeIncomingRelationships = function(type, cb) {</td></tr><tr class="miss"><td class="line">1180</td><td class="hits">0</td><td class="source">    return this.removeRelationships(type, cb, { direction: '&lt;-' });</td></tr><tr><td class="line">1181</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1182</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1183</td><td class="hits">10</td><td class="source">  Node.prototype.removeAllRelationships = function(cb) {</td></tr><tr class="hit"><td class="line">1184</td><td class="hits">5</td><td class="source">    return this.removeRelationships('', cb);</td></tr><tr><td class="line">1185</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">1186</td><td class="hits">10</td><td class="source">  Node.prototype.removeRelationships = function(type, cb, _options) {</td></tr><tr class="hit"><td class="line">1187</td><td class="hits">5</td><td class="source">    if (typeof type === 'function') {</td></tr><tr class="miss"><td class="line">1188</td><td class="hits">0</td><td class="source">      _options = cb;</td></tr><tr class="miss"><td class="line">1189</td><td class="hits">0</td><td class="source">      cb = type;</td></tr><tr class="miss"><td class="line">1190</td><td class="hits">0</td><td class="source">      type = null;</td></tr><tr><td class="line">1191</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1192</td><td class="hits">5</td><td class="source">    var defaultOptions = {</td></tr><tr><td class="line">1193</td><td class="hits"></td><td class="source">      direction: 'all', // incoming / outgoing</td></tr><tr><td class="line">1194</td><td class="hits"></td><td class="source">      type: type,</td></tr><tr><td class="line">1195</td><td class="hits"></td><td class="source">      endNodeId: null</td></tr><tr><td class="line">1196</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">1197</td><td class="hits">5</td><td class="source">    if (typeof _options === 'undefined') {</td></tr><tr class="hit"><td class="line">1198</td><td class="hits">5</td><td class="source">      _options = _.extend({},defaultOptions);</td></tr><tr><td class="line">1199</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">1200</td><td class="hits">0</td><td class="source">      _options = _.extend({},defaultOptions,_options);</td></tr><tr><td class="line">1201</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1202</td><td class="hits">5</td><td class="source">    if ((this.hasId())&amp;&amp;(typeof cb === 'function')) {</td></tr><tr class="hit"><td class="line">1203</td><td class="hits">5</td><td class="source">      var direction = _options.direction;</td></tr><tr class="hit"><td class="line">1204</td><td class="hits">5</td><td class="source">      if ( (!(direction === 'incoming')) || (!(direction === 'outgoing')) )</td></tr><tr class="hit"><td class="line">1205</td><td class="hits">5</td><td class="source">        direction = 'all';</td></tr><tr class="hit"><td class="line">1206</td><td class="hits">5</td><td class="source">      return Node.prototype.findById(this.id)[direction+'Relationships']().delete(cb);</td></tr><tr><td class="line">1207</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">1208</td><td class="hits">0</td><td class="source">      return cb(Error(&quot;You can remove relationships only from an instanced node /w a valid cb&quot;), null);</td></tr><tr><td class="line">1209</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1210</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1211</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1212</td><td class="hits">10</td><td class="source">  Node.prototype.createRelationship = function(options, cb) {</td></tr><tr class="hit"><td class="line">1213</td><td class="hits">15</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1214</td><td class="hits">15</td><td class="source">    options = _.extend({</td></tr><tr><td class="line">1215</td><td class="hits"></td><td class="source">      from_id: this.id,</td></tr><tr><td class="line">1216</td><td class="hits"></td><td class="source">      to_id: null,</td></tr><tr><td class="line">1217</td><td class="hits"></td><td class="source">      type: null,</td></tr><tr><td class="line">1218</td><td class="hits"></td><td class="source">      // unique: false ,// TODO: implement!</td></tr><tr><td class="line">1219</td><td class="hits"></td><td class="source">      properties: null,</td></tr><tr><td class="line">1220</td><td class="hits"></td><td class="source">      distinct: null</td></tr><tr><td class="line">1221</td><td class="hits"></td><td class="source">    }, options);</td></tr><tr><td class="line">1222</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1223</td><td class="hits">15</td><td class="source">    if (options.properties)</td></tr><tr class="hit"><td class="line">1224</td><td class="hits">15</td><td class="source">      options.properties = helpers.flattenObject(options.properties);</td></tr><tr><td class="line">1225</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1226</td><td class="hits">15</td><td class="source">    var _create_relationship_by_options = function(options) {</td></tr><tr class="hit"><td class="line">1227</td><td class="hits">13</td><td class="source">      return self.neo4jrestful.post('/db/data/node/'+options.from_id+'/relationships', {</td></tr><tr><td class="line">1228</td><td class="hits"></td><td class="source">        data: {</td></tr><tr><td class="line">1229</td><td class="hits"></td><td class="source">          to: new Node({},options.to_id).uri,</td></tr><tr><td class="line">1230</td><td class="hits"></td><td class="source">          type: options.type,</td></tr><tr><td class="line">1231</td><td class="hits"></td><td class="source">          data: options.properties</td></tr><tr><td class="line">1232</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">1233</td><td class="hits"></td><td class="source">      }, cb);</td></tr><tr><td class="line">1234</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1235</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1236</td><td class="hits">15</td><td class="source">    if ((_.isNumber(options.from_id))&amp;&amp;(_.isNumber(options.to_id))&amp;&amp;(typeof cb === 'function')) {</td></tr><tr class="hit"><td class="line">1237</td><td class="hits">15</td><td class="source">      if (options.distinct) {</td></tr><tr class="hit"><td class="line">1238</td><td class="hits">2</td><td class="source">        this.neo4jrestful.get('/db/data/node/'+options.from_id+'/relationships/out/'+options.type, function(err, result) {</td></tr><tr class="hit"><td class="line">1239</td><td class="hits">2</td><td class="source">          if (err)</td></tr><tr class="miss"><td class="line">1240</td><td class="hits">0</td><td class="source">            return cb(err, result);</td></tr><tr class="hit"><td class="line">1241</td><td class="hits">2</td><td class="source">          if (result.length === 1) {</td></tr><tr><td class="line">1242</td><td class="hits"></td><td class="source">            // if we have only one relationship, we update this one</td></tr><tr><td class="line">1243</td><td class="hits"></td><td class="source">            // var properties = (options.properties) ? options.properties : {};</td></tr><tr class="hit"><td class="line">1244</td><td class="hits">2</td><td class="source">            return self.neo4jrestful.put('/db/data/relationship/'+result[0].id+'/properties', { data: options.properties }, function(err) {</td></tr><tr class="hit"><td class="line">1245</td><td class="hits">2</td><td class="source">              if (err)</td></tr><tr class="miss"><td class="line">1246</td><td class="hits">0</td><td class="source">                cb(err, null);</td></tr><tr><td class="line">1247</td><td class="hits"></td><td class="source">              else {</td></tr><tr><td class="line">1248</td><td class="hits"></td><td class="source">                // TODO: Relationship::findById</td></tr><tr class="hit"><td class="line">1249</td><td class="hits">2</td><td class="source">                self.neo4jrestful.get('/db/data/relationship/'+result[0].id, cb);</td></tr><tr><td class="line">1250</td><td class="hits"></td><td class="source">              }</td></tr><tr><td class="line">1251</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">1252</td><td class="hits"></td><td class="source">          } else {</td></tr><tr><td class="line">1253</td><td class="hits"></td><td class="source">            // we create a new one</td></tr><tr class="miss"><td class="line">1254</td><td class="hits">0</td><td class="source">            return _create_relationship_by_options(options);</td></tr><tr><td class="line">1255</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">1256</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">1257</td><td class="hits"></td><td class="source">      } else {</td></tr><tr><td class="line">1258</td><td class="hits"></td><td class="source">        // create relationship</td></tr><tr class="hit"><td class="line">1259</td><td class="hits">13</td><td class="source">        return _create_relationship_by_options(options);</td></tr><tr><td class="line">1260</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1261</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">1262</td><td class="hits">0</td><td class="source">      cb(Error('Missing from_id('+options.from_id+') or to_id('+options.to_id+') OR no cb attached'), null);</td></tr><tr><td class="line">1263</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1264</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1265</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1266</td><td class="hits">10</td><td class="source">  Node.prototype.createRelationshipBetween = function(node, type, properties, cb, options) {</td></tr><tr class="hit"><td class="line">1267</td><td class="hits">4</td><td class="source">    if (typeof options !== 'object') options = {};</td></tr><tr class="hit"><td class="line">1268</td><td class="hits">2</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1269</td><td class="hits">2</td><td class="source">    if (typeof properties === 'function') {</td></tr><tr class="hit"><td class="line">1270</td><td class="hits">1</td><td class="source">      cb = properties;</td></tr><tr class="hit"><td class="line">1271</td><td class="hits">1</td><td class="source">      properties = {};</td></tr><tr><td class="line">1272</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1273</td><td class="hits">2</td><td class="source">    if ((this.hasId())&amp;&amp;(helpers.getIdFromObject(node))) {</td></tr><tr><td class="line">1274</td><td class="hits"></td><td class="source">      // to avoid deadlocks</td></tr><tr><td class="line">1275</td><td class="hits"></td><td class="source">      // we have to create the relationships sequentially</td></tr><tr class="hit"><td class="line">1276</td><td class="hits">2</td><td class="source">      self.createRelationshipTo(node, type, properties, function(err, resultFirst, debug_a){</td></tr><tr class="hit"><td class="line">1277</td><td class="hits">2</td><td class="source">        self.createRelationshipFrom(node, type, properties, function(secondErr, resultSecond, debug_b) {</td></tr><tr class="hit"><td class="line">1278</td><td class="hits">2</td><td class="source">          if ((err)||(secondErr)) {</td></tr><tr class="miss"><td class="line">1279</td><td class="hits">0</td><td class="source">            if ((err)&amp;&amp;(secondErr))</td></tr><tr class="miss"><td class="line">1280</td><td class="hits">0</td><td class="source">              cb([err, secondErr], null, [ debug_a, debug_b ]);</td></tr><tr><td class="line">1281</td><td class="hits"></td><td class="source">            else</td></tr><tr class="miss"><td class="line">1282</td><td class="hits">0</td><td class="source">              cb(err || secondErr, null, [ debug_a, debug_b ]);</td></tr><tr><td class="line">1283</td><td class="hits"></td><td class="source">          } else {</td></tr><tr class="hit"><td class="line">1284</td><td class="hits">2</td><td class="source">            cb(null, [ resultFirst, resultSecond ], debug_a || debug_b);</td></tr><tr><td class="line">1285</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">1286</td><td class="hits"></td><td class="source">        }, options);</td></tr><tr><td class="line">1287</td><td class="hits"></td><td class="source">      }, options);</td></tr><tr><td class="line">1288</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">1289</td><td class="hits">0</td><td class="source">      cb(Error(&quot;You need two instanced nodes as start and end point.&quot;), null);</td></tr><tr><td class="line">1290</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1291</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">1292</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1293</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1294</td><td class="hits">10</td><td class="source">  Node.prototype.createRelationshipTo = function(node, type, properties, cb, options) {</td></tr><tr class="hit"><td class="line">1295</td><td class="hits">16</td><td class="source">    if (typeof options !== 'object') options = {};</td></tr><tr class="hit"><td class="line">1296</td><td class="hits">9</td><td class="source">    var args;</td></tr><tr class="hit"><td class="line">1297</td><td class="hits">9</td><td class="source">    var id = helpers.getIdFromObject(node);</td></tr><tr class="hit"><td class="line">1298</td><td class="hits">9</td><td class="source">    ( ( args = helpers.sortOptionsAndCallbackArguments(properties, cb) ) &amp;&amp; ( properties = args.options ) &amp;&amp; ( cb = args.callback ) );</td></tr><tr class="hit"><td class="line">1299</td><td class="hits">9</td><td class="source">    options = _.extend({</td></tr><tr><td class="line">1300</td><td class="hits"></td><td class="source">      properties: properties,</td></tr><tr><td class="line">1301</td><td class="hits"></td><td class="source">      to_id: id,</td></tr><tr><td class="line">1302</td><td class="hits"></td><td class="source">      type: type</td></tr><tr><td class="line">1303</td><td class="hits"></td><td class="source">    }, options);</td></tr><tr class="hit"><td class="line">1304</td><td class="hits">9</td><td class="source">    return this.createRelationship(options, cb);</td></tr><tr><td class="line">1305</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1306</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1307</td><td class="hits">10</td><td class="source">  Node.prototype.createRelationshipFrom = function(node, type, properties, cb, options) {</td></tr><tr class="hit"><td class="line">1308</td><td class="hits">8</td><td class="source">    if (typeof options !== 'object') options = {};</td></tr><tr class="hit"><td class="line">1309</td><td class="hits">6</td><td class="source">    var args;</td></tr><tr class="hit"><td class="line">1310</td><td class="hits">6</td><td class="source">    var id = helpers.getIdFromObject(node);</td></tr><tr class="hit"><td class="line">1311</td><td class="hits">6</td><td class="source">    ( ( args = helpers.sortOptionsAndCallbackArguments(properties, cb) ) &amp;&amp; ( properties = args.options ) &amp;&amp; ( cb = args.callback ) );</td></tr><tr class="hit"><td class="line">1312</td><td class="hits">6</td><td class="source">    options = _.extend({</td></tr><tr><td class="line">1313</td><td class="hits"></td><td class="source">      properties: properties,</td></tr><tr><td class="line">1314</td><td class="hits"></td><td class="source">      from_id: id,</td></tr><tr><td class="line">1315</td><td class="hits"></td><td class="source">      to_id: this.id,</td></tr><tr><td class="line">1316</td><td class="hits"></td><td class="source">      type: type</td></tr><tr><td class="line">1317</td><td class="hits"></td><td class="source">    }, options);</td></tr><tr class="hit"><td class="line">1318</td><td class="hits">6</td><td class="source">    return this.createRelationship(options, cb);</td></tr><tr><td class="line">1319</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1320</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1321</td><td class="hits">10</td><td class="source">  Node.prototype.createOrUpdateRelationship = function(options, cb) {</td></tr><tr class="miss"><td class="line">1322</td><td class="hits">0</td><td class="source">    if (typeof options !== 'object') options = {};</td></tr><tr class="miss"><td class="line">1323</td><td class="hits">0</td><td class="source">    options.distinct = true;</td></tr><tr class="miss"><td class="line">1324</td><td class="hits">0</td><td class="source">    return this.createRelationship(options, cb);</td></tr><tr><td class="line">1325</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1326</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1327</td><td class="hits">10</td><td class="source">  Node.prototype.createOrUpdateRelationshipTo = function(node, type, properties, cb, options) {</td></tr><tr class="miss"><td class="line">1328</td><td class="hits">0</td><td class="source">    if (typeof options !== 'object') options = {};</td></tr><tr class="miss"><td class="line">1329</td><td class="hits">0</td><td class="source">    options.distinct = true;</td></tr><tr class="miss"><td class="line">1330</td><td class="hits">0</td><td class="source">    return this.createRelationshipTo(node, type, properties, cb, options);</td></tr><tr><td class="line">1331</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1332</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1333</td><td class="hits">10</td><td class="source">  Node.prototype.createOrUpdateRelationshipFrom = function(node, type, properties, cb, options) {</td></tr><tr class="hit"><td class="line">1334</td><td class="hits">4</td><td class="source">    if (typeof options !== 'object') options = {};</td></tr><tr class="hit"><td class="line">1335</td><td class="hits">2</td><td class="source">    options.distinct = true;</td></tr><tr class="hit"><td class="line">1336</td><td class="hits">2</td><td class="source">    return this.createRelationshipFrom(node, type, properties, cb, options);</td></tr><tr><td class="line">1337</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1338</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1339</td><td class="hits">10</td><td class="source">  Node.prototype.createOrUpdateRelationshipBetween = function(node, type, properties, cb, options) {</td></tr><tr class="miss"><td class="line">1340</td><td class="hits">0</td><td class="source">    if (typeof options !== 'object') options = {};</td></tr><tr class="miss"><td class="line">1341</td><td class="hits">0</td><td class="source">    options.distinct = true;</td></tr><tr class="miss"><td class="line">1342</td><td class="hits">0</td><td class="source">    return this.createRelationshipBetween(node, type, properties, cb, options);</td></tr><tr><td class="line">1343</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1344</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1345</td><td class="hits">10</td><td class="source">  Node.prototype.recommendConstructor = function(Fallback) {</td></tr><tr class="hit"><td class="line">1346</td><td class="hits">52</td><td class="source">    if (typeof Fallback !== 'function')</td></tr><tr class="hit"><td class="line">1347</td><td class="hits">52</td><td class="source">      Fallback = this.constructor;</td></tr><tr class="hit"><td class="line">1348</td><td class="hits">52</td><td class="source">    var label = (this.label) ? this.label : ( ((this.labels)&amp;&amp;(this.labels.length===1)) ? this.labels[0] : null );</td></tr><tr class="hit"><td class="line">1349</td><td class="hits">52</td><td class="source">    return (label) ? this.registered_model(label) || Fallback : Fallback;</td></tr><tr><td class="line">1350</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1351</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1352</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">1353</td><td class="hits"></td><td class="source">   * Label methods</td></tr><tr><td class="line">1354</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1355</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1356</td><td class="hits">10</td><td class="source">  Node.prototype.requestLabels = function(cb) {</td></tr><tr class="hit"><td class="line">1357</td><td class="hits">2</td><td class="source">    if ((this.hasId())&amp;&amp;(typeof cb === 'function')) {</td></tr><tr class="hit"><td class="line">1358</td><td class="hits">2</td><td class="source">      this.neo4jrestful.get('/db/data/node/'+this.id+'/labels', cb);</td></tr><tr><td class="line">1359</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1360</td><td class="hits">2</td><td class="source">    return this;</td></tr><tr><td class="line">1361</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1362</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1363</td><td class="hits">10</td><td class="source">  Node.prototype.setLabels = function(labels) {</td></tr><tr class="miss"><td class="line">1364</td><td class="hits">0</td><td class="source">    if (_.isArray(labels)) {</td></tr><tr class="miss"><td class="line">1365</td><td class="hits">0</td><td class="source">      this.labels = _.clone(labels);</td></tr><tr><td class="line">1366</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1367</td><td class="hits"></td><td class="source">    // if we have only one label we set this to default label</td></tr><tr class="miss"><td class="line">1368</td><td class="hits">0</td><td class="source">    if ((_.isArray(this.labels))&amp;&amp;(this.labels.length === 1)) {</td></tr><tr class="miss"><td class="line">1369</td><td class="hits">0</td><td class="source">      this.label = this.labels[0];</td></tr><tr><td class="line">1370</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">1371</td><td class="hits">0</td><td class="source">    return this.labels;</td></tr><tr><td class="line">1372</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1373</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1374</td><td class="hits">10</td><td class="source">  Node.prototype.labelsAsArray = function() {</td></tr><tr class="hit"><td class="line">1375</td><td class="hits">39</td><td class="source">    var labels = this.labels;</td></tr><tr class="hit"><td class="line">1376</td><td class="hits">39</td><td class="source">    if (!_.isArray(labels))</td></tr><tr class="miss"><td class="line">1377</td><td class="hits">0</td><td class="source">      labels = [];</td></tr><tr class="hit"><td class="line">1378</td><td class="hits">39</td><td class="source">    if (this.label)</td></tr><tr class="hit"><td class="line">1379</td><td class="hits">12</td><td class="source">      labels.push(this.label);</td></tr><tr class="hit"><td class="line">1380</td><td class="hits">39</td><td class="source">    return _.uniq(labels);</td></tr><tr><td class="line">1381</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1382</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1383</td><td class="hits">10</td><td class="source">  Node.prototype.allLabels = function(cb) {</td></tr><tr class="hit"><td class="line">1384</td><td class="hits">37</td><td class="source">    if ( (this.hasId()) &amp;&amp; (_.isFunction(cb)) )</td></tr><tr class="hit"><td class="line">1385</td><td class="hits">37</td><td class="source">      return this.neo4jrestful.get('/db/data/node/'+this.id+'/labels', cb);</td></tr><tr><td class="line">1386</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1387</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1388</td><td class="hits">10</td><td class="source">  Node.prototype.createLabel = function(label, cb) {</td></tr><tr class="miss"><td class="line">1389</td><td class="hits">0</td><td class="source">    return this.createLabels([ label ], cb);</td></tr><tr><td class="line">1390</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1391</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1392</td><td class="hits">10</td><td class="source">  Node.prototype.createLabels = function(labels, cb) {</td></tr><tr class="hit"><td class="line">1393</td><td class="hits">12</td><td class="source">    if ( (this.hasId()) &amp;&amp; (_.isFunction(cb)) )</td></tr><tr class="hit"><td class="line">1394</td><td class="hits">12</td><td class="source">      return this.neo4jrestful.post('/db/data/node/'+this.id+'/labels', { data: labels }, cb);</td></tr><tr><td class="line">1395</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1396</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1397</td><td class="hits">10</td><td class="source">  Node.prototype.addLabels = function(labels, cb) {</td></tr><tr class="hit"><td class="line">1398</td><td class="hits">4</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1399</td><td class="hits">4</td><td class="source">    if ( (this.hasId()) &amp;&amp; (_.isFunction(cb)) ) {</td></tr><tr class="hit"><td class="line">1400</td><td class="hits">2</td><td class="source">      if (!_.isArray(labels))</td></tr><tr class="miss"><td class="line">1401</td><td class="hits">0</td><td class="source">        labels = [ labels ];</td></tr><tr class="hit"><td class="line">1402</td><td class="hits">2</td><td class="source">      self.allLabels(function(err, storedLabels) {</td></tr><tr class="hit"><td class="line">1403</td><td class="hits">2</td><td class="source">        if (!_.isArray(storedLabels))</td></tr><tr class="miss"><td class="line">1404</td><td class="hits">0</td><td class="source">          storedLabels = [];</td></tr><tr class="hit"><td class="line">1405</td><td class="hits">2</td><td class="source">        storedLabels.push(labels);</td></tr><tr class="hit"><td class="line">1406</td><td class="hits">2</td><td class="source">        storedLabels = _.uniq(_.flatten(storedLabels));</td></tr><tr class="hit"><td class="line">1407</td><td class="hits">2</td><td class="source">        self.replaceLabels(storedLabels, cb);</td></tr><tr><td class="line">1408</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">1409</td><td class="hits"></td><td class="source">    } else {</td></tr><tr><td class="line">1410</td><td class="hits"></td><td class="source">      // otherwise it can be used as a setter</td></tr><tr class="hit"><td class="line">1411</td><td class="hits">2</td><td class="source">      this.labels = labels;</td></tr><tr class="hit"><td class="line">1412</td><td class="hits">2</td><td class="source">      if (labels.length===1)</td></tr><tr class="hit"><td class="line">1413</td><td class="hits">2</td><td class="source">        this.label = labels[0];</td></tr><tr><td class="line">1414</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1415</td><td class="hits">4</td><td class="source">    return this;</td></tr><tr><td class="line">1416</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1417</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1418</td><td class="hits">10</td><td class="source">  Node.prototype.addLabel = function(label, cb) {</td></tr><tr class="hit"><td class="line">1419</td><td class="hits">3</td><td class="source">    return this.addLabels([ label ], cb);</td></tr><tr><td class="line">1420</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1421</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1422</td><td class="hits">10</td><td class="source">  Node.prototype.replaceLabels = function(labels, cb) {</td></tr><tr class="hit"><td class="line">1423</td><td class="hits">3</td><td class="source">    if ( (this.hasId()) &amp;&amp; (_.isFunction(cb)) ) {</td></tr><tr class="hit"><td class="line">1424</td><td class="hits">3</td><td class="source">      if (!_.isArray(labels))</td></tr><tr class="miss"><td class="line">1425</td><td class="hits">0</td><td class="source">        labels = [ labels ];</td></tr><tr class="hit"><td class="line">1426</td><td class="hits">3</td><td class="source">      return this.neo4jrestful.put('/db/data/node/'+this.id+'/labels', { data: labels }, cb);</td></tr><tr><td class="line">1427</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1428</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1429</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1430</td><td class="hits">10</td><td class="source">  Node.prototype.removeLabels = function(cb) {</td></tr><tr class="miss"><td class="line">1431</td><td class="hits">0</td><td class="source">    if ( (this.hasId()) &amp;&amp; (_.isFunction(cb)) ) {</td></tr><tr class="miss"><td class="line">1432</td><td class="hits">0</td><td class="source">      return this.neo4jrestful.delete('/db/data/node/'+this.id+'/labels', cb);</td></tr><tr><td class="line">1433</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1434</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1435</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1436</td><td class="hits"></td><td class="source">  // Node.prototype.replaceLabel = function</td></tr><tr><td class="line">1437</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1438</td><td class="hits"></td><td class="source">  // TODO: autoindex? http://docs.neo4j.org/chunked/milestone/rest-api-configurable-auto-indexes.html</td></tr><tr class="hit"><td class="line">1439</td><td class="hits">10</td><td class="source">  Node.prototype.addIndex = function(namespace, key, value, cb) {</td></tr><tr class="hit"><td class="line">1440</td><td class="hits">16</td><td class="source">    if (this.is_singleton)</td></tr><tr class="miss"><td class="line">1441</td><td class="hits">0</td><td class="source">      return cb(Error('Singleton instance is not allowed to get persist.'), null);</td></tr><tr class="hit"><td class="line">1442</td><td class="hits">16</td><td class="source">    this._modified_query = false;</td></tr><tr class="hit"><td class="line">1443</td><td class="hits">16</td><td class="source">    if ( (!namespace) || (!key) || (!value) || (!_.isFunction(cb)) )</td></tr><tr class="miss"><td class="line">1444</td><td class="hits">0</td><td class="source">      throw Error('namespace, key and value arguments are mandatory for indexing.');</td></tr><tr class="hit"><td class="line">1445</td><td class="hits">16</td><td class="source">    if (!this.hasId())</td></tr><tr class="hit"><td class="line">1446</td><td class="hits">1</td><td class="source">      return cb(Error('You need to persist the node before you can index it.'),null);</td></tr><tr class="hit"><td class="line">1447</td><td class="hits">15</td><td class="source">    if (typeof cb === 'function')</td></tr><tr class="hit"><td class="line">1448</td><td class="hits">15</td><td class="source">      return this.neo4jrestful.post('/db/data/index/node/'+namespace, { data: { key: key, value: value, uri: this.uri } }, cb);</td></tr><tr><td class="line">1449</td><td class="hits"></td><td class="source">    else</td></tr><tr class="miss"><td class="line">1450</td><td class="hits">0</td><td class="source">      return null;</td></tr><tr class="miss"><td class="line">1451</td><td class="hits">0</td><td class="source">    return keys;</td></tr><tr><td class="line">1452</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1453</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1454</td><td class="hits">10</td><td class="source">  Node.prototype.toObject = function() {</td></tr><tr class="miss"><td class="line">1455</td><td class="hits">0</td><td class="source">    var o = {</td></tr><tr><td class="line">1456</td><td class="hits"></td><td class="source">      id: this.id,</td></tr><tr><td class="line">1457</td><td class="hits"></td><td class="source">      data: _.extend(this.data),</td></tr><tr><td class="line">1458</td><td class="hits"></td><td class="source">      uri: this.uri</td></tr><tr><td class="line">1459</td><td class="hits"></td><td class="source">    };</td></tr><tr class="miss"><td class="line">1460</td><td class="hits">0</td><td class="source">    if (this.label)</td></tr><tr class="miss"><td class="line">1461</td><td class="hits">0</td><td class="source">      o.label = this.label;</td></tr><tr class="miss"><td class="line">1462</td><td class="hits">0</td><td class="source">    return o;</td></tr><tr><td class="line">1463</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1464</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1465</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">1466</td><td class="hits"></td><td class="source">   * Request methods</td></tr><tr><td class="line">1467</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1468</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1469</td><td class="hits">10</td><td class="source">  Node.prototype.stream = function(cb) {</td></tr><tr class="hit"><td class="line">1470</td><td class="hits">2</td><td class="source">    this.neo4jrestful.header['X-Stream'] = 'true';</td></tr><tr class="hit"><td class="line">1471</td><td class="hits">2</td><td class="source">    this.exec(cb);</td></tr><tr class="hit"><td class="line">1472</td><td class="hits">2</td><td class="source">    return this; // return self for chaining</td></tr><tr><td class="line">1473</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1474</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1475</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">1476</td><td class="hits"></td><td class="source">   * STATIC METHODS for `find` Queries</td></tr><tr><td class="line">1477</td><td class="hits"></td><td class="source">   */ </td></tr><tr><td class="line">1478</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1479</td><td class="hits">10</td><td class="source">  Node.prototype.find = function(where, cb) {</td></tr><tr class="hit"><td class="line">1480</td><td class="hits">15</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1481</td><td class="hits">15</td><td class="source">    if (!self.is_singleton)</td></tr><tr class="hit"><td class="line">1482</td><td class="hits">15</td><td class="source">      self = this.singleton(undefined, this);</td></tr><tr class="hit"><td class="line">1483</td><td class="hits">15</td><td class="source">    self._modified_query = true;</td></tr><tr class="hit"><td class="line">1484</td><td class="hits">18</td><td class="source">    if (self.label) self.withLabel(self.label);</td></tr><tr class="hit"><td class="line">1485</td><td class="hits">15</td><td class="source">    if ((typeof where === 'string')||(typeof where === 'object')) {</td></tr><tr class="hit"><td class="line">1486</td><td class="hits">3</td><td class="source">      self.where(where);</td></tr><tr class="hit"><td class="line">1487</td><td class="hits">3</td><td class="source">      if (!self.cypher.start) {</td></tr><tr class="hit"><td class="line">1488</td><td class="hits">3</td><td class="source">        self.cypher.start = self.__type_identifier__+' = '+self.__type__+'('+self._start_node_id('*')+')';</td></tr><tr><td class="line">1489</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">1490</td><td class="hits">3</td><td class="source">      self.exec(cb);</td></tr><tr class="hit"><td class="line">1491</td><td class="hits">3</td><td class="source">      return self;</td></tr><tr><td class="line">1492</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">1493</td><td class="hits">12</td><td class="source">      return self.findAll(cb);</td></tr><tr><td class="line">1494</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1495</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1496</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1497</td><td class="hits">10</td><td class="source">  Node.prototype.findOne = function(where, cb) {</td></tr><tr class="hit"><td class="line">1498</td><td class="hits">10</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1499</td><td class="hits">10</td><td class="source">    if (typeof where === 'function') {</td></tr><tr class="miss"><td class="line">1500</td><td class="hits">0</td><td class="source">      cb = where;</td></tr><tr class="miss"><td class="line">1501</td><td class="hits">0</td><td class="source">      where = undefined;</td></tr><tr><td class="line">1502</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1503</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1504</td><td class="hits">10</td><td class="source">    self = this.find(where);</td></tr><tr class="hit"><td class="line">1505</td><td class="hits">10</td><td class="source">    self.cypher.limit = 1;</td></tr><tr class="hit"><td class="line">1506</td><td class="hits">10</td><td class="source">    self.exec(cb);</td></tr><tr class="hit"><td class="line">1507</td><td class="hits">10</td><td class="source">    return self;</td></tr><tr><td class="line">1508</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1509</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1510</td><td class="hits">10</td><td class="source">  Node.prototype.findById = function(id, cb) {</td></tr><tr class="hit"><td class="line">1511</td><td class="hits">40</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1512</td><td class="hits">40</td><td class="source">    if (!self.is_singleton)</td></tr><tr class="hit"><td class="line">1513</td><td class="hits">33</td><td class="source">      self = this.singleton(undefined, this);</td></tr><tr class="hit"><td class="line">1514</td><td class="hits">40</td><td class="source">    self.cypher.by_id = Number(id);</td></tr><tr class="hit"><td class="line">1515</td><td class="hits">40</td><td class="source">    return self.findByUniqueKeyValue('id', id, cb);</td></tr><tr><td class="line">1516</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1517</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1518</td><td class="hits">10</td><td class="source">  Node.prototype.findByUniqueKeyValue = function(key, value, cb) {</td></tr><tr class="hit"><td class="line">1519</td><td class="hits">42</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1520</td><td class="hits">42</td><td class="source">    if (!self.is_singleton)</td></tr><tr class="hit"><td class="line">1521</td><td class="hits">2</td><td class="source">      self = this.singleton(undefined, this);</td></tr><tr><td class="line">1522</td><td class="hits"></td><td class="source">    // we have s.th. like</td></tr><tr><td class="line">1523</td><td class="hits"></td><td class="source">    // { key: value }</td></tr><tr class="hit"><td class="line">1524</td><td class="hits">42</td><td class="source">    if (typeof key === 'object') {</td></tr><tr class="hit"><td class="line">1525</td><td class="hits">1</td><td class="source">      cb = value;</td></tr><tr class="hit"><td class="line">1526</td><td class="hits">1</td><td class="source">      var _key = Object.keys(key)[0];</td></tr><tr class="hit"><td class="line">1527</td><td class="hits">1</td><td class="source">      value = key[_key];</td></tr><tr class="hit"><td class="line">1528</td><td class="hits">1</td><td class="source">      key = _key;</td></tr><tr><td class="line">1529</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1530</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1531</td><td class="hits">42</td><td class="source">    if (typeof key !== 'string')</td></tr><tr class="miss"><td class="line">1532</td><td class="hits">0</td><td class="source">      key = 'id';</td></tr><tr class="hit"><td class="line">1533</td><td class="hits">42</td><td class="source">    if ( (_.isString(key)) &amp;&amp; (typeof value !== 'undefined') ) {</td></tr><tr class="hit"><td class="line">1534</td><td class="hits">42</td><td class="source">      var identifier = self.cypher.node_identifier || self.__type_identifier__;</td></tr><tr class="hit"><td class="line">1535</td><td class="hits">42</td><td class="source">      if (self.cypher.return_properties.length === 0)</td></tr><tr class="hit"><td class="line">1536</td><td class="hits">42</td><td class="source">        self.cypher.return_properties = [ identifier ];</td></tr><tr class="hit"><td class="line">1537</td><td class="hits">42</td><td class="source">      if (key !== 'id') {</td></tr><tr class="hit"><td class="line">1538</td><td class="hits">2</td><td class="source">        var query = {};</td></tr><tr class="hit"><td class="line">1539</td><td class="hits">2</td><td class="source">        query[key] = value;</td></tr><tr class="hit"><td class="line">1540</td><td class="hits">2</td><td class="source">        self.where(query);</td></tr><tr class="hit"><td class="line">1541</td><td class="hits">2</td><td class="source">        if (self.label) self.withLabel(self.label);</td></tr><tr><td class="line">1542</td><td class="hits"></td><td class="source">        // if we have an id: value, we will build the query in prepareQuery</td></tr><tr><td class="line">1543</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">1544</td><td class="hits">42</td><td class="source">      if (typeof cb === 'function') {</td></tr><tr class="hit"><td class="line">1545</td><td class="hits">27</td><td class="source">         self.exec(function(err,found){</td></tr><tr class="hit"><td class="line">1546</td><td class="hits">27</td><td class="source">          if (err)</td></tr><tr class="miss"><td class="line">1547</td><td class="hits">0</td><td class="source">            return cb(err, found);</td></tr><tr><td class="line">1548</td><td class="hits"></td><td class="source">          else {</td></tr><tr><td class="line">1549</td><td class="hits"></td><td class="source">            // try to return the first</td></tr><tr class="hit"><td class="line">1550</td><td class="hits">27</td><td class="source">            found = (found.length === 0) ? null : ((found)&amp;&amp;(found[0])) ? found[0] : found;</td></tr><tr class="hit"><td class="line">1551</td><td class="hits">27</td><td class="source">            return cb(null, found);</td></tr><tr><td class="line">1552</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">1553</td><td class="hits"></td><td class="source">         });</td></tr><tr><td class="line">1554</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1555</td><td class="hits"></td><td class="source">     </td></tr><tr><td class="line">1556</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1557</td><td class="hits">42</td><td class="source">    return self;</td></tr><tr><td class="line">1558</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1559</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1560</td><td class="hits"></td><td class="source">  // Node.prototype.findUnique = function(key, value, cb) { }</td></tr><tr><td class="line">1561</td><td class="hits"></td><td class="source">  // Node.prototype.findUniqueWithLabel = function(label, key, value) {}</td></tr><tr><td class="line">1562</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1563</td><td class="hits">10</td><td class="source">  Node.prototype.findAll = function(cb) {</td></tr><tr class="hit"><td class="line">1564</td><td class="hits">35</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1565</td><td class="hits">35</td><td class="source">    if (!self.is_singleton)</td></tr><tr class="hit"><td class="line">1566</td><td class="hits">19</td><td class="source">      self = this.singleton(undefined, this);</td></tr><tr class="hit"><td class="line">1567</td><td class="hits">35</td><td class="source">    self._modified_query = true;</td></tr><tr class="hit"><td class="line">1568</td><td class="hits">35</td><td class="source">    self.cypher.limit = null;</td></tr><tr class="hit"><td class="line">1569</td><td class="hits">35</td><td class="source">    self.cypher.return_properties = ['n'];</td></tr><tr class="hit"><td class="line">1570</td><td class="hits">44</td><td class="source">    if (self.label) self.withLabel(self.label);</td></tr><tr class="hit"><td class="line">1571</td><td class="hits">35</td><td class="source">    self.exec(cb);</td></tr><tr class="hit"><td class="line">1572</td><td class="hits">35</td><td class="source">    return self;</td></tr><tr><td class="line">1573</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1574</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1575</td><td class="hits">10</td><td class="source">  Node.prototype.findByIndex = function(namespace, key, value, cb) {</td></tr><tr class="hit"><td class="line">1576</td><td class="hits">2</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">1577</td><td class="hits">2</td><td class="source">    if (!self.is_singleton)</td></tr><tr class="hit"><td class="line">1578</td><td class="hits">2</td><td class="source">      self = this.singleton(undefined, this);</td></tr><tr class="hit"><td class="line">1579</td><td class="hits">2</td><td class="source">    var values = {};</td></tr><tr class="hit"><td class="line">1580</td><td class="hits">2</td><td class="source">    if ((namespace)&amp;&amp;(key)&amp;&amp;(value)&amp;&amp;(typeof cb === 'function')) {</td></tr><tr><td class="line">1581</td><td class="hits"></td><td class="source">      // values = { key: value };</td></tr><tr><td class="line">1582</td><td class="hits"></td><td class="source">      // TODO: implement</td></tr><tr class="hit"><td class="line">1583</td><td class="hits">2</td><td class="source">      return self.neo4jrestful.get('/db/data/index/node/'+namespace+'/'+key+'/'+value+'/', function(err, result, debug) {</td></tr><tr class="hit"><td class="line">1584</td><td class="hits">2</td><td class="source">        if (err) {</td></tr><tr class="miss"><td class="line">1585</td><td class="hits">0</td><td class="source">          cb(err, result, debug);</td></tr><tr><td class="line">1586</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="hit"><td class="line">1587</td><td class="hits">2</td><td class="source">          result = (result[0]) ? result[0] : null;</td></tr><tr class="hit"><td class="line">1588</td><td class="hits">2</td><td class="source">          cb(null, result, debug);</td></tr><tr><td class="line">1589</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">1590</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">1591</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">1592</td><td class="hits">0</td><td class="source">      return cb(Error('Namespace, key, value and mandatory to find indexed nodes.'), null);</td></tr><tr><td class="line">1593</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1594</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1595</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1596</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">1597</td><td class="hits"></td><td class="source">   * Static methods (misc)</td></tr><tr><td class="line">1598</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1599</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1600</td><td class="hits">10</td><td class="source">  Node.prototype.copy_of = function(that) {</td></tr><tr class="miss"><td class="line">1601</td><td class="hits">0</td><td class="source">    return _.extend({},that);</td></tr><tr><td class="line">1602</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1603</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1604</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">1605</td><td class="hits"></td><td class="source">   * Singleton methods, shorthands for their corresponding (static) prototype methods</td></tr><tr><td class="line">1606</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1607</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1608</td><td class="hits"></td><td class="source">  // TODO: maybe better to replace manual argument passing with .apply method?!</td></tr><tr><td class="line">1609</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1610</td><td class="hits">10</td><td class="source">  Node.singleton = function(id) {</td></tr><tr class="miss"><td class="line">1611</td><td class="hits">0</td><td class="source">    return this.prototype.singleton(id);</td></tr><tr><td class="line">1612</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1613</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1614</td><td class="hits">10</td><td class="source">  Node.find = function(where, cb) {</td></tr><tr class="miss"><td class="line">1615</td><td class="hits">0</td><td class="source">    return this.prototype.find(where, cb);</td></tr><tr><td class="line">1616</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1617</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1618</td><td class="hits">10</td><td class="source">  Node.findAll = function(cb) {</td></tr><tr class="hit"><td class="line">1619</td><td class="hits">6</td><td class="source">    return this.prototype.findAll(cb);</td></tr><tr><td class="line">1620</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">1621</td><td class="hits">10</td><td class="source">  Node.findByIndex = function(namespace, key, value, cb) {</td></tr><tr class="hit"><td class="line">1622</td><td class="hits">1</td><td class="source">    return this.prototype.findByIndex(namespace, key, value, cb);</td></tr><tr><td class="line">1623</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1624</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1625</td><td class="hits">10</td><td class="source">  Node.findByUniqueKeyValue = function(key, value, cb) {</td></tr><tr class="hit"><td class="line">1626</td><td class="hits">2</td><td class="source">    return this.prototype.findByUniqueKeyValue(key, value, cb);</td></tr><tr><td class="line">1627</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1628</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1629</td><td class="hits">10</td><td class="source">  Node.findById = function(id, cb) {</td></tr><tr class="hit"><td class="line">1630</td><td class="hits">7</td><td class="source">    return this.prototype.findById(id, cb);</td></tr><tr><td class="line">1631</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1632</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">1633</td><td class="hits">10</td><td class="source">  Node.findOne = function(where, cb) {</td></tr><tr class="hit"><td class="line">1634</td><td class="hits">3</td><td class="source">    return this.prototype.findOne(where, cb);</td></tr><tr><td class="line">1635</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1636</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1637</td><td class="hits">10</td><td class="source">  Node.find = function(where, cb) {</td></tr><tr class="hit"><td class="line">1638</td><td class="hits">2</td><td class="source">    return this.prototype.find(where, cb);</td></tr><tr><td class="line">1639</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1640</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1641</td><td class="hits">10</td><td class="source">  Node.register_model = function(Class, label, cb) {</td></tr><tr class="hit"><td class="line">1642</td><td class="hits">9</td><td class="source">    return this.prototype.register_model(Class, label, cb);</td></tr><tr><td class="line">1643</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1644</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1645</td><td class="hits">10</td><td class="source">  Node.unregister_model = function(Class) {</td></tr><tr class="hit"><td class="line">1646</td><td class="hits">2</td><td class="source">    return this.prototype.unregister_model(Class);</td></tr><tr><td class="line">1647</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1648</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1649</td><td class="hits">10</td><td class="source">  Node.registered_models = function() {</td></tr><tr class="hit"><td class="line">1650</td><td class="hits">3</td><td class="source">    return this.prototype.registered_models();</td></tr><tr><td class="line">1651</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1652</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1653</td><td class="hits">10</td><td class="source">  Node.registered_model = function(model) {</td></tr><tr class="miss"><td class="line">1654</td><td class="hits">0</td><td class="source">    return this.prototype.registered_model(model);</td></tr><tr><td class="line">1655</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1656</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1657</td><td class="hits">10</td><td class="source">  Node.convert_node_to_model = function(node, model, fallbackModel) {</td></tr><tr class="hit"><td class="line">1658</td><td class="hits">1</td><td class="source">    return this.prototype.convert_node_to_model(node, model, fallbackModel);</td></tr><tr><td class="line">1659</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1660</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1661</td><td class="hits">10</td><td class="source">  return Node;</td></tr><tr><td class="line">1662</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1663</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1664</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1665</td><td class="hits">1</td><td class="source">if (typeof window !== 'object') {</td></tr><tr class="hit"><td class="line">1666</td><td class="hits">1</td><td class="source">  module.exports = exports = initNode;</td></tr><tr><td class="line">1667</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/Users/philipp/code/neo4jmapper/src/path.js">/Users/philipp/code/neo4jmapper/src/path.js</h2><div id="stats" class="high"><div class="percentage">88%</div><div class="sloc">62</div><div class="hits">55</div><div class="misses">7</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var initPath = function(neo4jrestful) {</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">5</td><td class="source">  var _neo4jrestful = null</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">    , helpers       = null</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">    , _             = null</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">5</td><td class="source">  if (typeof window === 'object') {</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    // browser</td></tr><tr class="miss"><td class="line">9</td><td class="hits">0</td><td class="source">    helpers = neo4jmapper_helpers;</td></tr><tr class="miss"><td class="line">10</td><td class="hits">0</td><td class="source">    _       = window._;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  } else {</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    // nodejs</td></tr><tr class="hit"><td class="line">13</td><td class="hits">5</td><td class="source">    helpers = require('./helpers')</td></tr><tr class="hit"><td class="line">14</td><td class="hits">5</td><td class="source">    _       = require('underscore');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">5</td><td class="source">  if (_.isObject(neo4jrestful))</td></tr><tr class="hit"><td class="line">18</td><td class="hits">5</td><td class="source">    _neo4jrestful = neo4jrestful;</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">   * Constructor</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">   */</td></tr><tr class="hit"><td class="line">23</td><td class="hits">5</td><td class="source">  Path = function Path(data) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">    this.nodes = [];</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">    this.relationships = [];</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">    this.from = {</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">      id: null,</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">      uri: null</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">    this.to = {</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">      id: null,</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">      uri: null</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">    this.is_instanced = true;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">5</td><td class="source">  Path.prototype.neo4jrestful = _neo4jrestful;</td></tr><tr class="hit"><td class="line">38</td><td class="hits">5</td><td class="source">  Path.prototype.from = null;</td></tr><tr class="hit"><td class="line">39</td><td class="hits">5</td><td class="source">  Path.prototype.to = null;</td></tr><tr class="hit"><td class="line">40</td><td class="hits">5</td><td class="source">  Path.prototype.start = null;</td></tr><tr class="hit"><td class="line">41</td><td class="hits">5</td><td class="source">  Path.prototype.end = null;</td></tr><tr class="hit"><td class="line">42</td><td class="hits">5</td><td class="source">  Path.prototype.length = 0;</td></tr><tr class="hit"><td class="line">43</td><td class="hits">5</td><td class="source">  Path.prototype.relationships = null;</td></tr><tr class="hit"><td class="line">44</td><td class="hits">5</td><td class="source">  Path.prototype.nodes = null;</td></tr><tr class="hit"><td class="line">45</td><td class="hits">5</td><td class="source">  Path.prototype._response = null;</td></tr><tr class="hit"><td class="line">46</td><td class="hits">5</td><td class="source">  Path.prototype.is_singleton = false;</td></tr><tr class="hit"><td class="line">47</td><td class="hits">5</td><td class="source">  Path.prototype.is_persisted = false;</td></tr><tr class="hit"><td class="line">48</td><td class="hits">5</td><td class="source">  Path.prototype.is_instanced = null;</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">50</td><td class="hits">5</td><td class="source">  Path.prototype.singleton = function() {</td></tr><tr class="miss"><td class="line">51</td><td class="hits">0</td><td class="source">    var path = new Path();</td></tr><tr class="miss"><td class="line">52</td><td class="hits">0</td><td class="source">    path.neo4jrestful = _neo4jrestful;</td></tr><tr class="miss"><td class="line">53</td><td class="hits">0</td><td class="source">    path.is_singleton = true;</td></tr><tr class="miss"><td class="line">54</td><td class="hits">0</td><td class="source">    return path;</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  [</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    { start: 'http://localhost:7419/db/data/node/1019',</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">      nodes:</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">       [ 'http://localhost:7419/db/data/node/1019',</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">         'http://localhost:7419/db/data/node/1020',</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">         'http://localhost:7419/db/data/node/1021' ],</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">      length: 2,</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">      relationships:</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">       [ 'http://localhost:7419/db/data/relationship/315',</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">         'http://localhost:7419/db/data/relationship/316' ],</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">      end: 'http://localhost:7419/db/data/node/1021' } ]</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  */</td></tr><tr class="hit"><td class="line">70</td><td class="hits">5</td><td class="source">  Path.prototype.populateWithDataFromResponse = function(data) {</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">    // if we are working on the prototype object</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">    // we won't mutate it and create a new path instance insetad</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">    var path = (this.is_instanced !== null) ? this : new Path();</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">    if (data) {</td></tr><tr class="hit"><td class="line">75</td><td class="hits">1</td><td class="source">      if (_.isObject(data) &amp;&amp; (!_.isArray(data)))</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">        path._response = data;</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">      else</td></tr><tr class="miss"><td class="line">78</td><td class="hits">0</td><td class="source">        path._response = data[0];</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">      if (_.isArray(data.nodes)) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">        for (var i=0; i &lt; data.nodes.length; i++) {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">3</td><td class="source">          var url = data.nodes[i];</td></tr><tr class="hit"><td class="line">83</td><td class="hits">3</td><td class="source">          if (/[0-9]+$/.test(url))</td></tr><tr class="hit"><td class="line">84</td><td class="hits">3</td><td class="source">            data.nodes[i] = {</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">              uri: url,</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">              id: Number(url.match(/[0-9]+$/)[0])</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">91</td><td class="hits">1</td><td class="source">      path.nodes = _.extend(data.nodes);</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">      if (_.isArray(data.relationships)) {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">1</td><td class="source">        for (var i=0; i &lt; data.relationships.length; i++) {</td></tr><tr class="hit"><td class="line">95</td><td class="hits">2</td><td class="source">          var url = data.relationships[i];</td></tr><tr class="hit"><td class="line">96</td><td class="hits">2</td><td class="source">          if (/[0-9]+$/.test(url))</td></tr><tr class="hit"><td class="line">97</td><td class="hits">2</td><td class="source">            data.relationships[i] = {</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">              uri: url,</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">              id: Number(url.match(/[0-9]+$/)[0])</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">104</td><td class="hits">1</td><td class="source">      path.relationships = _.extend(data.relationships);</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">106</td><td class="hits">1</td><td class="source">      path.from = {</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">        id: Number(data.start.match(/[0-9]+$/)[0]),</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">        uri: data.start</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">111</td><td class="hits">1</td><td class="source">      path.to = {</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">        id: Number(data.end.match(/[0-9]+$/)[0]),</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">        uri: data.end</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">116</td><td class="hits">1</td><td class="source">      path.start = data.start;</td></tr><tr class="hit"><td class="line">117</td><td class="hits">1</td><td class="source">      path.end = data.end;</td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">      path.length = data.length;</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">121</td><td class="hits">1</td><td class="source">    path.is_persisted = true;</td></tr><tr class="hit"><td class="line">122</td><td class="hits">1</td><td class="source">    return path;</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">125</td><td class="hits">5</td><td class="source">  Path.prototype.toObject = function() {</td></tr><tr class="hit"><td class="line">126</td><td class="hits">1</td><td class="source">    return {</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">      start: this.start,</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">      end: this.end,</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">      from: _.extend(this.from),</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">      to: _.extend(this.to),</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">      relationships: _.extend(this.relationships),</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">      nodes: _.extend(this.nodes)</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">136</td><td class="hits">5</td><td class="source">  return Path;</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">140</td><td class="hits">1</td><td class="source">if (typeof window !== 'object') {</td></tr><tr class="hit"><td class="line">141</td><td class="hits">1</td><td class="source">  module.exports = exports = initPath;</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/Users/philipp/code/neo4jmapper/src/relationship.js">/Users/philipp/code/neo4jmapper/src/relationship.js</h2><div id="stats" class="high"><div class="percentage">78%</div><div class="sloc">171</div><div class="hits">135</div><div class="misses">36</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * TODO:</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * + make query mapper from Node available for relationships as well</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * + make relationships queryable with custom queries</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var initRelationship = function(neo4jrestful) {</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">9</td><td class="hits">5</td><td class="source">  var _neo4jrestful = null</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    , Node          = null</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    , helpers       = null</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    , _             = null;</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">5</td><td class="source">  if (typeof window === 'object') {</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    // browser</td></tr><tr class="miss"><td class="line">16</td><td class="hits">0</td><td class="source">    helpers = neo4jmapper_helpers;</td></tr><tr class="miss"><td class="line">17</td><td class="hits">0</td><td class="source">    _       = window._;</td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">    Node    = initNode(neo4jrestful);</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  } else {</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    // nodejs</td></tr><tr class="hit"><td class="line">21</td><td class="hits">5</td><td class="source">    helpers  = require('./helpers');</td></tr><tr class="hit"><td class="line">22</td><td class="hits">5</td><td class="source">    _        = require('underscore');</td></tr><tr class="hit"><td class="line">23</td><td class="hits">5</td><td class="source">    Node     = require('./node')(neo4jrestful);</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">26</td><td class="hits">5</td><td class="source">  if (_.isObject(neo4jrestful)) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">5</td><td class="source">    _neo4jrestful = neo4jrestful;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">   * Constructor</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">34</td><td class="hits">5</td><td class="source">  Relationship = function Relationship(data, start, end, id) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">31</td><td class="source">    this.id = id || null;</td></tr><tr class="hit"><td class="line">36</td><td class="hits">31</td><td class="source">    this.data = data || {};</td></tr><tr class="hit"><td class="line">37</td><td class="hits">31</td><td class="source">    this.from = {</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">      id: null,</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">      uri: null</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">41</td><td class="hits">31</td><td class="source">    this.to = {</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">      id: null,</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">      uri: null</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">45</td><td class="hits">31</td><td class="source">    if (_.isString(start))</td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">      this.setPointUriById('from', start);</td></tr><tr class="hit"><td class="line">47</td><td class="hits">31</td><td class="source">    else if (_.isNumber(start))</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">      this.setPointIdByUri('from', start);</td></tr><tr class="hit"><td class="line">49</td><td class="hits">31</td><td class="source">    if (_.isString(end))</td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="source">      this.setPointUriById('to', end);</td></tr><tr class="hit"><td class="line">51</td><td class="hits">31</td><td class="source">    else if (_.isNumber(end))</td></tr><tr class="miss"><td class="line">52</td><td class="hits">0</td><td class="source">      this.setPointIdByUri('to', end);</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">    // this.resetQuery();</td></tr><tr class="hit"><td class="line">54</td><td class="hits">31</td><td class="source">    if (id) {</td></tr><tr class="miss"><td class="line">55</td><td class="hits">0</td><td class="source">      this.setUriById(id);</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">57</td><td class="hits">31</td><td class="source">    this.is_instanced = true;</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">5</td><td class="source">  Relationship.prototype.neo4jrestful = _neo4jrestful;</td></tr><tr class="hit"><td class="line">61</td><td class="hits">5</td><td class="source">  Relationship.prototype.data = {};</td></tr><tr class="hit"><td class="line">62</td><td class="hits">5</td><td class="source">  Relationship.prototype.start = null;</td></tr><tr class="hit"><td class="line">63</td><td class="hits">5</td><td class="source">  Relationship.prototype.type = null;</td></tr><tr class="hit"><td class="line">64</td><td class="hits">5</td><td class="source">  Relationship.prototype.end = null;</td></tr><tr class="hit"><td class="line">65</td><td class="hits">5</td><td class="source">  Relationship.prototype.from = null;</td></tr><tr class="hit"><td class="line">66</td><td class="hits">5</td><td class="source">  Relationship.prototype.to = null;</td></tr><tr class="hit"><td class="line">67</td><td class="hits">5</td><td class="source">  Relationship.prototype.id = null;</td></tr><tr class="hit"><td class="line">68</td><td class="hits">5</td><td class="source">  Relationship.prototype._id_ = null;</td></tr><tr class="hit"><td class="line">69</td><td class="hits">5</td><td class="source">  Relationship.prototype.uri = null;</td></tr><tr class="hit"><td class="line">70</td><td class="hits">5</td><td class="source">  Relationship.prototype._response = null;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  // Relationship.prototype._modified_query = false;</td></tr><tr class="hit"><td class="line">72</td><td class="hits">5</td><td class="source">  Relationship.prototype.is_singleton = false;</td></tr><tr class="hit"><td class="line">73</td><td class="hits">5</td><td class="source">  Relationship.prototype.is_persisted = false;</td></tr><tr class="hit"><td class="line">74</td><td class="hits">5</td><td class="source">  Relationship.prototype.cypher = {};</td></tr><tr class="hit"><td class="line">75</td><td class="hits">5</td><td class="source">  Relationship.prototype.is_instanced = null;</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">77</td><td class="hits">5</td><td class="source">  Relationship.prototype.__type__ = 'relationship';</td></tr><tr class="hit"><td class="line">78</td><td class="hits">5</td><td class="source">  Relationship.prototype.__type_identifier__ = 'r';</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">80</td><td class="hits">5</td><td class="source">  Relationship.prototype.singleton = function() {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">5</td><td class="source">    var relationship = new Relationship();</td></tr><tr class="hit"><td class="line">82</td><td class="hits">5</td><td class="source">    relationship.neo4jrestful = _neo4jrestful;</td></tr><tr class="hit"><td class="line">83</td><td class="hits">5</td><td class="source">    relationship.is_singleton = true;</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">    // relationship.resetQuery();</td></tr><tr class="hit"><td class="line">85</td><td class="hits">5</td><td class="source">    return relationship;</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">89</td><td class="hits">5</td><td class="source">  Relationship.prototype.hasId = function() {</td></tr><tr class="hit"><td class="line">90</td><td class="hits">16</td><td class="source">    return ((this.is_instanced) &amp;&amp; (this.id &gt; 0)) ? true : false;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">5</td><td class="source">  Relationship.prototype.setPointUriById = function(startOrEnd, id) {</td></tr><tr class="miss"><td class="line">94</td><td class="hits">0</td><td class="source">    if (typeof startOrEnd !== 'string')</td></tr><tr class="miss"><td class="line">95</td><td class="hits">0</td><td class="source">      startOrEnd = 'from';</td></tr><tr class="miss"><td class="line">96</td><td class="hits">0</td><td class="source">    if ((startOrEnd !== 'from')||(startOrEnd !== 'to'))</td></tr><tr class="miss"><td class="line">97</td><td class="hits">0</td><td class="source">      throw Error(&quot;You have to set startOrEnd argument to 'from' or 'to'&quot;);</td></tr><tr class="miss"><td class="line">98</td><td class="hits">0</td><td class="source">    if (_.isNumber(id)) {</td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">      this[startOrEnd].uri = this.neo4jrestful.baseUrl+'db/data/relationship/'+id;</td></tr><tr class="miss"><td class="line">100</td><td class="hits">0</td><td class="source">      this[startOrEnd].id = id;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">102</td><td class="hits">0</td><td class="source">    return this;</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">105</td><td class="hits">5</td><td class="source">  Relationship.prototype.setPointIdByUri = function(startOrEnd, uri) {</td></tr><tr class="hit"><td class="line">106</td><td class="hits">52</td><td class="source">    if (typeof startOrEnd !== 'string')</td></tr><tr class="miss"><td class="line">107</td><td class="hits">0</td><td class="source">      startOrEnd = 'from';</td></tr><tr class="hit"><td class="line">108</td><td class="hits">52</td><td class="source">    if ((startOrEnd !== 'from')&amp;&amp;(startOrEnd !== 'to'))</td></tr><tr class="miss"><td class="line">109</td><td class="hits">0</td><td class="source">      throw Error(&quot;You have to set startOrEnd argument to 'from' or 'to'&quot;);</td></tr><tr class="hit"><td class="line">110</td><td class="hits">52</td><td class="source">    if (uri.match(/[0-9]+$/)) {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">52</td><td class="source">      this[startOrEnd].uri = uri;</td></tr><tr class="hit"><td class="line">112</td><td class="hits">52</td><td class="source">      this[startOrEnd].id = Number(uri.match(/[0-9]+$/)[0]);</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">116</td><td class="hits">5</td><td class="source">  Relationship.prototype.setUriById = function(id) {</td></tr><tr class="miss"><td class="line">117</td><td class="hits">0</td><td class="source">    if (_.isNumber(id))</td></tr><tr class="miss"><td class="line">118</td><td class="hits">0</td><td class="source">      return this.uri = this.neo4jrestful.baseUrl+'db/data/relationship/'+id;</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">121</td><td class="hits">5</td><td class="source">  Relationship.prototype.flattenData = Node.prototype.flattenData;</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">123</td><td class="hits">5</td><td class="source">  Relationship.prototype.unflattenData = Node.prototype.flattenData;</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">125</td><td class="hits">5</td><td class="source">  Relationship.prototype.findById = function(id, cb) {</td></tr><tr class="hit"><td class="line">126</td><td class="hits">5</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">127</td><td class="hits">5</td><td class="source">    if (!self.is_singleton)</td></tr><tr class="hit"><td class="line">128</td><td class="hits">5</td><td class="source">      self = this.singleton();</td></tr><tr class="hit"><td class="line">129</td><td class="hits">5</td><td class="source">    return this.neo4jrestful.get('/db/data/relationship/'+Number(id), function(err, relationship) {</td></tr><tr class="hit"><td class="line">130</td><td class="hits">5</td><td class="source">      if ((err)||(!relationship))</td></tr><tr class="hit"><td class="line">131</td><td class="hits">1</td><td class="source">        return cb(err, relationship);</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">      else {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">4</td><td class="source">        relationship.load(cb);</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">138</td><td class="hits">5</td><td class="source">  Relationship.prototype.save = function(cb) {</td></tr><tr class="hit"><td class="line">139</td><td class="hits">2</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">140</td><td class="hits">2</td><td class="source">    if (this.is_singleton)</td></tr><tr class="miss"><td class="line">141</td><td class="hits">0</td><td class="source">      return cb(Error('Singleton instances can not be persisted'), null);</td></tr><tr class="hit"><td class="line">142</td><td class="hits">2</td><td class="source">    this._modified_query = false;</td></tr><tr class="hit"><td class="line">143</td><td class="hits">2</td><td class="source">    if (this._id_) {</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">      // copy 'private' _id_ to public</td></tr><tr class="hit"><td class="line">145</td><td class="hits">2</td><td class="source">      this.id = this._id_;</td></tr><tr class="hit"><td class="line">146</td><td class="hits">2</td><td class="source">      return this.update(cb);</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">148</td><td class="hits">0</td><td class="source">      var url = '/db/relationship/relationship';</td></tr><tr class="miss"><td class="line">149</td><td class="hits">0</td><td class="source">      this.neo4jrestful.post(url, { data: this.flattenData() }, function(err,data){</td></tr><tr class="miss"><td class="line">150</td><td class="hits">0</td><td class="source">        if (err)</td></tr><tr class="miss"><td class="line">151</td><td class="hits">0</td><td class="source">          cb(err,data);</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">        else {</td></tr><tr class="miss"><td class="line">153</td><td class="hits">0</td><td class="source">          self.populateWithDataFromResponse(data);</td></tr><tr class="miss"><td class="line">154</td><td class="hits">0</td><td class="source">          return cb(null, data);</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">160</td><td class="hits">5</td><td class="source">  Relationship.prototype.update = function(data, cb) {</td></tr><tr class="hit"><td class="line">161</td><td class="hits">3</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">162</td><td class="hits">3</td><td class="source">    if (helpers.isValidData(data)) {</td></tr><tr class="hit"><td class="line">163</td><td class="hits">1</td><td class="source">      this.data = _.extend(this.data, data);</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">165</td><td class="hits">2</td><td class="source">      cb = data;</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">167</td><td class="hits">3</td><td class="source">    if (!this.hasId())</td></tr><tr class="miss"><td class="line">168</td><td class="hits">0</td><td class="source">      return cb(Error('Singleton instances can not be persisted'), null);</td></tr><tr class="hit"><td class="line">169</td><td class="hits">3</td><td class="source">    this._modified_query = false;</td></tr><tr class="hit"><td class="line">170</td><td class="hits">3</td><td class="source">    if (this.hasId()) {</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">      // copy 'private' _id_ to public</td></tr><tr class="hit"><td class="line">172</td><td class="hits">3</td><td class="source">      this.id = this._id_;</td></tr><tr class="hit"><td class="line">173</td><td class="hits">3</td><td class="source">      this.neo4jrestful.put('/db/data/relationship/'+this.id+'/properties', { data: this.flattenData() }, function(err,data){</td></tr><tr class="hit"><td class="line">174</td><td class="hits">3</td><td class="source">        if (err)</td></tr><tr class="miss"><td class="line">175</td><td class="hits">0</td><td class="source">          return cb(err, data);</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">        else</td></tr><tr class="hit"><td class="line">177</td><td class="hits">3</td><td class="source">          return cb(null, self);</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">180</td><td class="hits">0</td><td class="source">      return cb(Error('You have to save() the relationship before you can perform an update'), null);</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">   // extensions: {},</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">   //  start: 'http://localhost:7419/db/data/node/169',</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">   //  property: 'http://localhost:7419/db/data/relationship/10/properties/{key}',</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">   //  self: 'http://localhost:7419/db/data/relationship/10',</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">   //  properties: 'http://localhost:7419/db/data/relationship/10/properties',</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">   //  type: 'KNOWS',</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">   //  end: 'http://localhost:7419/db/data/node/170',</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">   //  data: { since: 'years' } }</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">193</td><td class="hits">5</td><td class="source">  Relationship.prototype.populateWithDataFromResponse = function(data, create) {</td></tr><tr class="hit"><td class="line">194</td><td class="hits">26</td><td class="source">    create = (typeof create !== 'undefined') ? create : false;</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">    // if we are working on the prototype object</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">    // we won't mutate it and create a new relationship instance insetad</td></tr><tr class="hit"><td class="line">197</td><td class="hits">26</td><td class="source">    var relationship = (this.is_instanced !== null) ? this : new Relationship();</td></tr><tr class="hit"><td class="line">198</td><td class="hits">26</td><td class="source">    if (create)</td></tr><tr class="miss"><td class="line">199</td><td class="hits">0</td><td class="source">      relationship = new Relationship();</td></tr><tr class="hit"><td class="line">200</td><td class="hits">26</td><td class="source">    relationship._modified_query = false;</td></tr><tr class="hit"><td class="line">201</td><td class="hits">26</td><td class="source">    if (data) {</td></tr><tr class="hit"><td class="line">202</td><td class="hits">26</td><td class="source">      if (_.isObject(data) &amp;&amp; (!_.isArray(data)))</td></tr><tr class="hit"><td class="line">203</td><td class="hits">26</td><td class="source">        relationship._response = data;</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">      else</td></tr><tr class="miss"><td class="line">205</td><td class="hits">0</td><td class="source">        relationship._response = data[0];</td></tr><tr class="hit"><td class="line">206</td><td class="hits">26</td><td class="source">      relationship.data = relationship._response.data;</td></tr><tr class="hit"><td class="line">207</td><td class="hits">26</td><td class="source">      relationship.data = relationship.unflattenData();</td></tr><tr class="hit"><td class="line">208</td><td class="hits">26</td><td class="source">      relationship.uri  = relationship._response.self;</td></tr><tr class="hit"><td class="line">209</td><td class="hits">26</td><td class="source">      relationship.type = relationship._response.type;</td></tr><tr class="hit"><td class="line">210</td><td class="hits">26</td><td class="source">      if ((relationship._response.self) &amp;&amp; (relationship._response.self.match(/[0-9]+$/))) {</td></tr><tr class="hit"><td class="line">211</td><td class="hits">26</td><td class="source">        relationship.id = relationship._id_ = Number(relationship._response.self.match(/[0-9]+$/)[0]);</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">213</td><td class="hits">26</td><td class="source">      if ((relationship._response.start) &amp;&amp; (relationship._response.start.match(/[0-9]+$/))) {</td></tr><tr class="hit"><td class="line">214</td><td class="hits">26</td><td class="source">        relationship.from.uri = relationship.start = relationship._response.start;</td></tr><tr class="hit"><td class="line">215</td><td class="hits">26</td><td class="source">        relationship.setPointIdByUri('from', relationship._response.start);</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">217</td><td class="hits">26</td><td class="source">      if ((relationship._response.end) &amp;&amp; (relationship._response.end.match(/[0-9]+$/))) {</td></tr><tr class="hit"><td class="line">218</td><td class="hits">26</td><td class="source">        relationship.to.uri = relationship.end = relationship._response.end;</td></tr><tr class="hit"><td class="line">219</td><td class="hits">26</td><td class="source">        relationship.setPointIdByUri('to', relationship._response.end);</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">222</td><td class="hits">26</td><td class="source">    relationship.is_persisted = true;</td></tr><tr class="hit"><td class="line">223</td><td class="hits">26</td><td class="source">    return relationship;</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">226</td><td class="hits">5</td><td class="source">  Relationship.prototype.remove = function(cb) {</td></tr><tr class="hit"><td class="line">227</td><td class="hits">1</td><td class="source">    if (this.is_singleton)</td></tr><tr class="miss"><td class="line">228</td><td class="hits">0</td><td class="source">      return cb(Error(&quot;To delete results of a query use delete(). remove() is for removing a relationship.&quot;),null);</td></tr><tr class="hit"><td class="line">229</td><td class="hits">1</td><td class="source">    if (this.hasId()) {</td></tr><tr class="hit"><td class="line">230</td><td class="hits">1</td><td class="source">      return this.neo4jrestful.delete('/db/data/relationship/'+this.id, cb);</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">232</td><td class="hits">0</td><td class="source">    return this;</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">235</td><td class="hits">5</td><td class="source">  Relationship.prototype.loadFromAndToNodes = function(cb) {</td></tr><tr class="hit"><td class="line">236</td><td class="hits">9</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">237</td><td class="hits">9</td><td class="source">    var attributes = [ 'from', 'to' ];</td></tr><tr class="hit"><td class="line">238</td><td class="hits">9</td><td class="source">    var done = 0;</td></tr><tr class="hit"><td class="line">239</td><td class="hits">9</td><td class="source">    for (var i = 0; i &lt; 2; i++) {</td></tr><tr class="hit"><td class="line">240</td><td class="hits">18</td><td class="source">      (function(point){</td></tr><tr class="hit"><td class="line">241</td><td class="hits">18</td><td class="source">        Node.prototype.findById(self[point].id,function(err,node) {</td></tr><tr class="hit"><td class="line">242</td><td class="hits">18</td><td class="source">          self[point] = node;</td></tr><tr class="hit"><td class="line">243</td><td class="hits">18</td><td class="source">          done++;</td></tr><tr class="hit"><td class="line">244</td><td class="hits">18</td><td class="source">          if (done === 2) {</td></tr><tr class="hit"><td class="line">245</td><td class="hits">9</td><td class="source">            cb(null, self);</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">            </td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source">      })(attributes[i]);</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">253</td><td class="hits">5</td><td class="source">  Relationship.prototype.load = function(cb) {</td></tr><tr class="hit"><td class="line">254</td><td class="hits">9</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">255</td><td class="hits">9</td><td class="source">    this.onBeforeLoad(self, function(err, relationship){</td></tr><tr class="hit"><td class="line">256</td><td class="hits">9</td><td class="source">      if (err)</td></tr><tr class="miss"><td class="line">257</td><td class="hits">0</td><td class="source">        cb(err, relationship);</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">      else</td></tr><tr class="hit"><td class="line">259</td><td class="hits">9</td><td class="source">        self.onAfterLoad(relationship, cb);</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">    })</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">263</td><td class="hits">5</td><td class="source">  Relationship.prototype.onBeforeLoad = function(relationship, next) {</td></tr><tr class="hit"><td class="line">264</td><td class="hits">9</td><td class="source">    if (relationship.hasId()) {</td></tr><tr class="hit"><td class="line">265</td><td class="hits">9</td><td class="source">      relationship.loadFromAndToNodes(function(err, relationship){</td></tr><tr class="hit"><td class="line">266</td><td class="hits">9</td><td class="source">        next(err, relationship);</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">269</td><td class="hits">0</td><td class="source">      next(null, relationship);</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">    } </td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">273</td><td class="hits">5</td><td class="source">  Relationship.prototype.onAfterLoad = function(relationship, next) {</td></tr><tr class="hit"><td class="line">274</td><td class="hits">9</td><td class="source">    return next(null, relationship);</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">277</td><td class="hits">5</td><td class="source">  Relationship.prototype.toObject = function() {</td></tr><tr class="hit"><td class="line">278</td><td class="hits">1</td><td class="source">    return {</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">      id: this.id,</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">      data: _.extend(this.data),</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source">      start: this.start,</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">      end: this.end,</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source">      from: _.extend(this.from),</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source">      to: _.extend(this.to),</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source">      uri: this.uri,</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source">      type: this.type</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source">  /*</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source">   * Static singleton methods</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">294</td><td class="hits">5</td><td class="source">  Relationship.findById = function(id, cb) {</td></tr><tr class="hit"><td class="line">295</td><td class="hits">5</td><td class="source">    return this.prototype.findById(id, cb);</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">298</td><td class="hits">5</td><td class="source">  return Relationship;</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">302</td><td class="hits">1</td><td class="source">if (typeof window !== 'object') {</td></tr><tr class="hit"><td class="line">303</td><td class="hits">1</td><td class="source">  module.exports = exports = initRelationship;</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div></div></div></body></html>